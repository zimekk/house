"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[685],{6685:(t,e,r)=>{r.d(e,{A:()=>K});var i=r(9122),o=r(674),a=r(6666),n=r(3405),s=r(3376),l=r(5140),u=r(255),h=r(5991),_=r(1753),d=r(152),E=r(3126),c=r(3234),T=r(9618),f=r(3512),g=r(9402);function x(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R(t,e,r,i,o,a,n){n=n??x();let s=1/(t-e),l=1/(r-i),u=1/(o-a);return n[0]=-2*s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*u,n[11]=0,n[12]=(t+e)*s,n[13]=(i+r)*l,n[14]=(a+o)*u,n[15]=1,n}function A(t,e,r,i,o){return(o=o??x())[0]=t[0]*e,o[1]=t[1]*e,o[2]=t[2]*e,o[3]=t[3]*e,o[4]=t[4]*r,o[5]=t[5]*r,o[6]=t[6]*r,o[7]=t[7]*r,o[8]=t[8]*i,o[9]=t[9]*i,o[10]=t[10]*i,o[11]=t[11]*i,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}let m=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,p=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class F{constructor(t){this.gl_=t,this.program_=L(t,p,m),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,r,i,o,a,n,s,l,u,h,_,d){var E,c,T,f,g,m,p;let F,v,L,b,S,D,U,M,P,y,G,C;let I=this.gl_;void 0===s&&(s=i),void 0===l&&(l=o),void 0===a&&(a=e),void 0===n&&(n=r),void 0===u&&(u=a),void 0===h&&(h=n),void 0===_&&(_=I.canvas.width),void 0===d&&(d=I.canvas.height),I.bindTexture(I.TEXTURE_2D,t),I.useProgram(this.program_),I.bindBuffer(I.ARRAY_BUFFER,this.positionBuffer),I.enableVertexAttribArray(this.positionLocation),I.vertexAttribPointer(this.positionLocation,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,this.texcoordBuffer),I.enableVertexAttribArray(this.texcoordLocation),I.vertexAttribPointer(this.texcoordLocation,2,I.FLOAT,!1,0,0);let X=R(0,_,0,d,-1,1);E=X,c=s,T=l,E===(f=f??x())?(f[12]=E[0]*c+E[4]*T+0*E[8]+E[12],f[13]=E[1]*c+E[5]*T+0*E[9]+E[13],f[14]=E[2]*c+E[6]*T+0*E[10]+E[14],f[15]=E[3]*c+E[7]*T+0*E[11]+E[15]):(F=E[0],v=E[1],L=E[2],b=E[3],S=E[4],D=E[5],U=E[6],M=E[7],P=E[8],y=E[9],G=E[10],C=E[11],f[0]=F,f[1]=v,f[2]=L,f[3]=b,f[4]=S,f[5]=D,f[6]=U,f[7]=M,f[8]=P,f[9]=y,f[10]=G,f[11]=C,f[12]=F*c+S*T+0*P+E[12],f[13]=v*c+D*T+0*y+E[13],f[14]=L*c+U*T+0*G+E[14],f[15]=b*c+M*T+0*C+E[15]),X=A(X=f,u,h,1),I.uniformMatrix4fv(this.matrixLocation,!1,X);let w=(g=i/e,m=o/r,(p=p??x())[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=g,p[13]=m,p[14]=0,p[15]=1,p);w=A(w,a/e,n/r,1),I.uniformMatrix4fv(this.textureMatrixLocation,!1,w),I.uniform1i(this.textureLocation,0),I.drawArrays(I.TRIANGLES,0,this.positions.length/2)}}function v(t,e,r){let i=t.createShader(e);if(null===i)throw Error("Shader compilation failed");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){let e=t.getShaderInfoLog(i);if(null===e)throw Error("Shader info log creation failed");throw Error(e)}return i}function L(t,e,r){let i=t.createProgram(),o=v(t,t.VERTEX_SHADER,r),a=v(t,t.FRAGMENT_SHADER,e);if(null===i)throw Error("Program creation failed");if(t.attachShader(i,o),t.attachShader(i,a),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){if(null===t.getProgramInfoLog(i))throw Error("Program info log creation failed");throw Error()}return i}let b=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,S=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,D=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,U=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`,M=[];class P extends l.Ay{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=void 0!==t.renderEdges&&t.renderEdges,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let e=t.sourceProj,r=e.getExtent(),i=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?i?(0,d._N)(r,i):r:i;let o=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),a=this.targetTileGrid_.getExtent(),n=this.sourceTileGrid_.getExtent(),s=a?(0,d._N)(o,a):o;if(0===(0,d.UG)(s)){this.state=u.A.EMPTY;return}r&&(n=n?(0,d._N)(n,r):r);let l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,_=(0,c.aY)(e,h,s,l);if(!isFinite(_)||_<=0){this.state=u.A.EMPTY;return}let g=void 0!==t.errorThreshold?t.errorThreshold:f.l;if(this.triangulation_=new T.A(e,h,s,n,_*g,l,t.transformMatrix),0===this.triangulation_.getTriangles().length){this.state=u.A.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(_);let x=this.triangulation_.calculateSourceExtent();if(n&&(e.canWrapX()?(x[1]=(0,E.qE)(x[1],n[1],n[3]),x[3]=(0,E.qE)(x[3],n[1],n[3])):x=(0,d._N)(x,n)),(0,d.UG)(x)){let i=0,o=0;e.canWrapX()&&(i=(0,d.RG)(r),o=Math.floor((x[0]-r[0])/i)),(0,d.QJ)(x.slice(),e,!0).forEach(e=>{let r=this.sourceTileGrid_.getTileRangeForExtentAndZ(e,this.sourceZ_),a=t.getTileFunction;for(let t=r.minX;t<=r.maxX;t++)for(let e=r.minY;e<=r.maxY;e++){let r=a(this.sourceZ_,t,e,this.pixelRatio_);if(r){let t=o*i;this.sourceTiles_.push({tile:r,offset:t})}}++o}),0===this.sourceTiles_.length&&(this.state=u.A.EMPTY)}else this.state=u.A.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){var t;let e,r,o;let a=[],n=!1;if(this.sourceTiles_.forEach(t=>{let e;let r=t.tile;if(!r||r.getState()!==u.A.LOADED)return;let i=r.getSize(),o=this.gutter_,s=(0,l.bL)(r.getData());s?e=s:(n=!0,e=(0,l.$r)((0,l.xo)(r.getData())));let h=[i[0]+2*o,i[1]+2*o],_=e instanceof Float32Array,d=h[0]*h[1],E=_?Float32Array:Uint8ClampedArray,c=new E(e.buffer),T=E.BYTES_PER_ELEMENT,f=T*c.length/d,g=Math.floor(c.byteLength/h[1]/T/h[0]),x=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);x[0]+=t.offset,x[2]+=t.offset;let R=this.clipExtent_?.slice();R&&(R[0]+=t.offset,R[2]+=t.offset),a.push({extent:x,clipExtent:R,data:c,dataType:E,bytesPerPixel:f,pixelSize:h,bandCount:g})}),this.sourceTiles_.length=0,0===a.length){this.state=u.A.ERROR,this.changed();return}let s=this.wrappedTileCoord_[0],h=this.targetTileGrid_.getTileSize(s),_="number"==typeof h?h:h[0],E="number"==typeof h?h:h[1],c=_*this.pixelRatio_,T=E*this.pixelRatio_,f=this.targetTileGrid_.getResolution(s),x=this.sourceTileGrid_.getResolution(this.sourceZ_),A=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),m=a[0].bandCount,p=new a[0].dataType(m*c*T),v=(t={premultipliedAlpha:!1,antialias:!1},o=M&&M.length?M.shift():g.Wl?new OffscreenCanvas(c||300,T||300):document.createElement("canvas"),c&&(o.width=c),T&&(o.height=T),o.getContext("webgl",t)),P=v.RGBA;a[0].dataType==Float32Array?(r=v.FLOAT,v.getExtension("WEBGL_color_buffer_float"),v.getExtension("OES_texture_float"),v.getExtension("EXT_float_blend"),e=null!==v.getExtension("OES_texture_float_linear")&&this.interpolate):(r=v.UNSIGNED_BYTE,e=this.interpolate);let y=Math.ceil(m/4);for(let t=y-1;t>=0;--t){let i=[];for(let o=0,n=a.length;o<n;++o){let n=a[o],s=n.pixelSize,l=s[0],u=s[1],h=new n.dataType(4*l*u),_=n.data,d=4*t;for(let t=0,e=h.length;t<e;t+=4)h[t]=_[d],h[t+1]=_[d+1],h[t+2]=_[d+2],h[t+3]=_[d+3],d+=m;let E=v.createTexture();v.bindTexture(v.TEXTURE_2D,E),e?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR)):(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texImage2D(v.TEXTURE_2D,0,P,l,u,0,P,r,h),i.push({extent:n.extent,clipExtent:n.clipExtent,texture:E,width:l,height:u})}let{framebuffer:o,width:n,height:s}=function(t,e,r,i,o,a,n,s,l,u,h,_,E,c){let T,f,g,x,A;let m=Math.round(i*e),p=Math.round(i*r);if(t.canvas.width=m,t.canvas.height=p,f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,f),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),E?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,m,p,0,t.RGBA,h,null),T=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,T),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0),null===T)throw Error("Could not create framebuffer");if(null===f)throw Error("Could not create texture");if(0===l.length)return{width:m,height:p,framebuffer:T,texture:f};let v=(0,d.S5)();l.forEach(function(t,e,r){(0,d.X$)(v,t.extent)});let M=1/o;{if(g=t.createTexture(),null===f)throw Error("Could not create texture");x=Math.round((0,d.RG)(v)*M),A=Math.round((0,d.Oq)(v)*M);let e=t.getParameter(t.MAX_TEXTURE_SIZE),r=Math.max(x,A),i=r>e?e/r:1,o=Math.round(x*i),a=Math.round(A*i);t.bindTexture(t.TEXTURE_2D,g),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),E?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,o,a,0,t.RGBA,h,null);let n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,g,0);let s=new F(t);l.forEach(function(e,r,l){let h=(e.extent[0]-v[0])*M*i,_=-(e.extent[3]-v[3])*M*i,c=(0,d.RG)(e.extent)*M*i,T=(0,d.Oq)(e.extent)*M*i;if(t.bindFramebuffer(t.FRAMEBUFFER,n),t.viewport(0,0,o,a),e.clipExtent){let r=(e.clipExtent[0]-v[0])*M*i,o=-(e.clipExtent[3]-v[3])*M*i,a=(0,d.RG)(e.clipExtent)*M*i,n=(0,d.Oq)(e.clipExtent)*M*i;t.enable(t.SCISSOR_TEST),t.scissor(E?r:Math.round(r),E?o:Math.round(o),E?a:Math.round(r+a)-Math.round(r),E?n:Math.round(o+n)-Math.round(o))}s.drawImage(e.texture,e.width,e.height,u,u,e.width-2*u,e.height-2*u,E?h:Math.round(h),E?_:Math.round(_),E?c:Math.round(h+c)-Math.round(h),E?T:Math.round(_+T)-Math.round(_),o,a),t.disable(t.SCISSOR_TEST)}),t.deleteFramebuffer(n)}let P=(0,d.Py)(n),y=(0,d.Py)(v),G=t=>{let e=(t[0][0]-P[0])/a*i,r=-(t[0][1]-P[1])/a*i,o=(t[1][0]-P[0])/a*i;return{u1:o,v1:-(t[1][1]-P[1])/a*i,u0:e,v0:r,u2:(t[2][0]-P[0])/a*i,v2:-(t[2][1]-P[1])/a*i}};t.bindFramebuffer(t.FRAMEBUFFER,T),t.viewport(0,0,m,p);{let e=[],r=[],i=L(t,U,D);t.useProgram(i);let a=t.getUniformLocation(i,"u_texture");t.bindTexture(t.TEXTURE_2D,g),t.uniform1i(a,0),s.getTriangles().forEach(function(t,i,a){let n=t.source,{u1:s,v1:l,u0:u,v0:h,u2:_,v2:d}=G(t.target),E=(n[0][0]-y[0])/o/x,c=-(n[0][1]-y[1])/o/A,T=(n[1][0]-y[0])/o/x,f=-(n[1][1]-y[1])/o/A,g=(n[2][0]-y[0])/o/x,R=-(n[2][1]-y[1])/o/A;e.push(s,l,u,h,_,d),r.push(T,f,E,c,g,R)});let n=R(0,m,p,0,-1,1),l=t.getUniformLocation(i,"u_matrix");t.uniformMatrix4fv(l,!1,n);let u=t.getAttribLocation(i,"a_position"),h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u);let _=t.getAttribLocation(i,"a_texcoord"),d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.vertexAttribPointer(_,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(_),t.drawArrays(t.TRIANGLES,0,e.length/2)}if(_){let e=L(t,S,b);t.useProgram(e);let r=R(0,m,p,0,-1,1),i=t.getUniformLocation(e,"u_matrix");t.uniformMatrix4fv(i,!1,r);let o=Array.isArray(_)?_:[0,0,0,255],a=t.getUniformLocation(e,"u_val");t.uniform4fv(a,o);let n=t.getAttribLocation(e,"a_position"),l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n);let u=s.getTriangles().reduce(function(t,e){let{u1:r,v1:i,u0:o,v0:a,u2:n,v2:s}=G(e.target);return t.concat([r,i,o,a,o,a,n,s,n,s,r,i])},[]);t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),t.drawArrays(t.LINES,0,u.length/2)}return{width:m,height:p,framebuffer:T,texture:f}}(v,_,E,this.pixelRatio_,x,f,A,this.triangulation_,i,this.gutter_,r,this.renderEdges_,e),l=4*s,u=new a[0].dataType(n*l);v.bindFramebuffer(v.FRAMEBUFFER,o),v.readPixels(0,0,n,s,v.RGBA,r,u);let h=4*t;for(let t=0,e=u.length;t<e;t+=4){let e=(n-1-(t/l|0))*l+t%l;p[h]=u[e],p[h+1]=u[e+1],p[h+2]=u[e+2],p[h+3]=u[e+3],h+=m}}if(!function(t){let e=t.canvas;e.width=1,e.height=1,t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}(v),M.push(v.canvas),n){let t=(0,i.Y)(_,E),e=new ImageData(p,_);t.putImageData(e,0,0),this.reprojData_=t.canvas}else this.reprojData_=p;this.reprojSize_=[Math.round(c),Math.round(T)],this.state=u.A.LOADED,this.changed()}load(){if(this.state!==u.A.IDLE&&this.state!==u.A.ERROR)return;this.state=u.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{let r=e.getState();if(r!==u.A.IDLE&&r!==u.A.LOADING)return;t++;let i=(0,_.KT)(e,o.A.CHANGE,()=>{let r=e.getState();(r==u.A.LOADED||r==u.A.ERROR||r==u.A.EMPTY)&&((0,_.JH)(i),0==--t&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==u.A.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(_.JH),this.sourcesListenerKeys_=null}}var y=r(7678),G=r(2252),C=r(524),I=r(1494);class X extends C.A{constructor(t){let e=void 0===t.projection?"EPSG:3857":t.projection,r=t.tileGrid;void 0===r&&e&&(r=(0,y.EN)({extent:(0,y.kZ)(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:r,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.tileSize_=t.tileSize?(0,n.xq)(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===t.bandCount?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;let e=this.getTileGrid();return e?(0,n.xq)(e.getTileSize(t)):[256,256]}getGutterForProjection(t){let e=this.getProjection();return(!e||(0,a.tI)(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,r,i,o){let a=this.tileGrid||this.getTileGridForProjection(o||i),s=Math.max.apply(null,a.getResolutions().map((t,e)=>{let r=(0,n.xq)(a.getTileSize(e)),i=this.getTileSize(e);return Math.max(i[0]/r[0],i[1]/r[1])})),l=this.getTileGridForProjection(i),u=[t,e,r],h=this.getTileCoordForTileUrlFunction(u,i),_=new P(Object.assign({sourceProj:o||i,sourceTileGrid:a,targetProj:i,targetTileGrid:l,tileCoord:u,wrappedTileCoord:h,pixelRatio:s,gutter:this.gutter_,getTileFunction:(t,e,r,i)=>this.getTile(t,e,r,i),transformMatrix:this.transformMatrix},this.tileOptions));return _.key=this.getKey(),_}getTile(t,e,r,i,n){let s=this.getProjection();if(n&&(s&&!(0,a.tI)(s,n)||this.transformMatrix))return this.getReprojTile_(t,e,r,n,s);let u=this.getTileSize(t),_=this.loader_,d=new AbortController,E={signal:d.signal,crossOrigin:this.crossOrigin_},c=this.getTileCoordForTileUrlFunction([t,e,r]);if(!c)return null;let T=c[0],f=c[1],g=c[2],x=this.getTileGrid()?.getFullTileRange(T);x&&(E.maxY=x.getHeight()-1);let R=Object.assign({tileCoord:[t,e,r],loader:function(){return(0,h.hq)(function(){return _(T,f,g,E)})},size:u,controller:d},this.tileOptions),A=new l.Ay(R);return A.key=this.getKey(),A.addEventListener(o.A.CHANGE,this.handleTileChange_),A}handleTileChange_(t){let e;let r=t.target,i=(0,G.v6)(r),o=r.getState();o==u.A.LOADING?(this.tileLoadingKeys_[i]=!0,e=I.A.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],e=o==u.A.ERROR?I.A.TILELOADERROR:o==u.A.LOADED?I.A.TILELOADEND:void 0),e&&this.dispatchEvent(new C.c(e,r))}getTileGridForProjection(t){let e=this.getProjection();if(this.tileGrid&&(!e||(0,a.tI)(e,t))&&!this.transformMatrix)return this.tileGrid;let r=(0,G.v6)(t);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=(0,y.pr)(t)),this.tileGridForProjection_[r]}setTileGridForProjection(t,e){let r=(0,a.Jt)(t);if(r){let t=(0,G.v6)(r);t in this.tileGridForProjection_||(this.tileGridForProjection_[t]=e)}}}let w=X,O=Error("Image failed to load");function B(t,e,r,i,o){return new Promise((a,n)=>{let l=new Image;l.crossOrigin=o.crossOrigin??null,l.addEventListener("load",()=>a(l)),l.addEventListener("error",()=>n(O)),l.src=(0,s.M)(t,e,r,i,o.maxY)})}function j(t){return function(e,r,i,o){return B((0,s.de)(t,e,r,i),e,r,i,o)}}function N(t){let e;if(Array.isArray(t))e=j(t);else if("string"==typeof t)e=j((0,s.Uu)(t));else if("function"==typeof t)e=function(e,r,i,o){return B(t(e,r,i,o),e,r,i,o)};else throw Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let z=0;function Y(t){return Array.isArray(t)?t.join("\n"):"string"==typeof t?t:"url-function-key-"+ ++z}class W extends w{constructor(t){let e;let r=(t=t||{}).loader;t.url&&(r=N(t.url),e=Y(t.url)),super({loader:r,key:e,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize,gutter:t.gutter,maxResolution:t.maxResolution,projection:t.projection,tileGrid:t.tileGrid,state:r?t.state:"loading",wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,interpolate:!1!==t.interpolate,crossOrigin:t.crossOrigin,zDirection:t.zDirection})}setUrl(t){let e=N(t);this.setLoader(e),this.setKey(Y(t)),"ready"!==this.getState()&&this.setState("ready")}}let Z=W;class k extends Z{constructor(t){let e=(t=t||{}).template||"z:{z} x:{x} y:{y}",r=t.source;super({transition:0,wrapX:void 0!==t.wrapX?t.wrapX:void 0!==r?r.getWrapX():void 0});let l=()=>{this.projection=void 0!==t.projection?(0,a.Jt)(t.projection):void 0!==r?r.getProjection():this.projection,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:void 0!==r?r.getTileGrid():this.tileGrid,this.zDirection=void 0!==t.zDirection?t.zDirection:void 0!==r?r.zDirection:this.zDirection,r instanceof w&&(this.transformMatrix=r.transformMatrix?.slice()||null);let o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((t,e)=>(0,n.xq)(o.getTileSize(e)).map(t=>Math.max(Math.floor(t),1)))),this.setLoader((t,r,o,a)=>{let n=(0,s.M)(e,t,r,o,a.maxY),[l,u]=this.getTileSize(t),h=(0,i.Y)(l,u);return h.strokeStyle="grey",h.strokeRect(.5,.5,l+.5,u+.5),h.fillStyle="grey",h.strokeStyle="white",h.textAlign="center",h.textBaseline="middle",h.font="24px sans-serif",h.lineWidth=4,h.strokeText(n,l/2,u/2,l),h.fillText(n,l/2,u/2,l),h.canvas}),this.setState("ready")};if(void 0===r||"ready"===r.getState())l();else{let t=()=>{"ready"===r.getState()&&(r.removeEventListener(o.A.CHANGE,t),l())};r.addEventListener(o.A.CHANGE,t)}}}let K=k}}]);