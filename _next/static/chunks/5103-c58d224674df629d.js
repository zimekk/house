"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5103],{35103:(t,e,r)=>{r.d(e,{A:()=>H});var i=r(41206),o=r(46640),a=r(99127),n=r(12139),s=r(71708),l=r(2078),u=r(53779),h=r(46187),_=r(14139),c=r(92194),d=r(77216),E=r(12388),T=r(13220),f=r(80008),g=r(66490);function x(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R(t,e,r,i,o,a,n){n=n??x();let s=1/(t-e),l=1/(r-i),u=1/(o-a);return n[0]=-2*s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*u,n[11]=0,n[12]=(t+e)*s,n[13]=(i+r)*l,n[14]=(a+o)*u,n[15]=1,n}function A(t,e,r,i,o){return(o=o??x())[0]=t[0]*e,o[1]=t[1]*e,o[2]=t[2]*e,o[3]=t[3]*e,o[4]=t[4]*r,o[5]=t[5]*r,o[6]=t[6]*r,o[7]=t[7]*r,o[8]=t[8]*i,o[9]=t[9]*i,o[10]=t[10]*i,o[11]=t[11]*i,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}let m=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,p=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class F{constructor(t){this.gl_=t,this.program_=L(t,p,m),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,r,i,o,a,n,s,l,u,h,_,c){var d,E,T,f,g,m,p;let F,v,L,b,S,D,U,P,M,y,G,C,I=this.gl_;void 0===s&&(s=i),void 0===l&&(l=o),void 0===a&&(a=e),void 0===n&&(n=r),void 0===u&&(u=a),void 0===h&&(h=n),void 0===_&&(_=I.canvas.width),void 0===c&&(c=I.canvas.height),I.bindTexture(I.TEXTURE_2D,t),I.useProgram(this.program_),I.bindBuffer(I.ARRAY_BUFFER,this.positionBuffer),I.enableVertexAttribArray(this.positionLocation),I.vertexAttribPointer(this.positionLocation,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,this.texcoordBuffer),I.enableVertexAttribArray(this.texcoordLocation),I.vertexAttribPointer(this.texcoordLocation,2,I.FLOAT,!1,0,0);let X=R(0,_,0,c,-1,1);d=X,E=s,T=l,d===(f=f??x())?(f[12]=d[0]*E+d[4]*T+0*d[8]+d[12],f[13]=d[1]*E+d[5]*T+0*d[9]+d[13],f[14]=d[2]*E+d[6]*T+0*d[10]+d[14],f[15]=d[3]*E+d[7]*T+0*d[11]+d[15]):(F=d[0],v=d[1],L=d[2],b=d[3],S=d[4],D=d[5],U=d[6],P=d[7],M=d[8],y=d[9],G=d[10],C=d[11],f[0]=F,f[1]=v,f[2]=L,f[3]=b,f[4]=S,f[5]=D,f[6]=U,f[7]=P,f[8]=M,f[9]=y,f[10]=G,f[11]=C,f[12]=F*E+S*T+0*M+d[12],f[13]=v*E+D*T+0*y+d[13],f[14]=L*E+U*T+0*G+d[14],f[15]=b*E+P*T+0*C+d[15]),X=A(X=f,u,h,1),I.uniformMatrix4fv(this.matrixLocation,!1,X);let w=(g=i/e,m=o/r,(p=p??x())[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=g,p[13]=m,p[14]=0,p[15]=1,p);w=A(w,a/e,n/r,1),I.uniformMatrix4fv(this.textureMatrixLocation,!1,w),I.uniform1i(this.textureLocation,0),I.drawArrays(I.TRIANGLES,0,this.positions.length/2)}}function v(t,e,r){let i=t.createShader(e);if(null===i)throw Error("Shader compilation failed");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){let e=t.getShaderInfoLog(i);if(null===e)throw Error("Shader info log creation failed");throw Error(e)}return i}function L(t,e,r){let i=t.createProgram(),o=v(t,t.VERTEX_SHADER,r),a=v(t,t.FRAGMENT_SHADER,e);if(null===i)throw Error("Program creation failed");if(t.attachShader(i,o),t.attachShader(i,a),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){if(null===t.getProgramInfoLog(i))throw Error("Program info log creation failed");throw Error()}return i}let b=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,S=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,D=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,U=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`,P=[];class M extends l.Ay{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=void 0!==t.renderEdges&&t.renderEdges,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,r=e.getExtent(),i=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?i?(0,c._N)(r,i):r:i;const o=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),a=this.targetTileGrid_.getExtent();let n=this.sourceTileGrid_.getExtent();const s=a?(0,c._N)(o,a):o;if(0===(0,c.UG)(s)){this.state=u.A.EMPTY;return}r&&(n=n?(0,c._N)(n,r):r);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,_=(0,E.aY)(e,h,s,l);if(!isFinite(_)||_<=0){this.state=u.A.EMPTY;return}const g=void 0!==t.errorThreshold?t.errorThreshold:f.l;if(this.triangulation_=new T.A(e,h,s,n,_*g,l,t.transformMatrix),0===this.triangulation_.getTriangles().length){this.state=u.A.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(_);let x=this.triangulation_.calculateSourceExtent();if(n&&(e.canWrapX()?(x[1]=(0,d.qE)(x[1],n[1],n[3]),x[3]=(0,d.qE)(x[3],n[1],n[3])):x=(0,c._N)(x,n)),(0,c.UG)(x)){let i=0,o=0;e.canWrapX()&&(i=(0,c.RG)(r),o=Math.floor((x[0]-r[0])/i)),(0,c.QJ)(x.slice(),e,!0).forEach(e=>{let r=this.sourceTileGrid_.getTileRangeForExtentAndZ(e,this.sourceZ_),a=t.getTileFunction;for(let t=r.minX;t<=r.maxX;t++)for(let e=r.minY;e<=r.maxY;e++){let r=a(this.sourceZ_,t,e,this.pixelRatio_);if(r){let t=o*i;this.sourceTiles_.push({tile:r,offset:t})}}++o}),0===this.sourceTiles_.length&&(this.state=u.A.EMPTY)}else this.state=u.A.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){var t;let e,r,o,a,n=[],s=!1;if(this.sourceTiles_.forEach(t=>{let e,r=t.tile;if(!r||r.getState()!==u.A.LOADED)return;let i=r.getSize(),o=this.gutter_,a=(0,l.bL)(r.getData());a?e=a:(s=!0,e=(0,l.$r)((0,l.xo)(r.getData())));let h=[i[0]+2*o,i[1]+2*o],_=e instanceof Float32Array,c=h[0]*h[1],d=_?Float32Array:Uint8ClampedArray,E=new d(e.buffer),T=d.BYTES_PER_ELEMENT,f=T*E.length/c,g=Math.floor(E.byteLength/h[1]/T/h[0]),x=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);x[0]+=t.offset,x[2]+=t.offset;let R=this.clipExtent_?.slice();R&&(R[0]+=t.offset,R[2]+=t.offset),n.push({extent:x,clipExtent:R,data:E,dataType:d,bytesPerPixel:f,pixelSize:h,bandCount:g})}),this.sourceTiles_.length=0,0===n.length){this.state=u.A.ERROR,this.changed();return}let h=this.wrappedTileCoord_[0],_=this.targetTileGrid_.getTileSize(h),d="number"==typeof _?_:_[0],E="number"==typeof _?_:_[1],T=Math.round(d*this.pixelRatio_),f=Math.round(E*this.pixelRatio_),x=this.targetTileGrid_.getResolution(h),A=this.sourceTileGrid_.getResolution(this.sourceZ_),m=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),p=n[0].bandCount,v=new n[0].dataType(p*T*f),M=(t={premultipliedAlpha:!1,antialias:!1},o=P&&P.length?P.shift():g.Wl?new OffscreenCanvas(T||300,f||300):document.createElement("canvas"),T&&(o.width=T),f&&(o.height=f),o.getContext("webgl",t)),y=M.RGBA;n[0].dataType==Float32Array?(r=M.FLOAT,M.getExtension("WEBGL_color_buffer_float"),M.getExtension("OES_texture_float"),M.getExtension("EXT_float_blend"),e=null!==M.getExtension("OES_texture_float_linear")&&this.interpolate):(r=M.UNSIGNED_BYTE,e=this.interpolate);let G=Math.ceil(p/4);for(let t=G-1;t>=0;--t){let i=[];for(let o=0,a=n.length;o<a;++o){let a=n[o],s=a.pixelSize,l=s[0],u=s[1],h=new a.dataType(4*l*u),_=a.data,c=4*t;for(let t=0,e=h.length;t<e;t+=4)h[t]=_[c],h[t+1]=_[c+1],h[t+2]=_[c+2],h[t+3]=_[c+3],c+=p;let d=M.createTexture();M.bindTexture(M.TEXTURE_2D,d),e?(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.LINEAR)):(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST)),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texImage2D(M.TEXTURE_2D,0,y,l,u,0,y,r,h),i.push({extent:a.extent,clipExtent:a.clipExtent,texture:d,width:l,height:u})}let{framebuffer:o,width:a,height:s}=function(t,e,r,i,o,a,n,s,l,u,h,_,d,E){let T,f,g,x,A,m=Math.round(i*e),p=Math.round(i*r);if(t.canvas.width=m,t.canvas.height=p,f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,f),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),d?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,m,p,0,t.RGBA,h,null),T=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,T),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0),null===T)throw Error("Could not create framebuffer");if(null===f)throw Error("Could not create texture");if(0===l.length)return{width:m,height:p,framebuffer:T,texture:f};let v=(0,c.S5)();l.forEach(function(t,e,r){(0,c.X$)(v,t.extent)});let P=1/o;{if(g=t.createTexture(),null===f)throw Error("Could not create texture");x=Math.round((0,c.RG)(v)*P),A=Math.round((0,c.Oq)(v)*P);let e=t.getParameter(t.MAX_TEXTURE_SIZE),r=Math.max(x,A),i=r>e?e/r:1,o=Math.round(x*i),a=Math.round(A*i);t.bindTexture(t.TEXTURE_2D,g),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),d?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,o,a,0,t.RGBA,h,null);let n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,g,0);let s=new F(t);l.forEach(function(e,r,l){let h=(e.extent[0]-v[0])*P*i,_=-(e.extent[3]-v[3])*P*i,E=(0,c.RG)(e.extent)*P*i,T=(0,c.Oq)(e.extent)*P*i;if(t.bindFramebuffer(t.FRAMEBUFFER,n),t.viewport(0,0,o,a),e.clipExtent){let r=(e.clipExtent[0]-v[0])*P*i,o=-(e.clipExtent[3]-v[3])*P*i,a=(0,c.RG)(e.clipExtent)*P*i,n=(0,c.Oq)(e.clipExtent)*P*i;t.enable(t.SCISSOR_TEST),t.scissor(d?r:Math.round(r),d?o:Math.round(o),d?a:Math.round(r+a)-Math.round(r),d?n:Math.round(o+n)-Math.round(o))}s.drawImage(e.texture,e.width,e.height,u,u,e.width-2*u,e.height-2*u,d?h:Math.round(h),d?_:Math.round(_),d?E:Math.round(h+E)-Math.round(h),d?T:Math.round(_+T)-Math.round(_),o,a),t.disable(t.SCISSOR_TEST)}),t.deleteFramebuffer(n)}let M=(0,c.Py)(n),y=(0,c.Py)(v),G=t=>{let e=(t[0][0]-M[0])/a*i,r=-(t[0][1]-M[1])/a*i,o=(t[1][0]-M[0])/a*i,n=-(t[1][1]-M[1])/a*i;return{u1:o,v1:n,u0:e,v0:r,u2:(t[2][0]-M[0])/a*i,v2:-(t[2][1]-M[1])/a*i}};t.bindFramebuffer(t.FRAMEBUFFER,T),t.viewport(0,0,m,p);{let e=[],r=[],i=L(t,U,D);t.useProgram(i);let a=t.getUniformLocation(i,"u_texture");t.bindTexture(t.TEXTURE_2D,g),t.uniform1i(a,0),s.getTriangles().forEach(function(t,i,a){let n=t.source,{u1:s,v1:l,u0:u,v0:h,u2:_,v2:c}=G(t.target),d=(n[0][0]-y[0])/o/x,E=-(n[0][1]-y[1])/o/A,T=(n[1][0]-y[0])/o/x,f=-(n[1][1]-y[1])/o/A,g=(n[2][0]-y[0])/o/x,R=-(n[2][1]-y[1])/o/A;e.push(s,l,u,h,_,c),r.push(T,f,d,E,g,R)});let n=R(0,m,p,0,-1,1),l=t.getUniformLocation(i,"u_matrix");t.uniformMatrix4fv(l,!1,n);let u=t.getAttribLocation(i,"a_position"),h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u);let _=t.getAttribLocation(i,"a_texcoord"),c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.vertexAttribPointer(_,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(_),t.drawArrays(t.TRIANGLES,0,e.length/2)}if(_){let e=L(t,S,b);t.useProgram(e);let r=R(0,m,p,0,-1,1),i=t.getUniformLocation(e,"u_matrix");t.uniformMatrix4fv(i,!1,r);let o=Array.isArray(_)?_:[0,0,0,255],a=t.getUniformLocation(e,"u_val");t.uniform4fv(a,o);let n=t.getAttribLocation(e,"a_position"),l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n);let u=s.getTriangles().reduce(function(t,e){let{u1:r,v1:i,u0:o,v0:a,u2:n,v2:s}=G(e.target);return t.concat([r,i,o,a,o,a,n,s,n,s,r,i])},[]);t.bufferData(t.ARRAY_BUFFER,new Float32Array(u),t.STATIC_DRAW),t.drawArrays(t.LINES,0,u.length/2)}return{width:m,height:p,framebuffer:T,texture:f}}(M,d,E,this.pixelRatio_,A,x,m,this.triangulation_,i,this.gutter_,r,this.renderEdges_,e),l=4*s,u=new n[0].dataType(a*l);M.bindFramebuffer(M.FRAMEBUFFER,o),M.readPixels(0,0,a,s,M.RGBA,r,u);let h=4*t;for(let t=0,e=u.length;t<e;t+=4){let e=(a-1-(t/l|0))*l+t%l;v[h]=u[e],v[h+1]=u[e+1],v[h+2]=u[e+2],v[h+3]=u[e+3],h+=p}}if((a=M.canvas).width=1,a.height=1,M.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT|M.STENCIL_BUFFER_BIT),P.push(M.canvas),s){let t=(0,i.Y)(d,E),e=new ImageData(v,d);t.putImageData(e,0,0),this.reprojData_=t.canvas}else this.reprojData_=v;this.reprojSize_=[T,f],this.state=u.A.LOADED,this.changed()}load(){if(this.state!==u.A.IDLE&&this.state!==u.A.ERROR)return;this.state=u.A.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{let r=e.getState();if(r!==u.A.IDLE&&r!==u.A.LOADING)return;t++;let i=(0,_.KT)(e,o.A.CHANGE,()=>{let r=e.getState();(r==u.A.LOADED||r==u.A.ERROR||r==u.A.EMPTY)&&((0,_.JH)(i),0==--t&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==u.A.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(_.JH),this.sourcesListenerKeys_=null}}var y=r(47439),G=r(16541),C=r(58222),I=r(19804),X=r(22664);class w extends I.A{constructor(t){const e=void 0===t.projection?"EPSG:3857":t.projection;let r=t.tileGrid;void 0===r&&e&&(r=(0,G.EN)({extent:(0,G.kZ)(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:r,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.tileSize_=t.tileSize?(0,n.xq)(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===t.bandCount?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;let e=this.getTileGrid();return e?(0,n.xq)(e.getTileSize(t)):[256,256]}getGutterForProjection(t){let e=this.getProjection();return(!e||(0,a.tI)(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,r,i,o,a){let s=this.tileGrid||this.getTileGridForProjection(o||i),l=Math.max.apply(null,s.getResolutions().map((t,e)=>{let r=(0,n.xq)(s.getTileSize(e)),i=this.getTileSize(e);return Math.max(i[0]/r[0],i[1]/r[1])})),u=this.getTileGridForProjection(i),h=[t,e,r],_=this.getTileCoordForTileUrlFunction(h,i),c=new M(Object.assign({sourceProj:o||i,sourceTileGrid:s,targetProj:i,targetTileGrid:u,tileCoord:h,wrappedTileCoord:_,pixelRatio:l,gutter:this.gutter_,getTileFunction:(t,e,r,i)=>this.getTile(t,e,r,i,void 0,a),transformMatrix:this.transformMatrix},this.tileOptions));return c.key=this.getKey(),c}getTile(t,e,r,i,n,s){let u=this.getProjection();if(n&&(u&&!(0,a.tI)(u,n)||this.transformMatrix))return this.getReprojTile_(t,e,r,n,u,s);let _=this.getTileSize(t),c=this.loader_,d=new AbortController,E={signal:d.signal,crossOrigin:this.crossOrigin_},T=this.getTileCoordForTileUrlFunction([t,e,r]);if(!T)return null;let f=this.getKey(),g=(0,y.et)(this,f,t,e,r);if(s&&s.containsKey(g))return s.get(g);let x=T[0],R=T[1],A=T[2],m=this.getTileGrid()?.getFullTileRange(x);m&&(E.maxY=m.getHeight()-1);let p=Object.assign({tileCoord:[t,e,r],loader:function(){return(0,h.hq)(function(){return c(x,R,A,E)})},size:_,controller:d},this.tileOptions),F=new l.Ay(p);return F.key=this.getKey(),F.addEventListener(o.A.CHANGE,this.handleTileChange_),s?.set(g,F),F}handleTileChange_(t){let e,r=t.target,i=(0,C.v6)(r),o=r.getState();o==u.A.LOADING?(this.tileLoadingKeys_[i]=!0,e=X.A.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],e=o==u.A.ERROR?X.A.TILELOADERROR:o==u.A.LOADED?X.A.TILELOADEND:void 0),e&&this.dispatchEvent(new I.c(e,r))}getTileGridForProjection(t){let e=this.getProjection();if(this.tileGrid&&(!e||(0,a.tI)(e,t))&&!this.transformMatrix)return this.tileGrid;let r=(0,C.v6)(t);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=(0,G.pr)(t)),this.tileGridForProjection_[r]}setTileGridForProjection(t,e){let r=(0,a.Jt)(t);if(r){let t=(0,C.v6)(r);t in this.tileGridForProjection_||(this.tileGridForProjection_[t]=e)}}}let O=w,B=Error("Image failed to load");function j(t,e,r,i,o){return new Promise((a,n)=>{let l=new Image;l.crossOrigin=o.crossOrigin??null,l.addEventListener("load",()=>a(l)),l.addEventListener("error",()=>n(B)),l.src=(0,s.M)(t,e,r,i,o.maxY)})}function N(t){return function(e,r,i,o){return j((0,s.de)(t,e,r,i),e,r,i,o)}}function z(t){let e;if(Array.isArray(t))e=N(t);else if("string"==typeof t)e=N((0,s.Uu)(t));else if("function"==typeof t)e=function(e,r,i,o){return j(t(e,r,i,o),e,r,i,o)};else throw Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let Y=0;function W(t){return Array.isArray(t)?t.join("\n"):"string"==typeof t?t:"url-function-key-"+ ++Y}class Z extends O{constructor(t){let e,r=(t=t||{}).loader;t.url&&(r=z(t.url),e=W(t.url));const i=r?t.state:"loading",o=void 0===t.wrapX||t.wrapX;super({loader:r,key:e,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize,gutter:t.gutter,maxResolution:t.maxResolution,projection:t.projection,tileGrid:t.tileGrid,state:i,wrapX:o,transition:t.transition,interpolate:!1!==t.interpolate,crossOrigin:t.crossOrigin,zDirection:t.zDirection})}setUrl(t){let e=z(t);this.setLoader(e),this.setKey(W(t)),"ready"!==this.getState()&&this.setState("ready")}}let k=Z;class K extends k{constructor(t){const e=(t=t||{}).template||"z:{z} x:{x} y:{y}",r=t.source,l=t.color||"grey";super({transition:0,wrapX:void 0!==t.wrapX?t.wrapX:void 0!==r?r.getWrapX():void 0});const u=()=>{this.projection=void 0!==t.projection?(0,a.Jt)(t.projection):void 0!==r?r.getProjection():this.projection,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:void 0!==r?r.getTileGrid():this.tileGrid,this.zDirection=void 0!==t.zDirection?t.zDirection:void 0!==r?r.zDirection:this.zDirection,r instanceof O&&(this.transformMatrix=r.transformMatrix?.slice()||null);let o=this.tileGrid;o&&this.setTileSizes(o.getResolutions().map((t,e)=>(0,n.xq)(o.getTileSize(e)).map(t=>Math.max(Math.floor(t),1)))),this.setLoader((t,r,o,a)=>{let n=(0,s.M)(e,t,r,o,a.maxY),[u,h]=this.getTileSize(t),_=(0,i.Y)(u,h);return _.strokeStyle=l,_.strokeRect(.5,.5,u+.5,h+.5),_.fillStyle=l,_.strokeStyle="white",_.textAlign="center",_.textBaseline="middle",_.font="24px sans-serif",_.lineWidth=4,_.strokeText(n,u/2,h/2,u),_.fillText(n,u/2,h/2,u),Promise.resolve(_.canvas)}),this.setState("ready")};if(void 0===r||"ready"===r.getState())u();else{const t=()=>{"ready"===r.getState()&&(r.removeEventListener(o.A.CHANGE,t),u())};r.addEventListener(o.A.CHANGE,t)}}}let H=K}}]);