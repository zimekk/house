"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1130],{3910:(e,t,i)=>{i.d(t,{A:()=>A});var s=i(66350),r=i(51752),n=i(46640),o=i(70128);let a="unsnap";class h extends o.Ay{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature,this.segment=t.segment}}var l=i(14139),d=i(92194),g=i(46187),u=i(35342),c=i(57435),_=i(8679),f=i(99127),p=i(59793),m=i(72115),y=i(58222),C=i(27900);let x={Circle(e,t){let i=e,s=(0,f.Tf)();s&&(i=i.clone().transform(s,t));let r=(0,u.nD)(i);return s&&r.transform(t,s),x.Polygon(r)},GeometryCollection(e,t){let i=[],s=e.getGeometriesArray();for(let e=0;e<s.length;++e){let r=this[s[e].getType()];r&&i.push(r(s[e],t))}return i.flat()},LineString(e){let t=[],i=e.getFlatCoordinates(),s=e.getStride();for(let e=0,r=i.length-s;e<r;e+=s)t.push([i.slice(e,e+2),i.slice(e+s,e+s+2)]);return t},MultiLineString(e){let t=[],i=e.getFlatCoordinates(),s=e.getStride(),r=e.getEnds(),n=0;for(let e=0,o=r.length;e<o;++e){let o=r[e];for(let e=n,r=o-s;e<r;e+=s)t.push([i.slice(e,e+2),i.slice(e+s,e+s+2)]);n=o}return t},MultiPoint(e){let t=[],i=e.getFlatCoordinates(),s=e.getStride();for(let e=0,r=i.length;e<r;e+=s)t.push([i.slice(e,e+2)]);return t},MultiPolygon(e){let t=[],i=e.getFlatCoordinates(),s=e.getStride(),r=e.getEndss(),n=0;for(let e=0,o=r.length;e<o;++e){let o=r[e];for(let e=0,r=o.length;e<r;++e){let r=o[e];for(let e=n,o=r-s;e<o;e+=s)t.push([i.slice(e,e+2),i.slice(e+s,e+s+2)]);n=r}}return t},Point:e=>[[e.getFlatCoordinates().slice(0,2)]],Polygon(e){let t=[],i=e.getFlatCoordinates(),s=e.getStride(),r=e.getEnds(),n=0;for(let e=0,o=r.length;e<o;++e){let o=r[e];for(let e=n,r=o-s;e<r;e+=s)t.push([i.slice(e,e+2),i.slice(e+s,e+s+2)]);n=o}return t}};function v(e){return e.feature?e.feature:e.element?e.element:null}let P=[],F=[],T=[];class S extends C.A{constructor(e){e=e||{},super({handleDownEvent:g.rT,stopDown:g.W8}),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=void 0===e.vertex||e.vertex,this.edge_=void 0===e.edge||e.edge,this.intersection_=void 0!==e.intersection&&e.intersection,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.rBush_=new m.A,this.snapped_=null,this.segmenters_=Object.assign({},x,e.segmenters)}addFeature(e,t){t=void 0===t||t;let i=(0,y.v6)(e),s=e.getGeometry();if(s){let t=this.segmenters_[s.getType()];if(t){this.indexedFeaturesExtents_[i]=s.getExtent((0,d.S5)());let r=t.call(this.segmenters_,s,this.getMap().getView().getProjection()),n=r.length;for(let t=0;t<n;++t){let i=r[t];F[t]=(0,d.Tr)(i),T[t]={feature:e,segment:i}}if(this.intersection_)for(let t=0,i=r.length;t<i;++t){let i=r[t];if(1===i.length)continue;let s=F[t];for(let o=0,a=t-1;o<a;++o){let t=r[o];if(!(0,d.HY)(s,F[o]))continue;let a=(0,c.i)(i,t);if(!a)continue;let h=[a];F[n]=(0,d.Tr)(h),T[n++]={feature:e,intersectionFeature:e,segment:h}}let o=this.rBush_.getInExtent(F[t]);for(let t=0,s=o.length;t<s;++t){let s=o[t].segment;if(1===s.length)continue;let r=(0,c.i)(i,s);if(!r)continue;let a=[r];F[n]=(0,d.Tr)(a),T[n++]={feature:e,intersectionFeature:o[t].feature,segment:a}}}1===n?this.rBush_.insert(F[0],T[0]):(F.length=n,T.length=n,this.rBush_.load(F,T))}}t&&(this.featureChangeListenerKeys_[i]&&(0,l.JH)(this.featureChangeListenerKeys_[i]),this.featureChangeListenerKeys_[i]=(0,l.KT)(e,n.A.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}areSnapDataEqual_(e,t){return e.segment===t.segment&&e.feature===t.feature}handleEvent(e){let t=this.snapTo(e.pixel,e.coordinate,e.map);return t?(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.snapped_&&!this.areSnapDataEqual_(this.snapped_,t)&&this.dispatchEvent(new h(a,this.snapped_)),this.snapped_={vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment},this.dispatchEvent(new h("snap",this.snapped_))):this.snapped_&&(this.dispatchEvent(new h(a,this.snapped_)),this.snapped_=null),super.handleEvent(e)}handleFeatureAdd_(e){let t=v(e);t&&this.addFeature(t)}handleFeatureRemove_(e){let t=v(e);t&&(this.removeFeature(t),delete this.pendingFeatures_[(0,y.v6)(t)])}handleFeatureChange_(e){let t=e.target;this.handlingDownUpSequence?this.pendingFeatures_[(0,y.v6)(t)]=t:this.updateFeature_(t)}handleUpEvent(e){let t=Object.values(this.pendingFeatures_);if(t.length){for(let e of t)this.updateFeature_(e);(0,_.I)(this.pendingFeatures_)}return!1}removeFeature(e,t){let i=(0,y.v6)(e),s=this.indexedFeaturesExtents_[i];if(s){let t=this.rBush_;t.getInExtent(s).forEach(i=>{(e===i.feature||e===i.intersectionFeature)&&t.remove(i)})}(void 0===t||t)&&((0,l.JH)(this.featureChangeListenerKeys_[i]),delete this.featureChangeListenerKeys_[i])}setMap(e){let t=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();if(Array.isArray(r)||(r=r.getArray()),t&&(i.forEach(l.JH),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(l.JH),this.featureChangeListenerKeys_={}),super.setMap(e),e)for(let e of(this.features_?i.push((0,l.KT)(this.features_,s.A.ADD,this.handleFeatureAdd_,this),(0,l.KT)(this.features_,s.A.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,l.KT)(this.source_,p.A.ADDFEATURE,this.handleFeatureAdd_,this),(0,l.KT)(this.source_,p.A.REMOVEFEATURE,this.handleFeatureRemove_,this)),r))this.addFeature(e)}snapTo(e,t,i){let s,n,o=i.getView().getProjection(),a=(0,f.Ad)(t,o),h=(0,f.JR)((0,d.r)((0,d.Tr)([a]),i.getView().getResolution()*this.pixelTolerance_),o),l=this.rBush_.getInExtent(h),g=l.length;if(0===g)return null;let u=1/0,c=null,_=this.pixelTolerance_*this.pixelTolerance_,p=()=>{if(!s)return null;let t=i.getPixelFromCoordinate(s);return(0,r.hG)(e,t)>_?null:{vertex:s,vertexPixel:[Math.round(t[0]),Math.round(t[1])],feature:n,segment:c}};if(this.vertex_||this.intersection_){for(let e=0;e<g;++e){let t=l[e];if("Circle"!==t.feature.getGeometry().getType())for(let e of t.segment){let i=(0,f.Ad)(e,o),h=(0,r.hG)(a,i);h<u&&(this.intersection_&&t.intersectionFeature||this.vertex_&&!t.intersectionFeature)&&(s=e,u=h,n=t.feature)}}let e=p();if(e)return e}if(this.edge_){for(let e=0;e<g;++e){let t=null,i=l[e];if("Circle"===i.feature.getGeometry().getType()){let e=i.feature.getGeometry(),s=(0,f.Tf)();s&&(e=e.clone().transform(s,o)),t=(0,r.hw)(a,e)}else{let[e,s]=i.segment;s&&(P[0]=(0,f.Ad)(e,o),P[1]=(0,f.Ad)(s,o),t=(0,r.sG)(a,P))}if(t){let e=(0,r.hG)(a,t);e<u&&(s=(0,f.te)(t,o),c="Circle"===i.feature.getGeometry().getType()?null:i.segment,u=e,n=i.feature)}}let e=p();if(e)return e}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}}let A=S},4045:(e,t,i)=>{i.d(t,{A:()=>L});var s=i(51630),r=i(66350),n=i(23504),o=i(79416),a=i(47447),h=i(51752),l=i(70128),d=i(46640),g=i(57777),u=i(92194),c=i(52667),_=i(35342),f=i(34531),p=i(99127),m=i(83639),y=i(59793),C=i(72115),x=i(92645),v=i(58222),P=i(27900),F=i(36115);let T=[0,0,0,0],S=[],A="modifyend";function w(e,t,i){let s;switch(t){case"LineString":s=e;break;case"MultiLineString":case"Polygon":s=e[i[0]];break;case"MultiPolygon":s=e[i[1]][i[0]]}return s}class M extends l.Ay{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class E extends P.A{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:g.fs,this.defaultDeleteCondition_=function(e){return(0,g.Js)(e)&&(0,g.t5)(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:g.Gk,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new C.A,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new f.A({source:new m.A({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:function(){let e=(0,x.mY)();return function(t,i){return e.Point}}(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new s.A(this.source_.getFeatures()),this.source_.addEventListener(y.A.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(y.A.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(r.A.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(r.A.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;t=e?!0===e?g.Gk:e:g.Zm,this.traceCondition_=t}addFeature_(e){let t=e.getGeometry();if(t){let i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}let i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(d.A.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new s.A;let i=this.featuresBeingModified_.getArray();for(let e=0,s=t.length;e<s;++e){let s=t[e].feature;s&&!i.includes(s)&&this.featuresBeingModified_.push(s)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new M("modifystart",this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(d.A.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){let t=this.rBush_,i=[];t.forEach(function(t){e===t.feature&&i.push(t)});for(let e=i.length-1;e>=0;--e){let s=i[e];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===s&&this.dragSegments_.splice(e,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){let t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){let i=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,geometry:t,segment:[i,i]})}writeMultiPointGeometry_(e,t){let i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){let r=i[s],n={feature:e,geometry:t,depth:[s],index:s,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)}}writeLineStringGeometry_(e,t){let i=t.getCoordinates();for(let s=0,r=i.length-1;s<r;++s){let r=i.slice(s,s+2),n={feature:e,geometry:t,index:s,segment:r};this.rBush_.insert((0,u.Tr)(r),n)}}writeMultiLineStringGeometry_(e,t){let i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){let r=i[s];for(let i=0,n=r.length-1;i<n;++i){let n=r.slice(i,i+2),o={feature:e,geometry:t,depth:[s],index:i,segment:n};this.rBush_.insert((0,u.Tr)(n),o)}}}writePolygonGeometry_(e,t){let i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){let r=i[s];for(let i=0,n=r.length-1;i<n;++i){let n=r.slice(i,i+2),o={feature:e,geometry:t,depth:[s],index:i,segment:n};this.rBush_.insert((0,u.Tr)(n),o)}}}writeMultiPolygonGeometry_(e,t){let i=t.getCoordinates();for(let s=0,r=i.length;s<r;++s){let r=i[s];for(let i=0,n=r.length;i<n;++i){let n=r[i];for(let r=0,o=n.length-1;r<o;++r){let o=n.slice(r,r+2),a={feature:e,geometry:t,depth:[i,s],index:r,segment:o};this.rBush_.insert((0,u.Tr)(o),a)}}}}writeCircleGeometry_(e,t){let i=t.getCenter(),s={feature:e,geometry:t,index:0,segment:[i,i]},r={feature:e,geometry:t,index:1,segment:[i,i]},n=[s,r];s.featureSegments=n,r.featureSegments=n,this.rBush_.insert((0,u.dP)(i),s);let o=t,a=(0,p.Tf)();if(a&&this.getMap()){let e=this.getMap().getView().getProjection();o=o.clone().transform(a,e),o=(0,_.nD)(o).transform(e,a)}this.rBush_.insert(o.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){let i=t.getGeometriesArray();for(let t=0;t<i.length;++t){let s=i[t];(0,this.SEGMENT_WRITERS_[s.getType()])(e,s)}}createOrUpdateVertexFeature_(e,t,i,s){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new n.A(new c.A(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r.set("existing",s),r}handleEvent(e){let t;return!e.originalEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=o.A.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=e.type==o.A.SINGLECLICK&&!!this.ignoreNextSingleClick_||this.removePoint()),e.type==o.A.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t)}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;let t=this.getMap().getView().getProjection(),i=[],s=this.vertexFeature_.getGeometry().getCoordinates(),r=(0,u.Tr)([s]),n=this.rBush_.getInExtent(r),o={};n.sort(G);for(let r=0,a=n.length;r<a;++r){let a=n[r],l=a.segment,d=(0,v.v6)(a.geometry),g=a.depth;if(g&&(d+="-"+g.join("-")),o[d]||(o[d]=[,,]),"Circle"===a.geometry.getType()&&1===a.index){let i=I(e,a,t);(0,h.aI)(i,s)&&!o[d][0]&&(this.dragSegments_.push([a,0]),o[d][0]=a);continue}if((0,h.aI)(l[0],s)&&!o[d][0]){this.dragSegments_.push([a,0]),o[d][0]=a;continue}if((0,h.aI)(l[1],s)&&!o[d][1]){if(o[d][0]&&0===o[d][0].index){let e=a.geometry.getCoordinates();switch(a.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[g[1]];case"Polygon":if(a.index!==e[g[0]].length-2)continue}}this.dragSegments_.push([a,1]),o[d][1]=a;continue}(0,v.v6)(l)in this.vertexSegments_&&!o[d][0]&&!o[d][1]&&i.push(a)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){let t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex){let i=e.map.getPixelFromCoordinate(t.startCoord);if((0,h.Io)(i,e.pixel)<this.pixelTolerance_)return}let i=(0,F.kh)(e.coordinate,t,e.map,this.pixelTolerance_);if(!(-1===t.targetIndex&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)){if(t.targetIndex!==i.index){if(-1!==t.targetIndex){let e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}else for(let e of this.traceSegments_){let t=e[0],i=t.geometry,s=e[1],r=i.getCoordinates();w(r,i.getType(),t.depth).splice(t.index+s,1),i.setCoordinates(r),0===s&&(t.index-=1)}let e=t.targets[i.index];this.addTracedCoordinates_(e,e.startIndex,i.endIndex)}else{let e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,i.endIndex)}t.targetIndex=i.index,t.targets[t.targetIndex].endIndex=i.endIndex}}getTraceCandidates_(e){let t=this.getMap(),i=this.pixelTolerance_,s=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),r=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),n=(0,u.Tr)([s,r]);return this.traceSource_.getFeaturesInExtent(n)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}let t=this.getTraceCandidates_(e);if(0===t.length)return;let i=(0,F.EW)(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){let i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){let s=Math.floor(t);s===t&&(s-=1),i=s-Math.ceil(e)+1}else{let s=Math.ceil(t);s===t&&(s+=1),i=Math.floor(e)-s+1}if(i>0)for(let e of this.traceSegments_){let t=e[0],s=t.geometry,r=e[1],n=e[0].index+1;1===r&&(n-=i);let o=s.getCoordinates();w(o,s.getType(),t.depth).splice(n,i),s.setCoordinates(o),1===r&&(t.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;let s=[];if(t<i){let r=Math.ceil(t),n=Math.floor(i);n===i&&(n-=1);for(let t=r;t<=n;++t)s.push((0,F.Hx)(e.coordinates,t))}else{let r=Math.floor(t),n=Math.ceil(i);n===i&&(n+=1);for(let t=r;t>=n;--t)s.push((0,F.Hx)(e.coordinates,t))}if(s.length)for(let e of this.traceSegments_){let t=e[0],i=t.geometry,r=e[1],n=t.index+1;0===r&&s.reverse();let o=i.getCoordinates();w(o,i.getType(),t.depth).splice(n,0,...s),i.setCoordinates(o),1===r&&(t.index+=s.length)}}updateGeometry_(e,t){let i,s=t[0],r=s.depth,n=s.segment,o=s.geometry,a=t[1];for(;e.length<o.getStride();)e.push(n[a][e.length]);switch(o.getType()){case"Point":i=e,n[0]=e,n[1]=e;break;case"MultiPoint":(i=o.getCoordinates())[s.index]=e,n[0]=e,n[1]=e;break;case"LineString":(i=o.getCoordinates())[s.index+a]=e,n[a]=e;break;case"MultiLineString":case"Polygon":(i=o.getCoordinates())[r[0]][s.index+a]=e,n[a]=e;break;case"MultiPolygon":(i=o.getCoordinates())[r[1]][r[0]][s.index+a]=e,n[a]=e;break;case"Circle":if(n[0]=e,n[1]=e,0===s.index)this.changingFeature_=!0,o.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;let t=this.getMap().getView().getProjection(),i=(0,h.Io)((0,p.Ad)(o.getCenter(),t),(0,p.Ad)(e,t)),s=(0,p.Tf)();if(s){let e=o.clone().transform(s,t);e.setRadius(i),i=e.transform(t,s).getRadius()}o.setRadius(i),this.changingFeature_=!1}}i&&this.setGeometryCoordinates_(o,i)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[],r=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(r)for(let t of(this.traceSegments_=[],this.dragSegments_)){let i=t[0];(0,h.Io)((0,h.sG)(r,i.segment),r)/e.map.getView().getResolution()<1&&this.traceSegments_.push(t)}for(let e=0,r=this.dragSegments_.length;e<r;++e){let r=this.dragSegments_[e],n=r[0],o=n.feature;i.includes(o)||i.push(o);let a=n.geometry;s.includes(a)||s.push(a),this.updateGeometry_(t,r)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;let t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){let e=this.vertexFeature_.getGeometry().getCoordinates();for(let t=i.length-1;t>=0;--t)this.insertVertex_(i[t],e);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){let i=this.dragSegments_[t][0],s=i.geometry;if("Circle"===s.getType()){let t=s.getCenter(),r=i.featureSegments[0],n=i.featureSegments[1];r.segment[0]=t,r.segment[1]=t,n.segment[0]=t,n.segment[1]=t,this.rBush_.update((0,u.dP)(t),r);let o=s,a=(0,p.Tf)();if(a){let t=e.map.getView().getProjection();o=o.clone().transform(a,t),o=(0,_.nD)(o).transform(t,a)}this.rBush_.update(o.getExtent(),n)}else this.rBush_.update((0,u.Tr)(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new M(A,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){let t,i,s=this.getMap(),r=s.getPixelFromCoordinate(e),o=s.getView().getProjection();if(this.hitDetection_){let e="object"==typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;s.forEachFeatureAtPixel(r,(e,s,r)=>{r&&"Point"===r.getType()&&(r=new c.A((0,p.te)(r.getCoordinates(),o)));let a=r||e.getGeometry();if(a&&"Point"===a.getType()&&e instanceof n.A&&this.features_.getArray().includes(e)){i=a;let s=e.getGeometry().getFlatCoordinates().slice(0,2);t=[{feature:e,geometry:i,segment:[s,s]}]}return!0},{layerFilter:e})}if(!t){let i=(0,p.SD)((0,u.dP)(e,T),o),r=s.getView().getResolution()*this.pixelTolerance_,n=(0,p.JR)((0,u.r)(i,r,T),o);t=this.rBush_.getInExtent(n)}if(t&&t.length>0){let n=t.sort(function(t,i){return k(e,t,o)-k(e,i,o)})[0],a=n.segment,l=I(e,n,o),d=s.getPixelFromCoordinate(l),g=(0,h.Io)(r,d);if(i||g<=this.pixelTolerance_){let i={};if(i[(0,v.v6)(a)]=!0,this.snapToPointer_||(this.delta_[0]=l[0]-e[0],this.delta_[1]=l[1]-e[1]),"Circle"===n.geometry.getType()&&1===n.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l,[n.feature],[n.geometry],this.snappedToVertex_);else{let e=s.getPixelFromCoordinate(a[0]),r=s.getPixelFromCoordinate(a[1]),o=(0,h.hG)(d,e),u=(0,h.hG)(d,r);if(g=Math.sqrt(Math.min(o,u)),this.snappedToVertex_=g<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(l=o>u?a[1]:a[0]),this.createOrUpdateVertexFeature_(l,[n.feature],[n.geometry],this.snappedToVertex_);let c={};c[(0,v.v6)(n.geometry)]=!0;for(let e=1,s=t.length;e<s;++e){let s=t[e].segment;if((0,h.aI)(a[0],s[0])&&(0,h.aI)(a[1],s[1])||(0,h.aI)(a[0],s[1])&&(0,h.aI)(a[1],s[0])){let r=(0,v.v6)(t[e].geometry);r in c||(c[r]=!0,i[(0,v.v6)(s)]=!0)}else break}}this.vertexSegments_=i;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){let i,s=e.segment,r=e.feature,n=e.geometry,o=e.depth,a=e.index;for(;t.length<n.getStride();)t.push(0);switch(n.getType()){case"MultiLineString":case"Polygon":(i=n.getCoordinates())[o[0]].splice(a+1,0,t);break;case"MultiPolygon":(i=n.getCoordinates())[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":(i=n.getCoordinates()).splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(n,i);let h=this.rBush_;h.remove(e),this.updateSegmentIndices_(n,a,o,1);let l={segment:[s[0],t],feature:r,geometry:n,depth:o,index:a};h.insert((0,u.Tr)(l.segment),l),this.dragSegments_.push([l,1]);let d={segment:[t,s[1]],feature:r,geometry:n,depth:o,index:a+1};return h.insert((0,u.Tr)(d.segment),d),this.dragSegments_.push([d,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){let e=this.vertexFeature_?.getGeometry().getCoordinates();return e?(0,p.te)(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,u.Tr)([e])).some(({segment:t})=>(0,h.aI)(t[0],e)||(0,h.aI)(t[1],e))}removePoint(e){if(e&&(e=(0,p.Ad)(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=o.A.POINTERDRAG){let e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map(([e])=>e));let t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new M(A,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){let e,t,i,s,r,n,o,a,h,l,d,g=this.dragSegments_,c={},_=!1;for(r=g.length-1;r>=0;--r)l=(i=g[r])[0],d=(0,v.v6)(l.feature),l.depth&&(d+="-"+l.depth.join("-")),d in c||(c[d]={}),0===i[1]?(c[d].right=l,c[d].index=l.index):1==i[1]&&(c[d].left=l,c[d].index=l.index+1);for(d in c){switch(h=c[d].right,o=c[d].left,(a=(n=c[d].index)-1)<0&&(a=0),e=t=(s=(l=void 0!==o?o:h).geometry).getCoordinates(),_=!1,s.getType()){case"MultiLineString":t[l.depth[0]].length>2&&(t[l.depth[0]].splice(n,1),_=!0);break;case"LineString":t.length>2&&(t.splice(n,1),_=!0);break;case"MultiPolygon":e=e[l.depth[1]];case"Polygon":(e=e[l.depth[0]]).length>4&&(n==e.length-1&&(n=0),e.splice(n,1),_=!0,0===n&&(e.pop(),e.push(e[0]),a=e.length-1))}if(_){this.setGeometryCoordinates_(s,t);let e=[];if(void 0!==o&&(this.rBush_.remove(o),e.push(o.segment[0])),void 0!==h&&(this.rBush_.remove(h),e.push(h.segment[1])),void 0!==o&&void 0!==h){let t={depth:l.depth,feature:l.feature,geometry:l.geometry,index:a,segment:e};this.rBush_.insert((0,u.Tr)(t.segment),t)}this.updateSegmentIndices_(s,n,l.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),g.length=0}}return _}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(e=>"Circle"===e.getType()||e.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,u.Tr)([e])).some(({segment:t})=>!((0,h.aI)(t[0],e)||(0,h.aI)(t[1],e)))}insertPoint(e){let t=e?(0,p.Ad)(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return!!t&&this.findInsertVerticesAndUpdateDragSegments_(t).reduce((e,i)=>e||this.insertVertex_(i,t),!1)}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(void 0===i||void 0===r.depth||(0,a.aI)(r.depth,i))&&r.index>t&&(r.index+=s)})}}function G(e,t){return e.index-t.index}function k(e,t,i){let s=t.geometry;if("Circle"===s.getType()){let r=s;if(1===t.index){let t=(0,p.Tf)();t&&(r=r.clone().transform(t,i));let s=Math.sqrt((0,h.hG)(r.getCenter(),(0,p.Ad)(e,i)))-r.getRadius();return s*s}}let r=(0,p.Ad)(e,i);return S[0]=(0,p.Ad)(t.segment[0],i),S[1]=(0,p.Ad)(t.segment[1],i),(0,h.$x)(r,S)}function I(e,t,i){let s=t.geometry;if("Circle"===s.getType()&&1===t.index){let t=s,r=(0,p.Tf)();return r&&(t=t.clone().transform(r,i)),(0,p.te)(t.getClosestPoint((0,p.Ad)(e,i)),i)}let r=(0,p.Ad)(e,i);return S[0]=(0,p.Ad)(t.segment[0],i),S[1]=(0,p.Ad)(t.segment[1],i),(0,p.te)((0,h.sG)(r,S),i)}let L=E},17563:(e,t,i)=>{i.d(t,{A:()=>f});var s=i(47447),r=i(92194),n=i(65084),o=i(22345),a=i(30220),h=i(21692),l=i(140),d=i(3764),g=i(63643),u=i(26121),c=i(79782);class _ extends o.Ay{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const t=[],i=[];for(let r=0,n=e.length;r<n;++r){const n=e[r];(0,s.X$)(t,n.getFlatCoordinates()),i.push(t.length)}const r=0===e.length?this.getLayout():e[0].getLayout();this.setFlatCoordinates(r,t),this.ends_=i}}appendLineString(e){(0,s.X$)(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let e=new _(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<(0,r.Ld)(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,a.HX)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,a.oW)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,s))}getCoordinateAtM(e,t,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(t=void 0!==t&&t,i=void 0!==i&&i,(0,d.L8)(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return(0,l.cD)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new n.A(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){let e=this.flatCoordinates,t=this.ends_,i=this.layout,s=[],r=0;for(let o=0,a=t.length;o<a;++o){let a=t[o],h=new n.A(e.slice(r,a),i);s.push(h),r=a}return s}getLength(){let e=this.ends_,t=0,i=0;for(let s=0,r=e.length;s<r;++s)i+=(0,u.k)(this.flatCoordinates,t,e[s],this.stride),t=e[s];return i}getFlatMidpoints(){let e=[],t=this.flatCoordinates,i=0,r=this.ends_,n=this.stride;for(let o=0,a=r.length;o<a;++o){let a=r[o],h=(0,d.SH)(t,i,a,n,.5);(0,s.X$)(e,h),i=a}return e}getSimplifiedGeometryInternal(e){let t=[],i=[];return t.length=(0,c.AL)(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new _(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return(0,g.fB)(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);let i=(0,h.KG)(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}let f=_},36115:(e,t,i)=>{i.d(t,{AS:()=>g,EW:()=>_,Hx:()=>d,kh:()=>c});var s=i(51752),r=i(65084),n=i(17563),o=i(35342),a=i(36670),h=i(61383),l=i(77216);function d(e,t){let i=e.length;return t<0?e[t+i]:t>=i?e[t-i]:e[t]}function g(e,t){let i=e.length,s=Math.floor(t),r=t-s;s>=i?s-=i:s<0&&(s+=i);let n=s+1;n>=i&&(n-=i);let o=e[s],a=o[0],h=o[1],l=e[n],d=l[0]-a,g=l[1]-h;return[a+d*r,h+g*r]}let u={index:-1,endIndex:NaN,closestTargetDistance:1/0};function c(e,t,i,r){let n=e[0],o=e[1],a=1/0,h=-1,l=NaN;for(let e=0;e<t.targets.length;++e){let i,s=t.targets[e],r=s.coordinates,d=1/0;for(let e=0;e<r.length-1;++e){let t=C(n,o,r[e],r[e+1]);t.squaredDistance<d&&(d=t.squaredDistance,i=e+t.along)}d<a&&(a=d,s.ring&&t.targetIndex===e&&(s.endIndex>s.startIndex?i<s.startIndex&&(i+=r.length):s.endIndex<s.startIndex&&i>s.startIndex&&(i-=r.length)),l=i,h=e)}let d=t.targets[h],c=d.ring;if(t.targetIndex===h&&c){let e=g(d.coordinates,l),n=i.getPixelFromCoordinate(e),o=i.getPixelFromCoordinate(t.startCoord);(0,s.Io)(n,o)>r&&(c=!1)}if(c){let e=d.coordinates,t=e.length,i=d.startIndex,s=l;if(i<s){let r=m(e,i,s);m(e,i,s-t)<r&&(l-=t)}else{let r=m(e,i,s);m(e,i,s+t)<r&&(l+=t)}}return u.index=h,u.endIndex=l,u.closestTargetDistance=a,u}function _(e,t){let i=[];for(let s=0;s<t.length;++s)!function e(t,i,s){if(i instanceof r.A)return void f(t,i.getCoordinates(),!1,s);if(i instanceof n.A){let e=i.getCoordinates();for(let i=0,r=e.length;i<r;++i)f(t,e[i],!1,s);return}if(i instanceof o.Ay){let e=i.getCoordinates();for(let i=0,r=e.length;i<r;++i)f(t,e[i],!0,s);return}if(i instanceof a.A){let e=i.getCoordinates();for(let i=0,r=e.length;i<r;++i){let r=e[i];for(let e=0,i=r.length;e<i;++e)f(t,r[e],!0,s)}return}if(i instanceof h.A){let r=i.getGeometries();for(let i=0;i<r.length;++i)e(t,r[i],s);return}}(e,t[s].getGeometry(),i);return i}function f(e,t,i,s){let r=e[0],n=e[1];for(let e=0,o=t.length-1;e<o;++e){let o=C(r,n,t[e],t[e+1]);if(0===o.squaredDistance){let r=e+o.along;s.push({coordinates:t,ring:i,startIndex:r,endIndex:r});return}}}function p(e,t){return(0,l.hG)(e[0],e[1],t[0],t[1])}function m(e,t,i){let s,r;t<i?(s=t,r=i):(s=i,r=t);let n=Math.ceil(s),o=Math.floor(r);if(n>o)return p(g(e,s),g(e,r));let a=0;s<n&&(a+=p(g(e,s),d(e,n))),o<r&&(a+=p(d(e,o),g(e,r)));for(let t=n;t<o-1;++t)a+=p(d(e,t),d(e,t+1));return a}let y={along:0,squaredDistance:0};function C(e,t,i,s){let r=i[0],n=i[1],o=s[0],a=s[1],h=o-r,d=a-n,g=0,u=r,c=n;return(0!==h||0!==d)&&(g=(0,l.qE)(((e-r)*h+(t-n)*d)/(h*h+d*d),0,1),u+=h*g,c+=d*g),y.along=g,y.squaredDistance=(0,l.Mg)((0,l.hG)(e,t,u,c),10),y}},36670:(e,t,i)=>{i.d(t,{A:()=>C});var s=i(47447),r=i(92194),n=i(83310),o=i(35342),a=i(22345),h=i(97196),l=i(7972),d=i(30220),g=i(28120),u=i(21692),c=i(140),_=i(58257),f=i(63643),p=i(67152),m=i(79782);class y extends a.Ay{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const r=e,n=[],o=[];for(let e=0,t=r.length;e<t;++e){const t=r[e],i=n.length,a=t.getEnds();for(let e=0,t=a.length;e<t;++e)a[e]+=i;(0,s.X$)(n,t.getFlatCoordinates()),o.push(a)}t=0===r.length?this.getLayout():r[0].getLayout(),e=n,i=o}void 0!==t&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){let i=this.flatCoordinates.length;(0,s.X$)(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,s=t.length;e<s;++e)t[e]+=i}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){let e=this.endss_.length,t=Array(e);for(let i=0;i<e;++i)t[i]=this.endss_[i].slice();let i=new y(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,s){return s<(0,r.Ld)(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,d.c)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,d.te)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return(0,g.Gd)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return(0,h.Cs)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),(0,p.NK)(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,(0,c.Dz)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let e=(0,l.C)(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,_.p)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new n.A(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let e=this.flatCoordinates;(0,p.mb)(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=(0,p.NK)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){let t=[],i=[];return t.length=(0,m.sx)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new y(t,"XY",i)}getPolygon(e){let t;if(e<0||this.endss_.length<=e)return null;if(0===e)t=0;else{let i=this.endss_[e-1];t=i[i.length-1]}let i=this.endss_[e].slice(),s=i[i.length-1];if(0!==t)for(let e=0,s=i.length;e<s;++e)i[e]-=t;return new o.Ay(this.flatCoordinates.slice(t,s),this.layout,i)}getPolygons(){let e=this.layout,t=this.flatCoordinates,i=this.endss_,s=[],r=0;for(let n=0,a=i.length;n<a;++n){let a=i[n].slice(),h=a[a.length-1];if(0!==r)for(let e=0,t=a.length;e<t;++e)a[e]-=r;let l=new o.Ay(t.slice(r,h),e,a);s.push(l),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return(0,f.Wp)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);let i=(0,u.d6)(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{let e=i[i.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}}let C=y},48067:(e,t,i)=>{i.d(t,{A:()=>E});var s=i(23504),r=i(22345),n=i(21692),o=i(8679),a=i(99127),h=i(26535),l=i(67152),d=i(52667),g=i(65084),u=i(35342),c=i(83310),_=i(17563),f=i(36670),p=i(61383),m=i(58222);class y{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=s.A,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?(0,a.Jt)(t.dataProjection):this.readProjection(e);t.extent&&i&&"tile-pixels"===i.getUnits()&&(i=(0,a.Jt)(i)).setWorldExtent(t.extent),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return(0,m.b0)()}readFeature(e,t){return(0,m.b0)()}readFeatures(e,t){return(0,m.b0)()}readGeometry(e,t){return(0,m.b0)()}readProjection(e){return(0,m.b0)()}writeFeature(e,t){return(0,m.b0)()}writeFeatures(e,t){return(0,m.b0)()}writeGeometry(e,t){return(0,m.b0)()}}let C=y;function x(e,t,i){let s=i?(0,a.Jt)(i.featureProjection):null,r=i?(0,a.Jt)(i.dataProjection):null,n=e;if(s&&r&&!(0,a.tI)(s,r)){t&&(n=e.clone());let i=t?s:r,o=t?r:s;"tile-pixels"===i.getUnits()?n.transform(i,o):n.applyTransform((0,a.RG)(i,o))}if(t&&i&&void 0!==i.decimals){let t=Math.pow(10,i.decimals);n===e&&(n=e.clone()),n.applyTransform(function(e){for(let i=0,s=e.length;i<s;++i)e[i]=Math.round(e[i]*t)/t;return e})}return n}let v={Point:d.A,LineString:g.A,Polygon:u.Ay,MultiPoint:c.A,MultiLineString:_.A,MultiPolygon:f.A};function P(e,t){if(!e)return null;if(Array.isArray(e)){let i=e.map(e=>P(e,t));return new p.A(i)}return x(new v[e.type](e.flatCoordinates,e.layout||"XY",e.ends),!1,t)}class F extends C{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(T(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(T(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return(0,m.b0)()}readFeaturesFromObject(e,t){return(0,m.b0)()}readGeometry(e,t){return this.readGeometryFromObject(T(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return(0,m.b0)()}readProjection(e){return this.readProjectionFromObject(T(e))}readProjectionFromObject(e){return(0,m.b0)()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return(0,m.b0)()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return(0,m.b0)()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return(0,m.b0)()}}function T(e){return"string"==typeof e?JSON.parse(e)||null:null!==e?e:null}let S=F;class A extends S{constructor(e){e=e||{},super(),this.dataProjection=(0,a.Jt)(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=(0,a.Jt)(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null,r=w((i="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry,t);if(this.featureClass===h.Ay)return function e(t,i){var s,r;let n=t.geometry;if(!n)return[];if(Array.isArray(n))return n.map(i=>e({...t,geometry:i})).flat();let o="MultiPolygon"===n.type?"Polygon":n.type;if("GeometryCollection"===o||"Circle"===o)throw Error("Unsupported geometry type: "+o);let a=n.layout.length;return x(new h.Ay(o,"Polygon"===o?(s=n.flatCoordinates,r=n.ends,Array.isArray(r[0])?!(0,l.mb)(s,0,r,a)&&(s=s.slice(),(0,l.NK)(s,0,r,a)):!(0,l.PA)(s,0,r,a)&&(s=s.slice(),(0,l.ug)(s,0,r,a)),s):n.flatCoordinates,n.ends?.flat(),a,t.properties||{},t.id).enableSimplifyTransformed(),!1,i)}({geometry:r,id:i.id,properties:i.properties},t);let n=new s.A;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&n.setGeometryName(i.geometry_name),n.setGeometry(P(r,t)),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(e,t){let i=null;if("FeatureCollection"===e.type){i=[];let s=e.features;for(let e=0,r=s.length;e<r;++e){let r=this.readFeatureFromObject(s[e],t);r&&i.push(r)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){var i;return P(w(e,i=t),i)}readProjectionFromObject(e){let t,i=e.crs;if(i)if("name"==i.type)t=(0,a.Jt)(i.properties.name);else if("EPSG"===i.type)t=(0,a.Jt)("EPSG:"+i.properties.code);else throw Error("Unknown SRS type");else t=this.dataProjection;return t}writeFeatureObject(e,t){t=this.adaptOptions(t);let i={type:"Feature",geometry:null,properties:null},s=e.getId();if(void 0!==s&&(i.id=s),!e.hasProperties())return i;let r=e.getProperties(),n=e.getGeometry();return n&&(i.geometry=M(n,t),delete r[e.getGeometryName()]),(0,o.p)(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);let i=[];for(let s=0,r=e.length;s<r;++s)i.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return M(e,this.adaptOptions(t))}}function w(e,t){let i;if(!e)return null;switch(e.type){case"Point":let s;i={type:"Point",flatCoordinates:s=e.coordinates,layout:(0,r.p0)(s.length)};break;case"LineString":let o,a;i={type:"LineString",flatCoordinates:a=(o=e.coordinates).flat(),ends:[a.length],layout:(0,r.p0)(o[0]?.length||2)};break;case"Polygon":let h,l,d,g;h=e.coordinates,l=[],d=h[0]?.[0]?.length,g=(0,n.KG)(l,0,h,d),i={type:"Polygon",flatCoordinates:l,ends:g,layout:(0,r.p0)(d)};break;case"MultiPoint":let u;i={type:"MultiPoint",flatCoordinates:(u=e.coordinates).flat(),layout:(0,r.p0)(u[0]?.length||2)};break;case"MultiLineString":let c,_,f,p;c=e.coordinates,_=c[0]?.[0]?.length||2,f=[],p=(0,n.KG)(f,0,c,_),i={type:"MultiLineString",flatCoordinates:f,ends:p,layout:(0,r.p0)(_)};break;case"MultiPolygon":let m,y,C,x;m=e.coordinates,y=[],C=m[0]?.[0]?.[0].length||2,x=(0,n.d6)(y,0,m,C),i={type:"MultiPolygon",flatCoordinates:y,ends:x,layout:(0,r.p0)(C)};break;case"GeometryCollection":i=e.geometries.map(function(e){return w(e,void 0)});break;default:throw Error("Unsupported GeoJSON type: "+e.type)}return i}function M(e,t){var i,s,r,n,o,a;let h,l=(e=x(e,!0,t)).getType();switch(l){case"Point":h={type:"Point",coordinates:e.getCoordinates()};break;case"LineString":h={type:"LineString",coordinates:e.getCoordinates()};break;case"Polygon":let d;i=e,(s=t)&&(d=s.rightHanded),h={type:"Polygon",coordinates:i.getCoordinates(d)};break;case"MultiPoint":h={type:"MultiPoint",coordinates:e.getCoordinates()};break;case"MultiLineString":h={type:"MultiLineString",coordinates:e.getCoordinates()};break;case"MultiPolygon":let g;r=e,(n=t)&&(g=n.rightHanded),h={type:"MultiPolygon",coordinates:r.getCoordinates(g)};break;case"GeometryCollection":o=e,a=Object.assign({},a=t),delete a.featureProjection,h={type:"GeometryCollection",geometries:o.getGeometriesArray().map(function(e){return M(e,a)})};break;case"Circle":h={type:"GeometryCollection",geometries:[]};break;default:throw Error("Unsupported geometry type: "+l)}return h}let E=A},61383:(e,t,i)=>{i.d(t,{A:()=>l});var s=i(46640),r=i(14139),n=i(92194),o=i(92203);class a extends o.A{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(r.JH),this.changeEventsKeys_.length=0}listenGeometriesChange_(){let e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push((0,r.KT)(e[t],s.A.CHANGE,this.changed,this))}clone(){let e=new a(h(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<(0,n.Ld)(this.getExtent(),e,t))return s;let r=this.geometries_;for(let n=0,o=r.length;n<o;++n)s=r[n].closestPointXY(e,t,i,s);return s}containsXY(e,t){let i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(e,t))return!0;return!1}computeExtent(e){(0,n.aZ)(e);let t=this.geometries_;for(let i=0,s=t.length;i<s;++i)(0,n.X$)(e,t[i].getExtent());return e}getGeometries(){return h(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[],t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;let t=[],i=this.geometries_,s=!1;for(let r=0,n=i.length;r<n;++r){let n=i[r],o=n.getSimplifiedGeometry(e);t.push(o),o!==n&&(s=!0)}return s?new a(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){let t=this.geometries_;for(let i=0,s=t.length;i<s;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){let i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(e,t);this.changed()}scale(e,t,i){i||(i=(0,n.q1)(this.getExtent()));let s=this.geometries_;for(let r=0,n=s.length;r<n;++r)s[r].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(h(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){let t=this.geometries_;for(let i=0,s=t.length;i<s;++i)t[i].applyTransform(e);this.changed()}translate(e,t){let i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function h(e){return e.map(e=>e.clone())}let l=a},64491:(e,t,i)=>{i.d(t,{Ay:()=>I});var s=i(23504),r=i(42984),n=i(79416),o=i(51752),a=i(70128),h=i(46640),l=i(57777),d=i(92194),g=i(46187),u=i(22345),c=i(21692),_=i(48307);class f extends u.Ay{constructor(e,t,i){super(),void 0!==i&&void 0===t?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){let e=new f(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){let r=this.flatCoordinates,n=e-r[0],o=t-r[1],a=n*n+o*o;if(a<s){if(0===a)for(let e=0;e<this.stride;++e)i[e]=r[e];else{let e=this.getRadius()/Math.sqrt(a);i[0]=r[0]+e*n,i[1]=r[1]+e*o;for(let e=2;e<this.stride;++e)i[e]=r[e]}return i.length=this.stride,a}return s}containsXY(e,t){let i=this.flatCoordinates,s=e-i[0],r=t-i[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){let t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,d.N)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){let e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){let t=this.getExtent();if((0,d.HY)(e,t)){let t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||e[1]<=t[1]&&e[3]>=t[1]||(0,d.sB)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){let t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let i=1;i<t;++i)s[t+i]=e[i];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);let s=this.flatCoordinates,r=(0,c._n)(s,0,e,this.stride);s[r++]=s[0]+t;for(let e=1,t=this.stride;e<t;++e)s[r++]=s[e];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){let i=this.getCenter(),s=this.getStride();this.setCenter((0,_.e$)(i,0,i.length,s,e,t,i)),this.changed()}}f.prototype.transform;var p=i(65084),m=i(17563),y=i(83310),C=i(36670),x=i(52667),v=i(35342),P=i(34531),F=i(99127),T=i(83639),S=i(92645),A=i(27900),w=i(17170),M=i(36115);let E="drawstart";class G extends a.Ay{constructor(e,t){super(e),this.feature=t}}class k extends A.A{constructor(e){e.stopDown||(e.stopDown=g.W8),super(e),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(e){switch(e){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw Error("Invalid type: "+e)}}(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:g.rT,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let t=e.geometryFunction;if(!t){const e=this.mode_;if("Circle"===e)t=(e,t,i)=>{let s=t||new f([NaN,NaN]),r=(0,F.Ad)(e[0],i),n=(0,o.hG)(r,(0,F.Ad)(e[e.length-1],i));s.setCenterAndRadius(r,Math.sqrt(n),this.geometryLayout_);let a=(0,F.Tf)();return a&&s.transform(i,a),s};else{let i;"Point"===e?i=x.A:"LineString"===e?i=p.A:"Polygon"===e&&(i=v.Ay),t=(t,s,r)=>(s?"Polygon"===e?t[0].length?s.setCoordinates([t[0].concat([t[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(t,this.geometryLayout_):s=new i(t,this.geometryLayout_),s)}}this.geometryFunction_=t,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new P.A({source:new T.A({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:function(){let e=(0,S.mY)();return function(t,i){return e[t.getGeometry().getType()]}}(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:l.TS,this.freehandCondition_,e.freehand?this.freehandCondition_=l.Gk:this.freehandCondition_=e.freehandCondition?e.freehandCondition:l.Kg,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(w.A.ACTIVE,this.updateState_)}setTrace(e){let t;t=e?!0===e?l.Gk:e:l.Zm,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=l.Gk:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:l.Kg}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===h.A.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let t=e.type===n.A.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===n.A.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===n.A.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===n.A.POINTERDOWN?i=!1:t&&2>this.getPointerCount()?(i=e.type===n.A.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===n.A.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===n.A.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return(this.shouldHandle_=!this.freehand_,this.freehand_)?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new r.A(n.A.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();let t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=(0,d.Tr)([i,s]),n=this.traceSource_.getFeaturesInExtent(r);if(0===n.length)return;let o=(0,M.EW)(e.coordinate,n);o.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){let i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){let s=Math.floor(t);s===t&&(s-=1),i=s-Math.ceil(e)+1}else{let s=Math.ceil(t);s===t&&(s+=1),i=Math.floor(e)-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;let s=[];if(t<i){let r=Math.ceil(t),n=Math.floor(i);n===i&&(n-=1);for(let t=r;t<=n;++t)s.push((0,M.Hx)(e.coordinates,t))}else{let r=Math.floor(t),n=Math.ceil(i);n===i&&(n+=1);for(let t=r;t>=n;--t)s.push((0,M.Hx)(e.coordinates,t))}s.length&&this.appendCoordinates(s)}updateTrace_(e){let t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex){let i=e.map.getPixelFromCoordinate(t.startCoord);if((0,o.Io)(i,e.pixel)<this.snapTolerance_)return}let i=(0,M.kh)(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(-1!==t.targetIndex){let e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}let e=t.targets[i.index];this.addTracedCoordinates_(e,e.startIndex,i.endIndex)}else{let e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,i.endIndex)}t.targetIndex=i.index;let s=t.targets[t.targetIndex];s.endIndex=i.endIndex;let r=(0,M.AS)(s.coordinates,s.endIndex),n=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(n[0]),Math.round(n[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);let i=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){let s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():this.freehand_||s&&"Point"!==this.mode_||(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){let t=this.downPx_,i=e.pixel,s=t[0]-i[0],r=t[1]-i[1],n=s*s+r*r;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_],n=this.mode_;if("Point"===n)i=!0;else if("Circle"===n)i=2===this.sketchCoords_.length;else if("LineString"===n)s=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===n){let e=this.sketchCoords_;s=e[0].length>this.minPoints_,r=[e[0][0],e[0][e[0].length-2]],r=t?[e[0][0]]:[e[0][0],e[0][e[0].length-2]]}if(s){let t=this.getMap();for(let s=0,n=r.length;s<n;s++){let n=r[s],o=t.getPixelFromCoordinate(n),a=e[0]-o[0],h=e[1]-o[1];if(i=Math.sqrt(a*a+h*h)<=(this.freehand_?1:this.snapTolerance_)){this.finishCoordinate_=n;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new s.A(new x.A(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new s.A);let t=e.getLinearRing(0),i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new p.A(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){let t=this.getMap().getView().getProjection(),i=(0,u.dn)(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new s.A(new p.A(this.sketchLineCoords_)));let r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new s.A,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new G(E,this.sketchFeature_))}modifyDrawing_(e){let t,i,s=this.getMap(),r=this.sketchFeature_.getGeometry(),n=s.getView().getProjection(),o=(0,u.dn)(this.geometryLayout_);for(;e.length<o;)e.push(0);"Point"===this.mode_?i=this.sketchCoords_:"Polygon"===this.mode_?(i=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(s.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):i=(t=this.sketchCoords_)[t.length-1],i[0]=e[0],i[1]=e[1],this.geometryFunction_(this.sketchCoords_,r,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),"Polygon"===r.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(r):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){let t,i,s=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),n=this.mode_;return("LineString"===n||"Circle"===n?(this.finishCoordinate_=e.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():t=!0),i.push(e.slice()),this.geometryFunction_(i,s,r)):"Polygon"===n&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():t=!0),i.push(e.slice()),t&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,s,r)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),t)?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;let t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<e;++r){let e;if("LineString"===s||"Circle"===s){if((e=this.sketchCoords_).splice(-2,1),e.length>=2){this.finishCoordinate_=e[e.length-2].slice();let t=this.finishCoordinate_.slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}this.geometryFunction_(e,t,i),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===s){(e=this.sketchCoords_[0]).splice(-2,1);let s=this.sketchLine_.getGeometry();if(e.length>=2){let t=e[e.length-2].slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}s.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,i)}if(1===e.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){let e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_,i=e.getGeometry(),s=this.getMap().getView().getProjection();return"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,i,s)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new y.A([t])):"MultiLineString"===this.type_?e.setGeometry(new m.A([t])):"MultiPolygon"===this.type_&&e.setGeometry(new C.A([t])),this.dispatchEvent(new G("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;let e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){let e=this.abortDrawing_();e&&this.dispatchEvent(new G("drawabort",e))}appendCoordinates(e){let t,i=this.mode_,s=!this.sketchFeature_;if(s&&this.startDrawing_(e[0]),"LineString"===i||"Circle"===i)t=this.sketchCoords_;else{if("Polygon"!==i)return;t=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}s&&t.shift(),t.pop();for(let t=0;t<e.length;t++)this.addToDrawing_(e[t]);let r=e[e.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){let t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();let i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new s.A(new x.A(i)),this.updateSketchFeatures_(),this.dispatchEvent(new G(E,this.sketchFeature_))}updateSketchFeatures_(){let e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);let t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){let e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)}}let I=k},65084:(e,t,i)=>{i.d(t,{A:()=>f});var s=i(47447),r=i(92194),n=i(22345),o=i(30220),a=i(21692),h=i(140),l=i(3764),d=i(63643),g=i(26121),u=i(57435),c=i(79782);class _ extends n.Ay{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}appendCoordinate(e){(0,s.X$)(this.flatCoordinates,e),this.changed()}clone(){let e=new _(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<(0,r.Ld)(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,o.MD)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,o.n)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,s))}forEachSegment(e){return(0,u.j)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(t=void 0!==t&&t,(0,l.gr)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return(0,h.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return(0,l.SH)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return(0,g.k)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){let t=[];return t.length=(0,c.P4)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new _(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return(0,d.gp)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,a.z2)(this.flatCoordinates,0,e,this.stride),this.changed()}}let f=_},83310:(e,t,i)=>{i.d(t,{A:()=>g});var s=i(47447),r=i(92194),n=i(77216),o=i(52667),a=i(22345),h=i(21692),l=i(140);class d extends a.Ay{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){(0,s.X$)(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){let e=new d(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){if(s<(0,r.Ld)(this.getExtent(),e,t))return s;let o=this.flatCoordinates,a=this.stride;for(let r=0,h=o.length;r<h;r+=a){let h=(0,n.hG)(e,t,o[r],o[r+1]);if(h<s){s=h;for(let e=0;e<a;++e)i[e]=o[r+e];i.length=a}}return s}getCoordinates(){return(0,l.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){let t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new o.A(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){let e=this.flatCoordinates,t=this.layout,i=this.stride,s=[];for(let r=0,n=e.length;r<n;r+=i){let n=new o.A(e.slice(r,r+i),t);s.push(n)}return s}getType(){return"MultiPoint"}intersectsExtent(e){let t=this.flatCoordinates,i=this.stride;for(let s=0,n=t.length;s<n;s+=i){let i=t[s],n=t[s+1];if((0,r.Rj)(e,i,n))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,h.z2)(this.flatCoordinates,0,e,this.stride),this.changed()}}let g=d}}]);