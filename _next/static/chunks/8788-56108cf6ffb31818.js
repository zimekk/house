"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8788],{7576:(e,t,r)=>{r.d(t,{_:()=>p});var n,i,a,o,s=r(16880),l=r(87347),u=r(74361),c=r(56996);let d=parseInt(l.sPf.replace(/\D+/g,"")),f=(n={screenspace:!1,color:new l.Q1f("black"),opacity:1,thickness:.05,size:new l.I9Y},i=`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,a=`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${d>=154?"colorspace_fragment":"encodings_fragment"}>
   }`,(o=class extends l.BKk{constructor(e){for(const t in super({vertexShader:i,fragmentShader:a,...e}),n)this.uniforms[t]=new l.nc$(n[t]),Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}});this.uniforms=l.LlO.clone(this.uniforms)}}).key=l.cj9.generateUUID(),o);function p({color:e="black",opacity:t=1,transparent:r=!1,screenspace:n=!1,toneMapped:i=!0,polygonOffset:a=!1,polygonOffsetFactor:o=0,renderOrder:d=0,thickness:p=.05,angle:h=Math.PI,clippingPlanes:g,...m}){let y=u.useRef(null),[w]=u.useState(()=>new f({side:l.hsX})),{gl:v}=(0,c.C)(),x=v.getDrawingBufferSize(new l.I9Y);u.useMemo(()=>(0,c.e)({OutlinesMaterial:f}),[]);let b=u.useRef(0),M=u.useRef(null);return u.useLayoutEffect(()=>{let e=y.current;if(!e)return;let t=e.parent;if(t&&t.geometry&&(b.current!==h||M.current!==t.geometry)){var r;b.current=h,M.current=t.geometry;let n=null==(r=e.children)?void 0:r[0];n&&(h&&n.geometry.dispose(),e.remove(n)),t.skeleton?((n=new l.I46).material=w,n.bind(t.skeleton,t.bindMatrix)):t.isInstancedMesh?(n=new l.ZLX(t.geometry,w,t.count)).instanceMatrix=t.instanceMatrix:(n=new l.eaF).material=w,e.add(n),n.geometry=h?function(e,t=Math.PI/3){let r=Math.cos(t),n=(1+1e-10)*100,i=[new l.Pq0,new l.Pq0,new l.Pq0],a=new l.Pq0,o=new l.Pq0,s=new l.Pq0,u=new l.Pq0;function c(e){let t=~~(e.x*n),r=~~(e.y*n),i=~~(e.z*n);return`${t},${r},${i}`}let d=e.index?e.toNonIndexed():e,f=d.attributes.position,p={};for(let e=0,t=f.count/3;e<t;e++){let t=3*e,r=i[0].fromBufferAttribute(f,t+0),n=i[1].fromBufferAttribute(f,t+1),s=i[2].fromBufferAttribute(f,t+2);a.subVectors(s,n),o.subVectors(r,n);let u=new l.Pq0().crossVectors(a,o).normalize();for(let e=0;e<3;e++){let t=c(i[e]);t in p||(p[t]=[]),p[t].push(u)}}let h=new Float32Array(3*f.count),g=new l.THS(h,3,!1);for(let e=0,t=f.count/3;e<t;e++){let t=3*e,n=i[0].fromBufferAttribute(f,t+0),l=i[1].fromBufferAttribute(f,t+1),d=i[2].fromBufferAttribute(f,t+2);a.subVectors(d,l),o.subVectors(n,l),s.crossVectors(a,o).normalize();for(let e=0;e<3;e++){let n=p[c(i[e])];u.set(0,0,0);for(let e=0,t=n.length;e<t;e++){let t=n[e];s.dot(t)>r&&u.add(t)}u.normalize(),g.setXYZ(t+e,u.x,u.y,u.z)}}return d.setAttribute("normal",g),d}(t.geometry,h):t.geometry,n.morphTargetInfluences=t.morphTargetInfluences,n.morphTargetDictionary=t.morphTargetDictionary}}),u.useLayoutEffect(()=>{let s=y.current;if(!s)return;let l=s.children[0];if(l){l.renderOrder=d;let u=s.parent;(0,c.s)(l,{morphTargetInfluences:u.morphTargetInfluences,morphTargetDictionary:u.morphTargetDictionary}),(0,c.s)(l.material,{transparent:r,thickness:p,color:e,opacity:t,size:x,screenspace:n,toneMapped:i,polygonOffset:a,polygonOffsetFactor:o,clippingPlanes:g,clipping:g&&g.length>0})}}),u.useEffect(()=>()=>{let e=y.current;if(!e)return;let t=e.children[0];t&&(h&&t.geometry.dispose(),e.remove(t))},[]),u.createElement("group",(0,s.A)({ref:y},m))}},9986:(e,t,r)=>{let n,i,a,o,s,l,u,c,d,f,p,h,g,m,y,w,v,x,b,M,A,P,T,B,S,E,_,I,U,C,R,F,k,z;r.d(t,{Lr:()=>rI,C6:()=>r_,V2:()=>rE,ZO:()=>rU});var q=r(16880),O=r(74361),D=r(56996),N=r(87347);let L=Symbol("SKIP_GENERATION");function V(e){return(e.index?e.index.count:e.attributes.position.count)/3}function G(e){let t=V(e),r=e.drawRange,n=r.start/3,i=(r.start+r.count)/3,a=Math.max(0,n),o=Math.min(t,i)-a;return[{offset:Math.floor(a),count:Math.floor(o)}]}function H(e){if(!e.groups||!e.groups.length)return G(e);let t=[],r=new Set,n=e.drawRange,i=n.start/3,a=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,n=(t.start+t.count)/3;r.add(Math.max(i,e)),r.add(Math.min(a,n))}let o=Array.from(r.values()).sort((e,t)=>e-t);for(let e=0;e<o.length-1;e++){let r=o[e],n=o[e+1];t.push({offset:Math.floor(r),count:Math.floor(n-r)})}return t}function W(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function j(e){let t=-1,r=-1/0;for(let n=0;n<3;n++){let i=e[n+3]-e[n];i>r&&(r=i,t=n)}return t}function X(e,t,r){let n,i;for(let a=0;a<3;a++){let o=a+3;n=e[a],i=t[a],r[a]=n<i?n:i,n=e[o],i=t[o],r[o]=n>i?n:i}}function Y(e,t,r){for(let n=0;n<3;n++){let i=t[e+2*n],a=t[e+2*n+1],o=i-a,s=i+a;o<r[n]&&(r[n]=o),s>r[n+3]&&(r[n+3]=s)}}function $(e){let t=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2];return 2*(t*r+r*n+n*t)}function Z(e,t,r,n,i=null){let a=1/0,o=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0,d=1/0,f=1/0,p=1/0,h=-1/0,g=-1/0,m=-1/0,y=null!==i;for(let n=6*t,i=(t+r)*6;n<i;n+=6){let t=e[n+0],r=e[n+1],i=t-r,w=t+r;i<a&&(a=i),w>l&&(l=w),y&&t<d&&(d=t),y&&t>h&&(h=t);let v=e[n+2],x=e[n+3],b=v-x,M=v+x;b<o&&(o=b),M>u&&(u=M),y&&v<f&&(f=v),y&&v>g&&(g=v);let A=e[n+4],P=e[n+5],T=A-P,B=A+P;T<s&&(s=T),B>c&&(c=B),y&&A<p&&(p=A),y&&A>m&&(m=A)}n[0]=a,n[1]=o,n[2]=s,n[3]=l,n[4]=u,n[5]=c,y&&(i[0]=d,i[1]=f,i[2]=p,i[3]=h,i[4]=g,i[5]=m)}let Q=(e,t)=>e.candidate-t.candidate,K=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),J=new Float32Array(6);class ee{}function et(e,t,r,n,i,a){let o=n,s=n+i-1,l=a.pos,u=2*a.axis;for(;;){for(;o<=s&&r[6*o+u]<l;)o++;for(;o<=s&&r[6*s+u]>=l;)s--;if(!(o<s))return o;for(let e=0;e<3;e++){let r=t[3*o+e];t[3*o+e]=t[3*s+e],t[3*s+e]=r}for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}function er(e,t,r,n,i,a){let o=n,s=n+i-1,l=a.pos,u=2*a.axis;for(;;){for(;o<=s&&r[6*o+u]<l;)o++;for(;o<=s&&r[6*s+u]>=l;)s--;if(!(o<s))return o;{let t=e[o];e[o]=e[s],e[s]=t;for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}}class en{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,n=-1/0;for(let i=0,a=e.length;i<a;i++){let a=e[i][t];r=a<r?a:r,n=a>n?a:n}this.min=r,this.max=n}setFromPoints(e,t){let r=1/0,n=-1/0;for(let i=0,a=t.length;i<a;i++){let a=t[i],o=e.dot(a);r=o<r?o:r,n=o>n?o:n}this.min=r,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}en.prototype.setFromBox=(a=new N.Pq0,function(e,t){let r=t.min,n=t.max,i=1/0,o=-1/0;for(let t=0;t<=1;t++)for(let s=0;s<=1;s++)for(let l=0;l<=1;l++){a.x=r.x*t+n.x*(1-t),a.y=r.y*s+n.y*(1-s),a.z=r.z*l+n.z*(1-l);let u=e.dot(a);i=Math.min(u,i),o=Math.max(u,o)}this.min=i,this.max=o}),new en;let ei=(o=new N.Pq0,s=new N.Pq0,l=new N.Pq0,function(e,t,r){let n,i,a=e.start,u=t.start;l.subVectors(a,u),o.subVectors(e.end,e.start),s.subVectors(t.end,t.start);let c=l.dot(s),d=s.dot(o),f=s.dot(s),p=l.dot(o),h=o.dot(o)*f-d*d;n=0!==h?(c*d-p*f)/h:0,i=(c+n*d)/f,r.x=n,r.y=i}),ea=(u=new N.I9Y,c=new N.Pq0,d=new N.Pq0,function(e,t,r,n){ei(e,t,u);let i=u.x,a=u.y;if(i>=0&&i<=1&&a>=0&&a<=1){e.at(i,r),t.at(a,n);return}if(i>=0&&i<=1){a<0?t.at(0,n):t.at(1,n),e.closestPointToPoint(n,!0,r);return}if(a>=0&&a<=1){i<0?e.at(0,r):e.at(1,r),t.closestPointToPoint(r,!0,n);return}{let o,s;if(o=i<0?e.start:e.end,s=a<0?t.start:t.end,e.closestPointToPoint(s,!0,c),t.closestPointToPoint(o,!0,d),c.distanceToSquared(s)<=d.distanceToSquared(o)){r.copy(c),n.copy(s);return}r.copy(o),n.copy(d);return}}),eo=(f=new N.Pq0,p=new N.Pq0,h=new N.Zcv,g=new N.cZY,function(e,t){let{radius:r,center:n}=e,{a:i,b:a,c:o}=t;if(g.start=i,g.end=a,g.closestPointToPoint(n,!0,f).distanceTo(n)<=r||(g.start=i,g.end=o,g.closestPointToPoint(n,!0,f).distanceTo(n)<=r)||(g.start=a,g.end=o,g.closestPointToPoint(n,!0,f).distanceTo(n)<=r))return!0;let s=t.getPlane(h);if(Math.abs(s.distanceToPoint(n))<=r){let e=s.projectPoint(n,p);if(t.containsPoint(e))return!0}return!1});function es(e){return 1e-15>Math.abs(e)}class el extends N.lMl{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new N.Pq0),this.satBounds=[,,,,].fill().map(()=>new en),this.points=[this.a,this.b,this.c],this.sphere=new N.iyt,this.plane=new N.Zcv,this.needsUpdate=!0}intersectsSphere(e){return eo(e,this)}update(){let e=this.a,t=this.b,r=this.c,n=this.points,i=this.satAxes,a=this.satBounds,o=i[0],s=a[0];this.getNormal(o),s.setFromPoints(o,n);let l=i[1],u=a[1];l.subVectors(e,t),u.setFromPoints(l,n);let c=i[2],d=a[2];c.subVectors(t,r),d.setFromPoints(c,n);let f=i[3],p=a[3];f.subVectors(r,e),p.setFromPoints(f,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}el.prototype.closestPointToSegment=(m=new N.Pq0,y=new N.Pq0,w=new N.cZY,function(e,t=null,r=null){let n,{start:i,end:a}=e,o=this.points,s=1/0;for(let i=0;i<3;i++){let a=(i+1)%3;w.start.copy(o[i]),w.end.copy(o[a]),ea(w,e,m,y),(n=m.distanceToSquared(y))<s&&(s=n,t&&t.copy(m),r&&r.copy(y))}return this.closestPointToPoint(i,m),(n=i.distanceToSquared(m))<s&&(s=n,t&&t.copy(m),r&&r.copy(i)),this.closestPointToPoint(a,m),(n=a.distanceToSquared(m))<s&&(s=n,t&&t.copy(m),r&&r.copy(a)),Math.sqrt(s)}),el.prototype.intersectsTriangle=function(){let e=new el,t=[,,,],r=[,,,],n=new en,i=new en,a=new N.Pq0,o=new N.Pq0,s=new N.Pq0,l=new N.Pq0,u=new N.Pq0,c=new N.cZY,d=new N.cZY,f=new N.cZY,p=new N.Pq0;function h(e,t,r){let n=e.points,i=0,a=-1;for(let e=0;e<3;e++){let{start:s,end:l}=c;s.copy(n[e]),l.copy(n[(e+1)%3]),c.delta(o);let u=es(t.distanceToPoint(s));if(es(t.normal.dot(o))&&u){r.copy(c),i=2;break}let d=t.intersectLine(c,p);if(!d&&u&&p.copy(s),(d||u)&&!es(p.distanceTo(l))){if(i<=1)(1===i?r.start:r.end).copy(p),u&&(a=i);else if(i>=2){(1===a?r.start:r.end).copy(p),i=2;break}if(2==++i&&-1===a)break}}return i}return function(o,c=null,p=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let g=this.plane,m=o.plane;if(Math.abs(g.normal.dot(m.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;r[0]=o.a,r[1]=o.b,r[2]=o.c;for(let t=0;t<4;t++){let i=e[t],a=s[t];if(n.setFromPoints(a,r),i.isSeparated(n))return!1}let l=o.satBounds,u=o.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=l[e],i=u[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}for(let e=0;e<4;e++){let o=s[e];for(let e=0;e<4;e++){let s=u[e];if(a.crossVectors(o,s),n.setFromPoints(a,t),i.setFromPoints(a,r),n.isSeparated(i))return!1}}return c&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{let e=h(this,m,d);if(1===e&&o.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;let t=h(o,g,f);if(1===t&&this.containsPoint(f.end))return c&&(c.start.copy(f.end),c.end.copy(f.end)),!0;if(2!==t)return!1;if(d.delta(s),f.delta(l),0>s.dot(l)){let e=f.start;f.start=f.end,f.end=e}let r=d.start.dot(s),n=d.end.dot(s),i=f.start.dot(s),a=f.end.dot(s);return(r===a||i===n||n<i!=r<a)&&(c&&(u.subVectors(d.start,f.start),u.dot(s)>0?c.start.copy(d.start):c.start.copy(f.start),u.subVectors(d.end,f.end),0>u.dot(s)?c.end.copy(d.end):c.end.copy(f.end)),!0)}}}(),el.prototype.distanceToPoint=(v=new N.Pq0,function(e){return this.closestPointToPoint(e,v),e.distanceTo(v)}),el.prototype.distanceToTriangle=(x=new N.Pq0,b=new N.Pq0,M=["a","b","c"],A=new N.cZY,P=new N.cZY,function(e,t=null,r=null){let n=t||r?A:null;if(this.intersectsTriangle(e,n))return(t||r)&&(t&&n.getCenter(t),r&&n.getCenter(r)),0;let i=1/0;for(let n=0;n<3;n++){let a,o=M[n],s=e[o];this.closestPointToPoint(s,x),(a=s.distanceToSquared(x))<i&&(i=a,t&&t.copy(x),r&&r.copy(s));let l=this[o];e.closestPointToPoint(l,x),(a=l.distanceToSquared(x))<i&&(i=a,t&&t.copy(l),r&&r.copy(x))}for(let n=0;n<3;n++){let a=M[n],o=M[(n+1)%3];A.set(this[a],this[o]);for(let n=0;n<3;n++){let a=M[n],o=M[(n+1)%3];P.set(e[a],e[o]),ea(A,P,x,b);let s=x.distanceToSquared(b);s<i&&(i=s,t&&t.copy(x),r&&r.copy(b))}}return Math.sqrt(i)});class eu{constructor(e,t,r){this.isOrientedBox=!0,this.min=new N.Pq0,this.max=new N.Pq0,this.matrix=new N.kn4,this.invMatrix=new N.kn4,this.points=Array(8).fill().map(()=>new N.Pq0),this.satAxes=[,,,].fill().map(()=>new N.Pq0),this.satBounds=[,,,].fill().map(()=>new en),this.alignedSatBounds=[,,,].fill().map(()=>new en),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}eu.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,n=this.points;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let o=0;o<=1;o++){let s=n[i|2*a|4*o];s.x=i?r.x:t.x,s.y=a?r.y:t.y,s.z=o?r.z:t.z,s.applyMatrix4(e)}let i=this.satBounds,a=this.satAxes,o=n[0];for(let e=0;e<3;e++){let t=a[e],r=i[e],s=n[1<<e];t.subVectors(o,s),r.setFromPoints(t,n)}let s=this.alignedSatBounds;s[0].setFromPointsField(n,"x"),s[1].setFromPointsField(n,"y"),s[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},eu.prototype.intersectsBox=(T=new en,function(e){this.needsUpdate&&this.update();let t=e.min,r=e.max,n=this.satBounds,i=this.satAxes,a=this.alignedSatBounds;if(T.min=t.x,T.max=r.x,a[0].isSeparated(T)||(T.min=t.y,T.max=r.y,a[1].isSeparated(T))||(T.min=t.z,T.max=r.z,a[2].isSeparated(T)))return!1;for(let t=0;t<3;t++){let r=i[t],a=n[t];if(T.setFromBox(r,e),a.isSeparated(T))return!1}return!0}),eu.prototype.intersectsTriangle=(B=new el,S=[,,,],E=new en,_=new en,I=new N.Pq0,function(e){this.needsUpdate&&this.update(),e.isExtendedTriangle?e.needsUpdate&&e.update():(B.copy(e),B.update(),e=B);let t=this.satBounds,r=this.satAxes;S[0]=e.a,S[1]=e.b,S[2]=e.c;for(let e=0;e<3;e++){let n=t[e],i=r[e];if(E.setFromPoints(i,S),n.isSeparated(E))return!1}let n=e.satBounds,i=e.satAxes,a=this.points;for(let e=0;e<3;e++){let t=n[e],r=i[e];if(E.setFromPoints(r,a),t.isSeparated(E))return!1}for(let e=0;e<3;e++){let t=r[e];for(let e=0;e<4;e++){let r=i[e];if(I.crossVectors(t,r),E.setFromPoints(I,S),_.setFromPoints(I,a),E.isSeparated(_))return!1}}return!0}),eu.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},eu.prototype.distanceToPoint=(U=new N.Pq0,function(e){return this.closestPointToPoint(e,U),e.distanceTo(U)}),eu.prototype.distanceToBox=(C=["x","y","z"],R=Array(12).fill().map(()=>new N.cZY),F=Array(12).fill().map(()=>new N.cZY),k=new N.Pq0,z=new N.Pq0,function(e,t=0,r=null,n=null){if(this.needsUpdate&&this.update(),this.intersectsBox(e))return(r||n)&&(e.getCenter(z),this.closestPointToPoint(z,k),e.closestPointToPoint(k,z),r&&r.copy(k),n&&n.copy(z)),0;let i=t*t,a=e.min,o=e.max,s=this.points,l=1/0;for(let e=0;e<8;e++){let t=s[e];z.copy(t).clamp(a,o);let u=t.distanceToSquared(z);if(u<l&&(l=u,r&&r.copy(t),n&&n.copy(z),u<i))return Math.sqrt(u)}let u=0;for(let e=0;e<3;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){let n=(e+1)%3,i=(e+2)%3,l=t<<n|r<<i,c=1<<e|t<<n|r<<i,d=s[l],f=s[c];R[u].set(d,f);let p=C[e],h=C[n],g=C[i],m=F[u],y=m.start,w=m.end;y[p]=a[p],y[h]=t?a[h]:o[h],y[g]=r?a[g]:o[h],w[p]=o[p],w[h]=t?a[h]:o[h],w[g]=r?a[g]:o[h],u++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let s=0;s<=1;s++){z.x=e?o.x:a.x,z.y=t?o.y:a.y,z.z=s?o.z:a.z,this.closestPointToPoint(z,k);let u=z.distanceToSquared(k);if(u<l&&(l=u,r&&r.copy(k),n&&n.copy(z),u<i))return Math.sqrt(u)}for(let e=0;e<12;e++){let t=R[e];for(let e=0;e<12;e++){ea(t,F[e],k,z);let a=k.distanceToSquared(z);if(a<l&&(l=a,r&&r.copy(k),n&&n.copy(z),a<i))return Math.sqrt(a)}}return Math.sqrt(l)});class ec{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class ed extends ec{constructor(){super(()=>new el)}}let ef=new ed;function ep(e,t){return 65535===t[e+15]}function eh(e,t){return t[e+14]}class eg{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}}let em=new eg,ey=[],ew=new ec(()=>new N.NRn),ev=new N.Pq0,ex=new N.Pq0,eb=new N.Pq0,eM=new N.Pq0,eA=new N.Pq0,eP=new N.I9Y,eT=new N.I9Y,eB=new N.I9Y,eS=new N.Pq0,eE=new N.Pq0,e_=new N.Pq0,eI=new N.Pq0;function eU(e,t,r,n,i){let a=3*n,o=a+0,s=a+1,l=a+2,u=e.index;e.index&&(o=u.getX(o),s=u.getX(s),l=u.getX(l));let{position:c,normal:d,uv:f,uv1:p}=e.attributes,h=function(e,t,r,n,i,a,o,s,l){eb.fromBufferAttribute(t,a),eM.fromBufferAttribute(t,o),eA.fromBufferAttribute(t,s);let u=null===(l===N.hsX?e.intersectTriangle(eA,eM,eb,!0,eI):e.intersectTriangle(eb,eM,eA,l!==N.$EB,eI))?null:{distance:e.origin.distanceTo(eI),point:eI.clone()};if(u){n&&(eP.fromBufferAttribute(n,a),eT.fromBufferAttribute(n,o),eB.fromBufferAttribute(n,s),u.uv=N.lMl.getInterpolation(eI,eb,eM,eA,eP,eT,eB,new N.I9Y)),i&&(eP.fromBufferAttribute(i,a),eT.fromBufferAttribute(i,o),eB.fromBufferAttribute(i,s),u.uv1=N.lMl.getInterpolation(eI,eb,eM,eA,eP,eT,eB,new N.I9Y)),r&&(eS.fromBufferAttribute(r,a),eE.fromBufferAttribute(r,o),e_.fromBufferAttribute(r,s),u.normal=N.lMl.getInterpolation(eI,eb,eM,eA,eS,eE,e_,new N.Pq0),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));let t={a:a,b:o,c:s,normal:new N.Pq0,materialIndex:0};N.lMl.getNormal(eb,eM,eA,t.normal),u.face=t,u.faceIndex=a}return u}(r,c,d,f,p,o,s,l,t);return h?(h.faceIndex=n,i&&i.push(h),h):null}function eC(e,t,r,n){let i=e.a,a=e.b,o=e.c,s=t,l=t+1,u=t+2;r&&(s=r.getX(s),l=r.getX(l),u=r.getX(u)),i.x=n.getX(s),i.y=n.getY(s),i.z=n.getZ(s),a.x=n.getX(l),a.y=n.getY(l),a.z=n.getZ(l),o.x=n.getX(u),o.y=n.getY(u),o.z=n.getZ(u)}function eR(e,t,r,n,i,a,o){let{geometry:s}=r,{index:l}=s,u=s.attributes.position;for(let r=e,s=t+e;r<s;r++){let e;if(eC(o,3*(e=r),l,u),o.needsUpdate=!0,n(o,e,i,a))return!0}return!1}let eF=new N.NRn;function ek(e,t,r,n){return W(e,t,eF),r.intersectBox(eF,n)}let ez=new N.Pq0;function eq(e,t,r,n,i){em.setBuffer(e._roots[t]),function e(t,r,n,i,a){let{float32Array:o,uint16Array:s,uint32Array:l}=em,u=2*t;if(ep(u,s))!function(e,t,r,n,i,a){let{geometry:o,_indirectBuffer:s}=e;for(let e=n,s=n+i;e<s;e++)eU(o,t,r,e,a)}(r,n,i,l[t+6],eh(u,s),a);else{let s=t+8;ek(s,o,i,ez)&&e(s,r,n,i,a);let u=l[t+6];ek(u,o,i,ez)&&e(u,r,n,i,a)}}(0,e,r,n,i),em.clearBuffer()}let eO=new N.Pq0,eD=["x","y","z"];function eN(e,t,r,n){em.setBuffer(e._roots[t]);let i=function e(t,r,n,i){let{float32Array:a,uint16Array:o,uint32Array:s}=em,l=2*t;if(ep(l,o))return function(e,t,r,n,i){let{geometry:a,_indirectBuffer:o}=e,s=1/0,l=null;for(let e=n,o=n+i;e<o;e++){let n;(n=eU(a,t,r,e))&&n.distance<s&&(l=n,s=n.distance)}return l}(r,n,i,s[t+6],eh(l,o));{let o,l,u=s[t+7],c=eD[u],d=i.direction[c]>=0;d?(o=t+8,l=s[t+6]):(o=s[t+6],l=t+8);let f=ek(o,a,i,eO)?e(o,r,n,i):null;if(f){let e=f.point[c];if(d?e<=a[l+u]:e>=a[l+u+3])return f}let p=ek(l,a,i,eO)?e(l,r,n,i):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}(0,e,r,n);return em.clearBuffer(),i}let eL=new N.NRn,eV=new el,eG=new el,eH=new N.kn4,eW=new eu,ej=new eu;function eX(e,t,r,n){em.setBuffer(e._roots[t]);let i=function e(t,r,n,i,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=em,u=2*t;if(null===a&&(n.boundingBox||n.computeBoundingBox(),eW.set(n.boundingBox.min,n.boundingBox.max,i),a=eW),ep(u,s)){let e=r.geometry,a=e.index,c=e.attributes.position,d=n.index,f=n.attributes.position,p=l[t+6],h=eh(u,s);if(eH.copy(i).invert(),n.boundsTree)return W(t,o,ej),ej.matrix.copy(eH),ej.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>ej.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let t=3*p,r=(h+p)*3;t<r;t+=3)if(eC(eG,t,a,c),eG.needsUpdate=!0,e.intersectsTriangle(eG))return!0;return!1}});for(let e=3*p,t=(h+p)*3;e<t;e+=3){eC(eV,e,a,c),eV.a.applyMatrix4(eH),eV.b.applyMatrix4(eH),eV.c.applyMatrix4(eH),eV.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(eC(eG,e,d,f),eG.needsUpdate=!0,eV.intersectsTriangle(eG))return!0}}else{let s=t+8,u=l[t+6];return W(s,o,eL),!!(a.intersectsBox(eL)&&e(s,r,n,i,a))||(W(u,o,eL),!!(a.intersectsBox(eL)&&e(u,r,n,i,a)))}}(0,e,r,n);return em.clearBuffer(),i}let eY=new N.kn4,e$=new eu,eZ=new eu,eQ=new N.Pq0,eK=new N.Pq0,eJ=new N.Pq0,e0=new N.Pq0;function e1(e,t,r,n,i,a,o){let{geometry:s}=r,{index:l}=s,u=s.attributes.position;for(let s=e,c=t+e;s<c;s++){let e;if(eC(o,3*(e=r.resolveTriangleIndex(s)),l,u),o.needsUpdate=!0,n(o,e,i,a))return!0}return!1}let e3=new N.Pq0;function e2(e,t,r,n,i){em.setBuffer(e._roots[t]),function e(t,r,n,i,a){let{float32Array:o,uint16Array:s,uint32Array:l}=em,u=2*t;if(ep(u,s))!function(e,t,r,n,i,a){let{geometry:o,_indirectBuffer:s}=e;for(let e=n,l=n+i;e<l;e++)eU(o,t,r,s?s[e]:e,a)}(r,n,i,l[t+6],eh(u,s),a);else{let s=t+8;ek(s,o,i,e3)&&e(s,r,n,i,a);let u=l[t+6];ek(u,o,i,e3)&&e(u,r,n,i,a)}}(0,e,r,n,i),em.clearBuffer()}let e6=new N.Pq0,e4=["x","y","z"];function e5(e,t,r,n){em.setBuffer(e._roots[t]);let i=function e(t,r,n,i){let{float32Array:a,uint16Array:o,uint32Array:s}=em,l=2*t;if(ep(l,o))return function(e,t,r,n,i){let{geometry:a,_indirectBuffer:o}=e,s=1/0,l=null;for(let e=n,u=n+i;e<u;e++){let n;(n=eU(a,t,r,o?o[e]:e))&&n.distance<s&&(l=n,s=n.distance)}return l}(r,n,i,s[t+6],eh(l,o));{let o,l,u=s[t+7],c=e4[u],d=i.direction[c]>=0;d?(o=t+8,l=s[t+6]):(o=s[t+6],l=t+8);let f=ek(o,a,i,e6)?e(o,r,n,i):null;if(f){let e=f.point[c];if(d?e<=a[l+u]:e>=a[l+u+3])return f}let p=ek(l,a,i,e6)?e(l,r,n,i):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}(0,e,r,n);return em.clearBuffer(),i}let e8=new N.NRn,e7=new el,e9=new el,te=new N.kn4,tt=new eu,tr=new eu;function tn(e,t,r,n){em.setBuffer(e._roots[t]);let i=function e(t,r,n,i,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=em,u=2*t;if(null===a&&(n.boundingBox||n.computeBoundingBox(),tt.set(n.boundingBox.min,n.boundingBox.max,i),a=tt),ep(u,s)){let e=r.geometry,a=e.index,c=e.attributes.position,d=n.index,f=n.attributes.position,p=l[t+6],h=eh(u,s);if(te.copy(i).invert(),n.boundsTree)return W(t,o,tr),tr.matrix.copy(te),tr.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>tr.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let t=p,n=h+p;t<n;t++)if(eC(e9,3*r.resolveTriangleIndex(t),a,c),e9.needsUpdate=!0,e.intersectsTriangle(e9))return!0;return!1}});for(let e=p,t=h+p;e<t;e++){eC(e7,3*r.resolveTriangleIndex(e),a,c),e7.a.applyMatrix4(te),e7.b.applyMatrix4(te),e7.c.applyMatrix4(te),e7.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(eC(e9,e,d,f),e9.needsUpdate=!0,e7.intersectsTriangle(e9))return!0}}else{let s=t+8,u=l[t+6];return W(s,o,e8),!!(a.intersectsBox(e8)&&e(s,r,n,i,a))||(W(u,o,e8),!!(a.intersectsBox(e8)&&e(u,r,n,i,a)))}}(0,e,r,n);return em.clearBuffer(),i}let ti=new N.kn4,ta=new eu,to=new eu,ts=new N.Pq0,tl=new N.Pq0,tu=new N.Pq0,tc=new N.Pq0,td=new em.constructor,tf=new em.constructor,tp=new ec(()=>new N.NRn),th=new N.NRn,tg=new N.NRn,tm=new N.NRn,ty=new N.NRn,tw=!1,tv=new eu,tx=new N.NRn;class tb{static serialize(e,t={}){t={cloneBuffers:!0,...t};let r=e.geometry,n=e._roots,i=e._indirectBuffer,a=r.getIndex();return t.cloneBuffers?{roots:n.map(e=>e.slice()),index:a.array.slice(),indirectBuffer:i?i.slice():null}:{roots:n,index:a.array,indirectBuffer:i}}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:n,roots:i,indirectBuffer:a}=e,o=new tb(t,{...r,[L]:!0});if(o._roots=i,o._indirectBuffer=a||null,r.setIndex){let r=t.getIndex();if(null===r){let r=new N.THS(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[L]:!1},t)).useSharedArrayBuffer&&!("u">typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[L]||(!function(e,t){let r,n,i,a=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){let r=(e.index?e.index.count:e.attributes.position.count)/3,n=r>65536,i=n?4:2,a=t?new SharedArrayBuffer(r*i):new ArrayBuffer(r*i),o=n?new Uint32Array(a):new Uint16Array(a);for(let e=0,t=o.length;e<t;e++)o[e]=e;return o}(a,t.useSharedArrayBuffer),function(e){if(0===e.groups.length)return!1;let t=V(e),r=H(e).sort((e,t)=>e.offset-t.offset),n=r[r.length-1];n.count=Math.min(t-n.offset,n.count);let i=0;return r.forEach(({count:e})=>i+=e),t!==i}(a)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){let r=e.attributes.position.count,n=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(r,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new N.THS(n,1));for(let e=0;e<r;e++)n[e]=e}}(a,t);let o=function(e,t){let r=e.geometry,n=r.index?r.index.array:null,i=t.maxDepth,a=t.verbose,o=t.maxLeafTris,s=t.strategy,l=t.onProgress,u=V(r),c=e._indirectBuffer,d=!1,f=new Float32Array(6),p=new Float32Array(6),h=function(e,t){t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;let r=e.attributes.position,n=e.index?e.index.array:null,i=V(e),a=new Float32Array(6*i),o=r.normalized,s=r.array,l=r.offset||0,u=3;r.isInterleavedBufferAttribute&&(u=r.data.stride);let c=["getX","getY","getZ"];for(let e=0;e<i;e++){let i=3*e,d=6*e,f=i+0,p=i+1,h=i+2;n&&(f=n[f],p=n[p],h=n[h]),o||(f=f*u+l,p=p*u+l,h=h*u+l);for(let e=0;e<3;e++){let n,i,l;o?(n=r[c[e]](f),i=r[c[e]](p),l=r[c[e]](h)):(n=s[f+e],i=s[p+e],l=s[h+e]);let u=n;i<u&&(u=i),l<u&&(u=l);let g=n;i>g&&(g=i),l>g&&(g=l);let m=(g-u)/2,y=2*e;a[d+y+0]=u+m,a[d+y+1]=m+(Math.abs(u)+m)*5960464477539063e-23,u<t[e]&&(t[e]=u),g>t[e+3]&&(t[e+3]=g)}}return a}(r,f),g=t.indirect?er:et,m=[],y=t.indirect?G(r):H(r);if(1===y.length){let e=y[0],t=new ee;t.boundingData=f,function(e,t,r,n){let i=1/0,a=1/0,o=1/0,s=-1/0,l=-1/0,u=-1/0;for(let n=6*t,c=(t+r)*6;n<c;n+=6){let t=e[n+0];t<i&&(i=t),t>s&&(s=t);let r=e[n+2];r<a&&(a=r),r>l&&(l=r);let c=e[n+4];c<o&&(o=c),c>u&&(u=c)}n[0]=i,n[1]=a,n[2]=o,n[3]=s,n[4]=l,n[5]=u}(h,e.offset,e.count,p),v(t,e.offset,e.count,p),m.push(t)}else for(let e of y){let t=new ee;t.boundingData=new Float32Array(6),Z(h,e.offset,e.count,t.boundingData,p),v(t,e.offset,e.count,p),m.push(t)}return m;function w(e){l&&l(e/u)}function v(e,t,l,u=null,f=0){if(!d&&f>=i&&(d=!0,a&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(r))),l<=o||f>=i)return w(t+l),e.offset=t,e.count=l,e;let m=function(e,t,r,n,i,a){let o=-1,s=0;if(0===a)-1!==(o=j(t))&&(s=(t[o]+t[o+3])/2);else if(1===a)-1!==(o=j(e))&&(s=function(e,t,r,n){let i=0;for(let a=t,o=t+r;a<o;a++)i+=e[6*a+2*n];return i/r}(r,n,i,o));else if(2===a){let a=$(e),u=1.25*i,c=6*n,d=(n+i)*6;for(let e=0;e<3;e++){let n=t[e],f=(t[e+3]-n)/32;if(i<8){let t=[...K];t.length=i;let n=0;for(let i=c;i<d;i+=6,n++){let a=t[n];a.candidate=r[i+2*e],a.count=0;let{bounds:o,leftCacheBounds:s,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;Y(i,r,o)}t.sort(Q);let l=i;for(let e=0;e<l;e++){let r=t[e];for(;e+1<l&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),l--}for(let n=c;n<d;n+=6){let i=r[n+2*e];for(let e=0;e<l;e++){let a=t[e];i>=a.candidate?Y(n,r,a.rightCacheBounds):(Y(n,r,a.leftCacheBounds),a.count++)}}for(let r=0;r<l;r++){let n=t[r],l=n.count,c=i-n.count,d=n.leftCacheBounds,f=n.rightCacheBounds,p=0;0!==l&&(p=$(d)/a);let h=0;0!==c&&(h=$(f)/a);let g=1+1.25*(p*l+h*c);g<u&&(o=e,u=g,s=n.candidate)}}else{var l;for(let e=0;e<32;e++){let t=K[e];t.count=0,t.candidate=n+f+e*f;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=c;t<d;t+=6){let i=~~((r[t+2*e]-n)/f);i>=32&&(i=31);let a=K[i];a.count++,Y(t,r,a.bounds)}let t=K[31];l=t.bounds,t.rightCacheBounds.set(l);for(let e=30;e>=0;e--){let t=K[e],r=K[e+1];X(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let p=0;for(let t=0;t<31;t++){let r=K[t],n=r.count,l=r.bounds,c=K[t+1].rightCacheBounds;0!==n&&(0===p?J.set(l):X(l,J,J));let d=0,f=0;0!==(p+=n)&&(d=$(J)/a);let h=i-p;0!==h&&(f=$(c)/a);let g=1+1.25*(d*p+f*h);g<u&&(o=e,u=g,s=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:o,pos:s}}(e.boundingData,u,h,t,l,s);if(-1===m.axis)return w(t+l),e.offset=t,e.count=l,e;let y=g(c,n,h,t,l,m);if(y===t||y===t+l)w(t+l),e.offset=t,e.count=l;else{e.splitAxis=m.axis;let r=new ee,n=y-t;e.left=r,r.boundingData=new Float32Array(6),Z(h,t,n,r.boundingData,p),v(r,t,n,p,f+1);let i=new ee,a=l-n;e.right=i,i.boundingData=new Float32Array(6),Z(h,y,a,i.boundingData,p),v(i,y,a,p,f+1)}return e}}(e,t),s=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<o.length;e++){let t=o[e],a=new l(32*function e(t){return t.count?1:1+e(t.left)+e(t.right)}(t));r=new Float32Array(a),n=new Uint32Array(a),i=new Uint16Array(a),function e(t,a){let o=t/4,s=t/2,l=!!a.count,u=a.boundingData;for(let e=0;e<6;e++)r[o+e]=u[e];if(l){let e=a.offset,r=a.count;return n[o+6]=e,i[s+14]=r,i[s+15]=65535,t+32}{let r,i=a.left,s=a.right,l=a.splitAxis;if((r=e(t+32,i))/4>0x100000000)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[o+6]=r/4,r=e(r,s),n[o+7]=l,r}}(0,t),s.push(a)}e._roots=s}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new N.NRn)));const{_indirectBuffer:r}=this;this.resolveTriangleIndex=t.indirect?e=>r[e]:e=>e}refit(e=null){return(this.indirect?function(e,t=null){let r,n,i,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,u=0,c=e._roots;for(let o=0,d=c.length;o<d;o++)n=new Uint32Array(r=c[o]),i=new Uint16Array(r),a=new Float32Array(r),function r(o,u,c=!1){let d=2*o;if(65535===i[d+15]){let t=n[o+6],r=i[d+14],u=1/0,c=1/0,f=1/0,p=-1/0,h=-1/0,g=-1/0;for(let n=t,i=t+r;n<i;n++){let t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let r=t+e;r=s?s[r]:r;let n=l.getX(r),i=l.getY(r),a=l.getZ(r);n<u&&(u=n),n>p&&(p=n),i<c&&(c=i),i>h&&(h=i),a<f&&(f=a),a>g&&(g=a)}}return(a[o+0]!==u||a[o+1]!==c||a[o+2]!==f||a[o+3]!==p||a[o+4]!==h||a[o+5]!==g)&&(a[o+0]=u,a[o+1]=c,a[o+2]=f,a[o+3]=p,a[o+4]=h,a[o+5]=g,!0)}{let e=o+8,i=n[o+6],s=e+u,l=i+u,d=c,f=!1,p=!1;t?d||(f=t.has(s),p=t.has(l),d=!f&&!p):(f=!0,p=!0);let h=d||f,g=d||p,m=!1;h&&(m=r(e,u,d));let y=!1;g&&(y=r(i,u,d));let w=m||y;if(w)for(let t=0;t<3;t++){let r=e+t,n=i+t,s=a[r],l=a[r+3],u=a[n],c=a[n+3];a[o+t]=s<u?s:u,a[o+t+3]=l>c?l:c}return w}}(0,u),u+=r.byteLength}:function(e,t=null){let r,n,i,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,u=0,c=e._roots;for(let e=0,o=c.length;e<o;e++)n=new Uint32Array(r=c[e]),i=new Uint16Array(r),a=new Float32Array(r),function e(r,o,u=!1){let c=2*r;if(65535===i[c+15]){let e=n[r+6],t=i[c+14],o=1/0,u=1/0,d=1/0,f=-1/0,p=-1/0,h=-1/0;for(let r=3*e,n=3*(e+t);r<n;r++){let e=s[r],t=l.getX(e),n=l.getY(e),i=l.getZ(e);t<o&&(o=t),t>f&&(f=t),n<u&&(u=n),n>p&&(p=n),i<d&&(d=i),i>h&&(h=i)}return(a[r+0]!==o||a[r+1]!==u||a[r+2]!==d||a[r+3]!==f||a[r+4]!==p||a[r+5]!==h)&&(a[r+0]=o,a[r+1]=u,a[r+2]=d,a[r+3]=f,a[r+4]=p,a[r+5]=h,!0)}{let i=r+8,s=n[r+6],l=i+o,c=s+o,d=u,f=!1,p=!1;t?d||(f=t.has(l),p=t.has(c),d=!f&&!p):(f=!0,p=!0);let h=d||f,g=d||p,m=!1;h&&(m=e(i,o,d));let y=!1;g&&(y=e(s,o,d));let w=m||y;if(w)for(let e=0;e<3;e++){let t=i+e,n=s+e,o=a[t],l=a[t+3],u=a[n],c=a[n+3];a[r+e]=o<u?o:u,a[r+e+3]=l>c?l:c}return w}}(0,u),u+=r.byteLength})(this,e)}traverse(e,t=0){let r=this._roots[t],n=new Uint32Array(r),i=new Uint16Array(r);!function t(a,o=0){let s=2*a,l=65535===i[s+15];if(l){let t=n[a+6],u=i[s+14];e(o,l,new Float32Array(r,4*a,6),t,u)}else{let i=n[a+6],s=n[a+7];e(o,l,new Float32Array(r,4*a,6),s)||(t(a+8,o+1),t(i,o+1))}}(0)}raycast(e,t=N.hB5){let r=this._roots,n=this.geometry,i=[],a=t.isMaterial,o=Array.isArray(t),s=n.groups,l=a?t.side:t,u=this.indirect?e2:eq;for(let n=0,a=r.length;n<a;n++){let r=o?t[s[n].materialIndex].side:l,a=i.length;if(u(this,n,r,e,i),o){let e=s[n].materialIndex;for(let t=a,r=i.length;t<r;t++)i[t].face.materialIndex=e}}return i}raycastFirst(e,t=N.hB5){let r=this._roots,n=this.geometry,i=t.isMaterial,a=Array.isArray(t),o=null,s=n.groups,l=i?t.side:t,u=this.indirect?e5:eN;for(let n=0,i=r.length;n<i;n++){let r=a?t[s[n].materialIndex].side:l,i=u(this,n,r,e);null!=i&&(null==o||i.distance<o.distance)&&(o=i,a&&(i.face.materialIndex=s[n].materialIndex))}return o}intersectsGeometry(e,t){let r=!1,n=this._roots,i=this.indirect?tn:eX;for(let a=0,o=n.length;a<o&&!(r=i(this,a,e,t));a++);return r}shapecast(e){let t=ef.getPrimitive(),r=this.indirect?e1:eR,{boundsTraverseOrder:a,intersectsBounds:o,intersectsRange:s,intersectsTriangle:l}=e;if(s&&l){let e=s;s=(n,i,a,o,s)=>!!e(n,i,a,o,s)||r(n,i,this,l,a,o,t)}else s||(s=l?(e,n,i,a)=>r(e,n,this,l,i,a,t):(e,t,r)=>r);let u=!1,c=0,d=this._roots;for(let e=0,t=d.length;e<t;e++){let t=d[e];if(u=function(e,t,r,a,o,s){n=ew.getPrimitive(),i=ew.getPrimitive(),ey.push(n,i),em.setBuffer(e._roots[t]);let l=function e(t,r,a,o,s=null,l=0,u=0){let{float32Array:c,uint16Array:d,uint32Array:f}=em,p=2*t;if(ep(p,d)){let e=f[t+6],r=eh(p,d);return W(t,c,n),o(e,r,!1,u,l+t,n)}{let p,m,y,w,v,x,b=t+8,M=f[t+6],A=b,P=M;if(s&&(y=n,w=i,W(A,c,y),W(P,c,w),p=s(y),(m=s(w))<p)){A=M,P=b;let e=p;p=m,m=e,y=w}y||W(A,c,y=n);let T=a(y,ep(2*A,d),p,u+1,l+A);if(2===T){let e=h(A);v=o(e,g(A)-e,!0,u+1,l+A,y)}else v=T&&e(A,r,a,o,s,l,u+1);if(v)return!0;W(P,c,w=i);let B=a(w,ep(2*P,d),m,u+1,l+P);if(2===B){let e=h(P);x=o(e,g(P)-e,!0,u+1,l+P,w)}else x=B&&e(P,r,a,o,s,l,u+1);if(x)return!0;return!1;function h(e){let{uint16Array:t,uint32Array:r}=em,n=2*e;for(;!ep(n,t);)n=2*(e+=8);return r[e+6]}function g(e){let{uint16Array:t,uint32Array:r}=em,n=2*e;for(;!ep(n,t);)n=2*(e=r[e+6]);return r[e+6]+eh(n,t)}}}(0,e.geometry,r,a,o,s);em.clearBuffer(),ew.releasePrimitive(n),ew.releasePrimitive(i),ey.pop(),ey.pop();let u=ey.length;return u>0&&(i=ey[u-1],n=ey[u-2]),l}(this,e,o,s,a,c))break;c+=t.byteLength}return ef.releasePrimitive(t),u}bvhcast(e,t,r){let{intersectsRanges:n,intersectsTriangles:i}=r,a=ef.getPrimitive(),o=this.geometry.index,s=this.geometry.attributes.position,l=this.indirect?e=>{eC(a,3*this.resolveTriangleIndex(e),o,s)}:e=>{eC(a,3*e,o,s)},u=ef.getPrimitive(),c=e.geometry.index,d=e.geometry.attributes.position,f=e.indirect?t=>{eC(u,3*e.resolveTriangleIndex(t),c,d)}:e=>{eC(u,3*e,c,d)};if(i){let e=(e,r,n,o,s,c,d,p)=>{for(let h=n,g=n+o;h<g;h++){f(h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++)if(l(t),a.needsUpdate=!0,i(a,u,t,h,s,c,d,p))return!0}return!1};if(n){let t=n;n=function(r,n,i,a,o,s,l,u){return!!t(r,n,i,a,o,s,l,u)||e(r,n,i,a,o,s,l,u)}}else n=e}return function(e,t,r,n){let i;if(tw)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");tw=!0;let a=e._roots,o=t._roots,s=0,l=0,u=new N.kn4().copy(r).invert();for(let e=0,t=a.length;e<t;e++){td.setBuffer(a[e]),l=0;let t=tp.getPrimitive();W(0,td.float32Array,t),t.applyMatrix4(u);for(let a=0,c=o.length;a<c&&(tf.setBuffer(o[e]),i=function e(t,r,n,i,a,o=0,s=0,l=0,u=0,c=null,d=!1){let f,p;d?(f=tf,p=td):(f=td,p=tf);let h=f.float32Array,g=f.uint32Array,m=f.uint16Array,y=p.float32Array,w=p.uint32Array,v=p.uint16Array,x=2*r,b=ep(2*t,m),M=ep(x,v),A=!1;if(M&&b)A=d?a(w[r+6],eh(2*r,v),g[t+6],eh(2*t,m),u,s+r,l,o+t):a(g[t+6],eh(2*t,m),w[r+6],eh(2*r,v),l,o+t,u,s+r);else if(M){let c=tp.getPrimitive();W(r,y,c),c.applyMatrix4(n);let f=t+8,p=g[t+6];W(f,h,th),W(p,h,tg);let m=c.intersectsBox(th),w=c.intersectsBox(tg);A=m&&e(r,f,i,n,a,s,o,u,l+1,c,!d)||w&&e(r,p,i,n,a,s,o,u,l+1,c,!d),tp.releasePrimitive(c)}else{let f=r+8,p=w[r+6];W(f,y,tm),W(p,y,ty);let m=c.intersectsBox(tm),v=c.intersectsBox(ty);if(m&&v)A=e(t,f,n,i,a,o,s,l,u+1,c,d)||e(t,p,n,i,a,o,s,l,u+1,c,d);else if(m)if(b)A=e(t,f,n,i,a,o,s,l,u+1,c,d);else{let r=tp.getPrimitive();r.copy(tm).applyMatrix4(n);let c=t+8,p=g[t+6];W(c,h,th),W(p,h,tg);let m=r.intersectsBox(th),y=r.intersectsBox(tg);A=m&&e(f,c,i,n,a,s,o,u,l+1,r,!d)||y&&e(f,p,i,n,a,s,o,u,l+1,r,!d),tp.releasePrimitive(r)}else if(v)if(b)A=e(t,p,n,i,a,o,s,l,u+1,c,d);else{let r=tp.getPrimitive();r.copy(ty).applyMatrix4(n);let c=t+8,f=g[t+6];W(c,h,th),W(f,h,tg);let m=r.intersectsBox(th),y=r.intersectsBox(tg);A=m&&e(p,c,i,n,a,s,o,u,l+1,r,!d)||y&&e(p,f,i,n,a,s,o,u,l+1,r,!d),tp.releasePrimitive(r)}}return A}(0,0,r,u,n,s,l,0,0,t),tf.clearBuffer(),l+=o[a].length,!i);a++);if(tp.releasePrimitive(t),td.clearBuffer(),s+=a[e].length,i)break}return tw=!1,i}(this,e,t,n)}intersectsBox(e,t){return tv.set(e.min,e.max,t),tv.needsUpdate=!0,this.shapecast({intersectsBounds:e=>tv.intersectsBox(e),intersectsTriangle:e=>tv.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},n={},i=0,a=1/0){return(this.indirect?function(e,t,r,n={},i={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),ta.set(t.boundingBox.min,t.boundingBox.max,r),ta.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,u=s.index,c=t.attributes.position,d=t.index,f=ef.getPrimitive(),p=ef.getPrimitive(),h=null,g=null;i&&(h=tu,g=tc);let m=1/0,y=null,w=null;return(ti.copy(r).invert(),to.matrix.copy(ti),e.shapecast({boundsTraverseOrder:e=>ta.distanceToBox(e),intersectsBounds:(e,t,r)=>r<m&&r<o&&(t&&(to.min.copy(e.min),to.max.copy(e.max),to.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(t.boundsTree){let s=t.boundsTree;return s.shapecast({boundsTraverseOrder:e=>to.distanceToBox(e),intersectsBounds:(e,t,r)=>r<m&&r<o,intersectsRange:(t,o)=>{for(let v=t,x=t+o;v<x;v++){eC(p,3*s.resolveTriangleIndex(v),d,c),p.a.applyMatrix4(r),p.b.applyMatrix4(r),p.c.applyMatrix4(r),p.needsUpdate=!0;for(let t=n,r=n+i;t<r;t++){eC(f,3*e.resolveTriangleIndex(t),u,l),f.needsUpdate=!0;let r=f.distanceToTriangle(p,ts,h);if(r<m&&(tl.copy(ts),g&&g.copy(h),m=r,y=t,w=v),r<a)return!0}}}})}{let o=V(t);for(let t=0;t<o;t++){eC(p,3*t,d,c),p.a.applyMatrix4(r),p.b.applyMatrix4(r),p.c.applyMatrix4(r),p.needsUpdate=!0;for(let r=n,o=n+i;r<o;r++){eC(f,3*e.resolveTriangleIndex(r),u,l),f.needsUpdate=!0;let n=f.distanceToTriangle(p,ts,h);if(n<m&&(tl.copy(ts),g&&g.copy(h),m=n,y=r,w=t),n<a)return!0}}}}}),ef.releasePrimitive(f),ef.releasePrimitive(p),m===1/0)?null:(n.point?n.point.copy(tl):n.point=tl.clone(),n.distance=m,n.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(ti),tl.applyMatrix4(ti),i.distance=tl.sub(i.point).length(),i.faceIndex=w),n)}:function(e,t,r,n={},i={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),e$.set(t.boundingBox.min,t.boundingBox.max,r),e$.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,u=s.index,c=t.attributes.position,d=t.index,f=ef.getPrimitive(),p=ef.getPrimitive(),h=null,g=null;i&&(h=eJ,g=e0);let m=1/0,y=null,w=null;return(eY.copy(r).invert(),eZ.matrix.copy(eY),e.shapecast({boundsTraverseOrder:e=>e$.distanceToBox(e),intersectsBounds:(e,t,r)=>r<m&&r<o&&(t&&(eZ.min.copy(e.min),eZ.max.copy(e.max),eZ.needsUpdate=!0),!0),intersectsRange:(e,n)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>eZ.distanceToBox(e),intersectsBounds:(e,t,r)=>r<m&&r<o,intersectsRange:(t,i)=>{for(let o=t,s=t+i;o<s;o++){eC(p,3*o,d,c),p.a.applyMatrix4(r),p.b.applyMatrix4(r),p.c.applyMatrix4(r),p.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++){eC(f,3*t,u,l),f.needsUpdate=!0;let e=f.distanceToTriangle(p,eQ,h);if(e<m&&(eK.copy(eQ),g&&g.copy(h),m=e,y=t,w=o),e<a)return!0}}}});{let i=V(t);for(let t=0;t<i;t++){eC(p,3*t,d,c),p.a.applyMatrix4(r),p.b.applyMatrix4(r),p.c.applyMatrix4(r),p.needsUpdate=!0;for(let r=e,i=e+n;r<i;r++){eC(f,3*r,u,l),f.needsUpdate=!0;let e=f.distanceToTriangle(p,eQ,h);if(e<m&&(eK.copy(eQ),g&&g.copy(h),m=e,y=r,w=t),e<a)return!0}}}}}),ef.releasePrimitive(f),ef.releasePrimitive(p),m===1/0)?null:(n.point?n.point.copy(eK):n.point=eK.clone(),n.distance=m,n.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(eY),eK.applyMatrix4(eY),i.distance=eK.sub(i.point).length(),i.faceIndex=w),n)})(this,e,t,r,n,i,a)}closestPointToPoint(e,t={},r=0,n=1/0){return function(e,t,r={},n=0,i=1/0){let a=n*n,o=i*i,s=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(ev.copy(t).clamp(e.min,e.max),ev.distanceToSquared(t)),intersectsBounds:(e,t,r)=>r<s&&r<o,intersectsTriangle:(e,r)=>{e.closestPointToPoint(t,ev);let n=t.distanceToSquared(ev);return n<s&&(ex.copy(ev),s=n,l=r),n<a}}),s===1/0)return null;let u=Math.sqrt(s);return r.point?r.point.copy(ex):r.point=ex.clone(),r.distance=u,r.faceIndex=l,r}(this,e,t,r,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{W(0,new Float32Array(t),tx),e.union(tx)}),e}}let tM=Math.pow(10,-Math.log10(1e-6)),tA=5e-7*tM;function tP(e){return~~(e*tM+tA)}function tT(e){return`${tP(e.x)},${tP(e.y)},${tP(e.z)}`}function tB(){return"u">typeof SharedArrayBuffer}function tS(e){return(e.index?e.index.count:e.attributes.position.count)/3}let tE=new N.Pq0;function t_(e,t){return e.start-t.start}function tI(e,t){return tE.subVectors(t,e.origin).dot(e.direction)}class tU{constructor(){this._rays=[]}addRay(e){this._rays.push(e)}findClosestRay(e){let t=this._rays,r=e.clone();r.direction.multiplyScalar(-1);let n=1/0,i=null;for(let s=0,l=t.length;s<l;s++){let l=t[s];if(a(l,e)&&a(l,r))continue;let u=Math.min(o(l,e),o(l,r));u<n&&(n=u,i=l)}return i;function a(e,t){let r=e.origin.distanceTo(t.origin)>1e-5;return e.direction.angleTo(t.direction)>1e-4||r}function o(e,t){return e.origin.distanceTo(t.origin)/1e-5+e.direction.angleTo(t.direction)/1e-4}}}let tC=new N.Pq0,tR=new N.Pq0,tF=new N.RlV,tk=new N.I9Y,tz=new N.Pq0,tq=new N.IUQ,tO=["","",""];class tD{constructor(e=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){let r=this.data[3*e+t];return -1===r?-1:~~(r/3)}getSiblingEdgeIndex(e,t){let r=this.data[3*e+t];return -1===r?-1:r%3}getDisjointSiblingTriangleIndices(e,t){let r=this.disjointConnections.get(3*e+t);return r?r.map(e=>~~(e/3)):[]}getDisjointSiblingEdgeIndices(e,t){let r=this.disjointConnections.get(3*e+t);return r?r.map(e=>e%3):[]}isFullyConnected(){return 0===this.unmatchedEdges}updateFrom(e){let{useAllAttributes:t,useDrawRange:r,matchDisjointEdges:n,degenerateEpsilon:i}=this,a=t?function(e){let t="";for(let i=0,a=l.length;i<a;i++){var r,n;let a,o=s[l[i]];switch(o.itemSize){case 1:a=tP(o.getX(e));break;case 2:r=tk.fromBufferAttribute(o,e),a=`${tP(r.x)},${tP(r.y)}`;break;case 3:a=tT(tz.fromBufferAttribute(o,e));break;case 4:n=tq.fromBufferAttribute(o,e),a=`${tP(n.x)},${tP(n.y)},${tP(n.z)},${tP(n.w)}`}""!==t&&(t+="|"),t+=a}return t}:function(e){return tz.fromBufferAttribute(c,e),tT(tz)},o=new Map,{attributes:s}=e,l=t?Object.keys(s):null,u=e.index,c=s.position,d=tS(e),f=d,p=0;r&&(p=e.drawRange.start,e.drawRange.count!==1/0&&(d=~~(e.drawRange.count/3)));let h=this.data;(!h||h.length<3*f)&&(h=new Int32Array(3*f)),h.fill(-1);let g=0,m=new Set;for(let e=p,t=3*d+p;e<t;e+=3){let t=e;for(let e=0;e<3;e++){let r=t+e;u&&(r=u.getX(r)),tO[e]=a(r)}for(let e=0;e<3;e++){let r=(e+1)%3,n=tO[e],i=tO[r],a=`${i}_${n}`;if(o.has(a)){let r=t+e,n=o.get(a);h[r]=n,h[n]=r,o.delete(a),g+=2,m.delete(n)}else{let r=`${n}_${i}`,a=t+e;o.set(r,a),m.add(a)}}}if(n){let{fragmentMap:t,disjointConnectivityMap:r}=function(e,t,r){let n=e.attributes,i=e.index,a=n.position,o=new Map,s=new Map,l=Array.from(t),u=new tU;for(let e=0,t=l.length;e<t;e++){let t,r=l[e],n=~~(r/3),o=r%3,c=3*n+o,d=3*n+(o+1)%3;i&&(c=i.getX(c),d=i.getX(d)),tC.fromBufferAttribute(a,c),tR.fromBufferAttribute(a,d),function(e,t,r){r.direction.subVectors(t,e).normalize();let n=e.dot(r.direction);r.origin.copy(e).addScaledVector(r.direction,-n)}(tC,tR,tF);let f=u.findClosestRay(tF);null===f&&(f=tF.clone(),u.addRay(f)),s.has(f)||s.set(f,{forward:[],reverse:[],ray:f}),t=s.get(f);let p=tI(f,tC),h=tI(f,tR);p>h&&([p,h]=[h,p]),0>tF.direction.dot(f.direction)?t.reverse.push({start:p,end:h,index:r}):t.forward.push({start:p,end:h,index:r})}return s.forEach(({forward:e,reverse:t},n)=>{!function(e,t,r,n=1e-8){e.sort(t_),t.sort(t_);for(let n=0;n<e.length;n++){let i=e[n];for(let s=0;s<t.length;s++){let l=t[s];if(l.start>i.end);else if(i.end<l.start||l.end<i.start)continue;else if(i.start<=l.start&&i.end>=l.end)a(l.end,i.end)||e.splice(n+1,0,{start:l.end,end:i.end,index:i.index}),i.end=l.start,l.start=0,l.end=0;else if(i.start>=l.start&&i.end<=l.end)a(i.end,l.end)||t.splice(s+1,0,{start:i.end,end:l.end,index:l.index}),l.end=i.start,i.start=0,i.end=0;else if(i.start<=l.start&&i.end<=l.end){let e=i.end;i.end=l.start,l.start=e}else if(i.start>=l.start&&i.end>=l.end){let e=l.end;l.end=i.start,i.start=e}else throw Error();if(r.has(i.index)||r.set(i.index,[]),r.has(l.index)||r.set(l.index,[]),r.get(i.index).push(l.index),r.get(l.index).push(i.index),o(l)&&(t.splice(s,1),s--),o(i)){e.splice(n,1),n--;break}}}function i(e){for(let t=0;t<e.length;t++)o(e[t])&&(e.splice(t,1),t--)}function a(e,t){return Math.abs(t-e)<n}function o(e){return Math.abs(e.end-e.start)<n}i(e),i(t)}(e,t,o,r),0===e.length&&0===t.length&&s.delete(n)}),{disjointConnectivityMap:o,fragmentMap:s}}(e,m,i);m.clear(),t.forEach(({forward:e,reverse:t})=>{e.forEach(({index:e})=>m.add(e)),t.forEach(({index:e})=>m.add(e))}),this.unmatchedDisjointEdges=t,this.disjointConnections=r,g=3*d-m.size}this.matchedEdges=g,this.unmatchedEdges=m.size,this.data=h}}class tN extends N.eaF{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new N.kn4,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){let{matrix:e,_previousMatrix:t}=this,r=e.elements,n=t.elements;for(let e=0;e<16;e++)if(r[e]!==n[e])return!0;return!1}prepareGeometry(){let e=this.geometry,t=e.attributes,r=tB();if(r)for(let e in t){let r=t[e];if(r.isInterleavedBufferAttribute)throw Error("Brush: InterleavedBufferAttributes are not supported.");r.array=function(e){if(e.buffer instanceof SharedArrayBuffer)return e;let t=e.constructor,r=e.buffer,n=new SharedArrayBuffer(r.byteLength),i=new Uint8Array(r);return new Uint8Array(n).set(i,0),new t(n)}(r.array)}if(e.boundsTree||(!function(e,t){if(!e.index){let r=e.attributes.position.count,n=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(r,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new N.THS(n,1));for(let e=0;e<r;e++)n[e]=e}}(e,{useSharedArrayBuffer:r}),e.boundsTree=new tb(e,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:r})),e.halfEdges||(e.halfEdges=new tD(e)),!e.groupIndices){let t=new Uint16Array(tS(e)),r=e.groups;for(let e=0,n=r.length;e<n;e++){let{start:n,count:i}=r[e];for(let r=n/3,a=(n+i)/3;r<a;r++)t[r]=e}e.groupIndices=t}}disposeCacheData(){let{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}let tL=new N.Pq0,tV=new N.Pq0,tG=new N.Pq0;function tH(e,t=1e-14){tL.subVectors(e.b,e.a),tV.subVectors(e.c,e.a),tG.subVectors(e.b,e.c);let r=tL.angleTo(tV),n=tL.angleTo(tG),i=Math.PI-r-n;return Math.abs(r)<t||Math.abs(n)<t||Math.abs(i)<t||e.a.distanceToSquared(e.b)<t||e.a.distanceToSquared(e.c)<t||e.b.distanceToSquared(e.c)<t}let tW=new N.cZY,tj=new N.cZY,tX=new N.Pq0,tY=new N.Pq0,t$=new N.Pq0,tZ=new N.Zcv,tQ=new el;class tK{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new N.lMl),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class tJ{constructor(){this.trianglePool=new tK,this.triangles=[],this.normal=new N.Pq0,this.coplanarTriangleUsed=!1}initialize(e){this.reset();let{triangles:t,trianglePool:r,normal:n}=this;if(Array.isArray(e))for(let i=0,a=e.length;i<a;i++){let a=e[i];if(0===i)a.getNormal(n);else if(Math.abs(1-a.getNormal(tX).dot(n))>1e-10)throw Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");let o=r.getTriangle();o.copy(a),t.push(o)}else{e.getNormal(n);let i=r.getTriangle();i.copy(e),t.push(i)}}splitByTriangle(e){let{normal:t,triangles:r}=this;if(e.getNormal(tY).normalize(),1e-10>Math.abs(1-Math.abs(tY.dot(t)))){this.coplanarTriangleUsed=!0;for(let e=0,t=r.length;e<t;e++)r[e].coplanarCount=0;let t=[e.a,e.b,e.c];for(let r=0;r<3;r++){let n=(r+1)%3,i=t[r],a=t[n];tX.subVectors(a,i).normalize(),t$.crossVectors(tY,tX),tZ.setFromNormalAndCoplanarPoint(t$,i),this.splitByPlane(tZ,e)}}else e.getPlane(tZ),this.splitByPlane(tZ,e)}splitByPlane(e,t){let{triangles:r,trianglePool:n}=this;tQ.copy(t),tQ.needsUpdate=!0;for(let t=0,i=r.length;t<i;t++){let a=r[t];if(!tQ.intersectsTriangle(a,tW,!0))continue;let{a:o,b:s,c:l}=a,u=0,c=-1,d=!1,f=[],p=[],h=[o,s,l];for(let t=0;t<3;t++){let r=(t+1)%3;tW.start.copy(h[t]),tW.end.copy(h[r]);let n=e.distanceToPoint(tW.start),i=e.distanceToPoint(tW.end);if(1e-10>Math.abs(n)&&1e-10>Math.abs(i)){d=!0;break}if(n>0?f.push(t):p.push(t),1e-10>Math.abs(n))continue;let a=!!e.intersectLine(tW,tX);!a&&1e-10>Math.abs(i)&&(tX.copy(tW.end),a=!0),a&&!(1e-10>tX.distanceTo(tW.start))&&(1e-10>tX.distanceTo(tW.end)&&(c=t),0===u?tj.start.copy(tX):tj.end.copy(tX),u++)}if(!d&&2===u&&tj.distance()>1e-10)if(-1!==c){let e=0;0==(c=(c+1)%3)&&(e=(e+1)%3);let o=e+1;o===c&&(o=(o+1)%3);let s=n.getTriangle();s.a.copy(h[o]),s.b.copy(tj.end),s.c.copy(tj.start),tH(s)||r.push(s),a.a.copy(h[e]),a.b.copy(tj.start),a.c.copy(tj.end),tH(a)&&(r.splice(t,1),t--,i--)}else{let e=f.length>=2?p[0]:f[0];if(0===e){let e=tj.start;tj.start=tj.end,tj.end=e}let o=(e+1)%3,s=(e+2)%3,l=n.getTriangle(),u=n.getTriangle();h[o].distanceToSquared(tj.start)<h[s].distanceToSquared(tj.end)?(l.a.copy(h[o]),l.b.copy(tj.start),l.c.copy(tj.end),u.a.copy(h[o]),u.b.copy(h[s]),u.c.copy(tj.start)):(l.a.copy(h[s]),l.b.copy(tj.start),l.c.copy(tj.end),u.a.copy(h[o]),u.b.copy(h[s]),u.c.copy(tj.end)),a.a.copy(h[e]),a.b.copy(tj.end),a.c.copy(tj.start),tH(l)||r.push(l),tH(u)||r.push(u),tH(a)&&(r.splice(t,1),t--,i--)}else 3===u&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}class t0{constructor(e,t=500){this.expansionFactor=1.5,this.type=e,this.length=0,this.array=null,this.setSize(t)}setType(e){if(0!==this.length)throw Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");let t=this.array.buffer;this.array=new e(t),this.type=e}setSize(e){var t;if(this.array&&e===this.array.length)return;let r=this.type,n=new r(new(tB()?SharedArrayBuffer:ArrayBuffer)((t=~~(t=e*r.BYTES_PER_ELEMENT))+4-t%4));this.array&&n.set(this.array,0),this.array=n}expand(){let{array:e,expansionFactor:t}=this;this.setSize(e.length*t)}push(...e){let{array:t,length:r}=this;r+e.length>t.length&&(this.expand(),t=this.array);for(let n=0,i=e.length;n<i;n++)t[r+n]=e[n];this.length+=e.length}clear(){this.length=0}}class t1{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getItemSize(e){return this.groupAttributes[0][e].itemSize}getNormalized(e){return this.groupAttributes[0][e].normalized}getCount(e){if(this.groupCount<=e)return 0;let t=this.getGroupAttrArray("position",e);return t.length/t.itemSize}getTotalLength(e){let{groupCount:t,groupAttributes:r}=this,n=0;for(let i=0;i<t;i++)n+=r[i][e].length;return n}getGroupAttrSet(e=0){let{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];let r=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){let e={};for(let n in t.push(e),r){let t=r[n],i=new t0(t.type);i.itemSize=t.itemSize,i.normalized=t.normalized,e[n]=i}}return t[e]}getGroupAttrArray(e,t=0){let{groupAttributes:r}=this;if(!r[0][e])throw Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupAttrSet(t)[e]}initializeArray(e,t,r,n){let{groupAttributes:i}=this,a=i[0][e];if(a){if(a.type!==t)for(let a=0,o=i.length;a<o;a++){let o=i[a][e];o.setType(t),o.itemSize=r,o.normalized=n}}else for(let a=0,o=i.length;a<o;a++){let o=new t0(t);o.itemSize=r,o.normalized=n,i[a][e]=o}}clear(){this.groupCount=0;let{groupAttributes:e}=this;e.forEach(e=>{for(let t in e)e[t].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[],this.groupCount=0}}class t3{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){let{intersectionSet:r,ids:n}=this;r[e]||(r[e]=[],n.push(e)),r[e].push(t)}}let t2=new N.RlV,t6=new N.kn4,t4=new N.lMl,t5=new N.Pq0,t8=new N.IUQ,t7=new N.IUQ,t9=new N.IUQ,re=new N.IUQ,rt=new N.IUQ,rr=new N.IUQ,rn=new N.cZY,ri=new N.Pq0,ra=null;function ro(e,t){e.getMidpoint(t2.origin),e.getNormal(t2.direction);let r=t.raycastFirst(t2,N.$EB);return r&&t2.direction.dot(r.face.normal)>0?-1:1}function rs(e,t,r=!1){switch(e){case 0:if(1===t||2===t&&!r)return 1;break;case 1:if(r){if(-1===t)return 0}else if(1===t||-2===t)return 1;break;case 2:if(r){if(1===t||-2===t)return 1}else if(-1===t)return 0;break;case 4:if(-1===t)return 0;if(1===t)return 1;break;case 3:if(-1===t||2===t&&!r)return 1;break;case 5:if(!r&&(1===t||-2===t))return 1;break;case 6:if(!r&&(-1===t||2===t))return 1;break;default:throw Error(`Unrecognized CSG operation enum "${e}".`)}return 2}function rl(e,t,r,n,i,a,o=!1,s=!1){let l=e=>{a.push(e.x),i>1&&a.push(e.y),i>2&&a.push(e.z),i>3&&a.push(e.w)};re.set(0,0,0,0).addScaledVector(e,n.a.x).addScaledVector(t,n.a.y).addScaledVector(r,n.a.z),rt.set(0,0,0,0).addScaledVector(e,n.b.x).addScaledVector(t,n.b.y).addScaledVector(r,n.b.z),rr.set(0,0,0,0).addScaledVector(e,n.c.x).addScaledVector(t,n.c.y).addScaledVector(r,n.c.z),s&&(re.normalize(),rt.normalize(),rr.normalize()),l(re),o?(l(rr),l(rt)):(l(rt),l(rr))}function ru(e,t,r,n,i,a=!1){for(let o in i){let s=t[o],l=i[o];if(!(o in t))throw Error(`CSG Operations: Attribute ${o} no available on geometry.`);let u=s.itemSize;"position"===o?(t5.fromBufferAttribute(s,e).applyMatrix4(r),l.push(t5.x,t5.y,t5.z)):"normal"===o?(t5.fromBufferAttribute(s,e).applyNormalMatrix(n),a&&t5.multiplyScalar(-1),l.push(t5.x,t5.y,t5.z)):(l.push(s.getX(e)),u>1&&l.push(s.getY(e)),u>2&&l.push(s.getZ(e)),u>3&&l.push(s.getW(e)))}}class rc{constructor(e){this.triangle=new N.lMl().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new N.lMl().copy(t)}getIntersectArray(){let e=[],{intersects:t}=this;for(let r in t)e.push(t[r]);return e}}class rd{constructor(){this.data={}}addTriangleIntersection(e,t,r,n){let{data:i}=this;i[e]||(i[e]=new rc(t)),i[e].addTriangle(r,n)}getTrianglesAsArray(e=null){let{data:t}=this,r=[];if(null!==e)e in t&&r.push(t[e].triangle);else for(let e in t)r.push(t[e].triangle);return r}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){let{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(e=>parseInt(e)):[]}getIntersectionsAsArray(e=null,t=null){let{data:r}=this,n=new Set,i=[],a=e=>{if(r[e])if(null!==t)r[e].intersects[t]&&i.push(r[e].intersects[t]);else{let t=r[e].intersects;for(let e in t)n.has(e)||(n.add(e),i.push(t[e]))}};if(null!==e)a(e);else for(let e in r)a(e);return i}reset(){this.data={}}}class rf{constructor(){this.enabled=!1,this.triangleIntersectsA=new rd,this.triangleIntersectsB=new rd,this.intersectionEdges=[]}addIntersectingTriangles(e,t,r,n){let{triangleIntersectsA:i,triangleIntersectsB:a}=this;i.addTriangleIntersection(e,t,r,n),a.addTriangleIntersection(r,n,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),ra=this)}complete(){this.enabled&&(ra=null)}}let rp=new N.kn4,rh=new N.dwI,rg=new N.lMl,rm=new N.lMl,ry=new N.lMl,rw=new N.lMl,rv=[],rx=[];function rb(e,t,r,n,i,a,o,s=0){let l=0>e.matrixWorld.determinant();rp.copy(t.matrixWorld).invert().multiply(e.matrixWorld),rh.getNormalMatrix(e.matrixWorld).multiplyScalar(l?-1:1);let u=e.geometry.groupIndices,c=e.geometry.index,d=e.geometry.attributes.position,f=t.geometry.boundsTree,p=t.geometry.index,h=t.geometry.attributes.position,g=r.ids,m=r.intersectionSet;for(let t=0,r=g.length;t<r;t++){let r=g[t],y=-1===s?0:u[r]+s,w=3*r,v=c.getX(w+0),x=c.getX(w+1),b=c.getX(w+2);rg.a.fromBufferAttribute(d,v).applyMatrix4(rp),rg.b.fromBufferAttribute(d,x).applyMatrix4(rp),rg.c.fromBufferAttribute(d,b).applyMatrix4(rp),a.reset(),a.initialize(rg);let M=m[r];for(let e=0,t=M.length;e<t;e++){let t=3*M[e],r=p.getX(t+0),n=p.getX(t+1),i=p.getX(t+2);rm.a.fromBufferAttribute(h,r),rm.b.fromBufferAttribute(h,n),rm.c.fromBufferAttribute(h,i),a.splitByTriangle(rm)}let A=a.triangles;for(let t=0,s=A.length;t<s;t++){let s=A[t],u=a.coplanarTriangleUsed?function(e,t){function r(){return Math.random()-.5}e.getNormal(ri),t2.direction.copy(ri),e.getMidpoint(t2.origin);let n=0,i=1/0;for(let e=0;e<3;e++){t2.direction.x+=1e-8*r(),t2.direction.y+=1e-8*r(),t2.direction.z+=1e-8*r(),t2.direction.multiplyScalar(-1);let a=t.raycastFirst(t2,N.$EB);if(a&&t2.direction.dot(a.face.normal)>0&&n++,null!==a&&(i=Math.min(i,a.distance)),i<=1e-15)return a.face.normal.dot(ri)>0?2:-2;if(n/3>.5||(e-n+1)/3>.5)break}return n/3>.5?-1:1}(s,f):ro(s,f);rv.length=0,rx.length=0;for(let e=0,t=n.length;e<t;e++){let t=rs(n[e],u,i);2!==t&&(rx.push(t),rv.push(o[e].getGroupAttrSet(y)))}if(0!==rv.length){rg.getBarycoord(s.a,rw.a),rg.getBarycoord(s.b,rw.b),rg.getBarycoord(s.c,rw.c);for(let t=0,n=rv.length;t<n;t++){let n=rv[t],i=0===rx[t];!function(e,t,r,n,i,a,o=!1){let s=r.attributes,l=r.index,u=3*e,c=l.getX(u+0),d=l.getX(u+1),f=l.getX(u+2);for(let e in a){let r=s[e],l=a[e];if(!(e in s))throw Error(`CSG Operations: Attribute ${e} not available on geometry.`);let u=r.itemSize;"position"===e?(t4.a.fromBufferAttribute(r,c).applyMatrix4(n),t4.b.fromBufferAttribute(r,d).applyMatrix4(n),t4.c.fromBufferAttribute(r,f).applyMatrix4(n),rl(t4.a,t4.b,t4.c,t,3,l,o)):"normal"===e?(t4.a.fromBufferAttribute(r,c).applyNormalMatrix(i),t4.b.fromBufferAttribute(r,d).applyNormalMatrix(i),t4.c.fromBufferAttribute(r,f).applyNormalMatrix(i),o&&(t4.a.multiplyScalar(-1),t4.b.multiplyScalar(-1),t4.c.multiplyScalar(-1)),rl(t4.a,t4.b,t4.c,t,3,l,o,!0)):(t8.fromBufferAttribute(r,c),t7.fromBufferAttribute(r,d),t9.fromBufferAttribute(r,f),rl(t8,t7,t9,t,u,l,o))}}(r,rw,e.geometry,e.matrixWorld,rh,n,l!==i)}}}}return g.length}function rM(e,t,r,n,i,a,o=0){let s=0>e.matrixWorld.determinant();rp.copy(t.matrixWorld).invert().multiply(e.matrixWorld),rh.getNormalMatrix(e.matrixWorld).multiplyScalar(s?-1:1);let l=t.geometry.boundsTree,u=e.geometry.groupIndices,c=e.geometry.index,d=e.geometry.attributes,f=d.position,p=[],h=e.geometry.halfEdges,g=new Set,m=tS(e.geometry);for(let e=0;e<m;e++)e in r.intersectionSet||g.add(e);for(;g.size>0;){let t=function(e){for(let t of e)return t}(g);g.delete(t),p.push(t);let r=3*t,m=c.getX(r+0),y=c.getX(r+1),w=c.getX(r+2);ry.a.fromBufferAttribute(f,m).applyMatrix4(rp),ry.b.fromBufferAttribute(f,y).applyMatrix4(rp),ry.c.fromBufferAttribute(f,w).applyMatrix4(rp);let v=ro(ry,l);rx.length=0,rv.length=0;for(let e=0,t=n.length;e<t;e++){let t=rs(n[e],v,i);2!==t&&(rx.push(t),rv.push(a[e]))}for(;p.length>0;){let t=p.pop();for(let e=0;e<3;e++){let r=h.getSiblingTriangleIndex(t,e);-1!==r&&g.has(r)&&(p.push(r),g.delete(r))}if(0!==rv.length){let r=3*t,n=c.getX(r+0),i=c.getX(r+1),a=c.getX(r+2),l=-1===o?0:u[t]+o;if(ry.a.fromBufferAttribute(f,n),ry.b.fromBufferAttribute(f,i),ry.c.fromBufferAttribute(f,a),!tH(ry))for(let t=0,r=rv.length;t<r;t++){let r=rx[t],o=rv[t].getGroupAttrSet(l),u=0===r;!function(e,t,r,n,i,a,o,s=!1){ru(e,n,i,a,o,s),ru(s?r:t,n,i,a,o,s),ru(s?t:r,n,i,a,o,s)}(n,i,a,d,e.matrixWorld,rh,o,u!==s)}}}}}function rA(e,t){let r=t;return Array.isArray(t)||(r=[],e.forEach(e=>{r[e.materialIndex]=t})),r}class rP{constructor(){this.triangleSplitter=new tJ,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new rf}getGroupRanges(e){return this.useGroups&&0!==e.groups.length?e.groups.map(e=>({...e})):[{start:0,count:1/0,materialIndex:0}]}evaluate(e,t,r,n=new tN){let i=!0;if(Array.isArray(r)||(r=[r]),Array.isArray(n)||(n=[n],i=!1),n.length!==r.length)throw Error("Evaluator: operations and target array passed as different sizes.");e.prepareGeometry(),t.prepareGeometry();let{triangleSplitter:a,attributeData:o,attributes:s,useGroups:l,consolidateGroups:u,debug:c}=this;for(;o.length<n.length;)o.push(new t1);n.forEach((t,r)=>{!function(e,t,r,n){r.clear();let i=e.attributes;for(let e=0,t=n.length;e<t;e++){let t=n[e],a=i[t];r.initializeArray(t,a.array.constructor,a.itemSize,a.normalized)}for(let e in r.attributes)n.includes(e)||r.delete(e);for(let e in t.attributes)n.includes(e)||(t.deleteAttribute(e),t.dispose())}(e.geometry,t.geometry,o[r],s)}),c.init(),function(e,t,r,n,i,a={}){let o,s,l,{useGroups:u=!0}=a,{aIntersections:c,bIntersections:d}=(s=new t3,l=new t3,t6.copy(e.matrixWorld).invert().multiply(t.matrixWorld),e.geometry.boundsTree.bvhcast(t.geometry.boundsTree,t6,{intersectsTriangles(r,n,i,a){if(!tH(r)&&!tH(n)){let o=r.intersectsTriangle(n,rn,!0);if(!o){let e=r.plane,t=n.plane,i=e.normal,a=t.normal;1===i.dot(a)&&1e-14>Math.abs(e.constant-t.constant)&&(o=!0)}if(o){let o=e.geometry.boundsTree.resolveTriangleIndex(i),u=t.geometry.boundsTree.resolveTriangleIndex(a);s.add(o,u),l.add(u,o),ra&&(ra.addEdge(rn),ra.addIntersectingTriangles(i,r,a,n))}}return!1}}),{aIntersections:s,bIntersections:l});rb(e,t,c,r,!1,n,i,o=u?0:-1),rM(e,t,c,r,!1,i,o),-1!==r.findIndex(e=>6!==e&&5!==e)&&(o=u?e.geometry.groups.length||1:-1,rb(t,e,d,r,!0,n,i,o),rM(t,e,d,r,!0,i,o)),rv.length=0,rx.length=0}(e,t,r,a,o,{useGroups:l}),c.complete();let d=this.getGroupRanges(e.geometry),f=rA(d,e.material),p=this.getGroupRanges(t.geometry),h=rA(p,t.material);p.forEach(e=>e.materialIndex+=f.length);let g=[...d,...p].map((e,t)=>({...e,index:t}));if(l){let e=[...f,...h];u&&(g=g.map(t=>{let r=e[t.materialIndex];return t.materialIndex=e.indexOf(r),t}).sort((e,t)=>e.materialIndex-t.materialIndex));let t=[];for(let r=0,n=e.length;r<n;r++){let n=!1;for(let e=0,i=g.length;e<i;e++){let i=g[e];i.materialIndex===r&&(n=!0,i.materialIndex=t.length)}n&&t.push(e[r])}n.forEach(e=>{e.material=t})}else g=[{start:0,count:1/0,index:0,materialIndex:0}],n.forEach(e=>{e.material=f[0]});return n.forEach((e,t)=>{let r=e.geometry;!function(e,t,r){let n=!1,i=-1,a=e.attributes,o=t.groupAttributes[0];for(let s in o){let o=t.getTotalLength(s),l=t.getType(s),u=t.getItemSize(s),c=t.getNormalized(s),d=a[s];(!d||d.array.length<o)&&(d=new N.THS(new l(o),u,c),e.setAttribute(s,d),n=!0);let f=0;for(let e=0,n=Math.min(r.length,t.groupCount);e<n;e++){let n=r[e].index,{array:i,type:a,length:o}=t.groupAttributes[n][s],l=new a(i.buffer,0,o);d.array.set(l,f),f+=l.length}d.needsUpdate=!0,i=o/d.itemSize}if(e.index){let t=e.index.array;if(t.length<i)e.index=null,n=!0;else for(let e=0,r=t.length;e<r;e++)t[e]=e}let s=0;e.clearGroups();for(let n=0,i=Math.min(r.length,t.groupCount);n<i;n++){let{index:i,materialIndex:a}=r[n],o=t.getCount(i);0!==o&&(e.addGroup(s,o,a),s+=o)}e.setDrawRange(0,i),e.boundsTree=null,n&&e.dispose()}(r,o[t],g),u&&function(e){for(let t=0;t<e.length-1;t++){let r=e[t],n=e[t+1];if(r.materialIndex===n.materialIndex){let i=r.start,a=n.start+n.count;n.start=i,n.count=a-i,e.splice(t,1),t--}}}(r.groups)}),i?n:n[0]}evaluateHierarchy(e,t=new tN){e.updateMatrixWorld(!0);let r=(e,t)=>{let n=e.children;for(let e=0,i=n.length;e<i;e++){let i=n[e];i.isOperationGroup?r(i,t):t(i)}},n=e=>{let t=e.children,i=!1;for(let e=0,r=t.length;e<r;e++)i=n(t[e])||i;let a=e.isDirty();if(a&&e.markUpdated(),!i||e.isOperationGroup)return i||a;{let t;return r(e,r=>{t=t?this.evaluate(t,r,r.operation):this.evaluate(e,r,r.operation)}),e._cachedGeometry=t.geometry,e._cachedMaterials=t.material,!0}};return n(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}let rT={subtraction:1,reverseSubtraction:2,addition:0,difference:4,intersection:3};function rB(e){let t=null;return e instanceof tN?(e.updateMatrixWorld(),t=e):e.traverse(e=>{e.updateMatrixWorld(),!t&&e instanceof tN&&(t=e)}),t}let rS=O.createContext(null),rE=O.forwardRef(({children:e,computeVertexNormals:t=!1,useGroups:r=!1,consolidateGroups:n=!1,showOperations:i=!1},a)=>{let o=O.useRef(null),s=O.useRef(null),l=O.useMemo(()=>Object.assign(new rP,{useGroups:r,consolidateGroups:n}),[r,n]),u=O.useCallback(()=>{try{let u=s.current.children.slice();if(u.length>0){var e,r,n,i,a;(e=o.current).dispose(),e.attributes={},e.groups=[],e.boundsTree=e.index=e.boundingBox=e.boundingSphere=null,e.drawRange={start:0,count:1/0},s.current.matrixWorld.identity();let c=rB(u.shift());if(c){for(;u.length;){let e=rB(u.shift());e&&(c=l.evaluate(c,e,rT[e.operator]||0))}o.current.boundsTree=c.geometry.boundsTree,o.current.index=c.geometry.index,o.current.attributes=c.geometry.attributes,o.current.groups=c.geometry.groups,o.current.drawRange=c.geometry.drawRange,l.useGroups&&null!=(r=o.current)&&null!=(n=r.__r3f)&&null!=(i=n.parent)&&null!=(a=i.object)&&a.material&&(o.current.__r3f.parent.object.material=c.material),t&&o.current.computeVertexNormals()}}}catch(e){console.log(e)}},[t,l]),c=O.useMemo(()=>({computeVertexNormals:t,showOperations:i,useGroups:r,consolidateGroups:n,update:u}),[t,i,r,n]);return O.useLayoutEffect(()=>void u()),O.useImperativeHandle(a,()=>({geometry:o.current,operations:s.current,...c}),[c]),O.createElement(O.Fragment,null,O.createElement("group",{matrixAutoUpdate:!1,ref:s},O.createElement(rS.Provider,{value:c},e)),O.createElement("bufferGeometry",{ref:o}))}),r_=O.forwardRef(({showOperation:e=!1,operator:t="addition",...r},n)=>{(0,D.e)({Brush:tN});let{showOperations:i}=O.useContext(rS);return O.createElement("brush",(0,q.A)({operator:t,raycast:()=>null,visible:e||i,ref:n},r))}),rI=O.forwardRef((e,t)=>O.createElement(r_,(0,q.A)({ref:t,operator:"addition"},e))),rU=O.forwardRef((e,t)=>O.createElement(r_,(0,q.A)({ref:t,operator:"subtraction"},e)))},23409:(e,t,r)=>{r.d(t,{z:()=>v,F:()=>d});var n=r(74361),i=r(56996),a=r(87347),o=r(16880);let s=n.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,children:s,makeDefault:l,...u},c)=>{let d=(0,i.C)(({set:e})=>e),f=(0,i.C)(({camera:e})=>e),p=(0,i.C)(({size:e})=>e),h=n.useRef(null);n.useImperativeHandle(c,()=>h.current,[]);let g=n.useRef(null),m=function(e,t,r){let o=(0,i.C)(e=>e.size),s=(0,i.C)(e=>e.viewport),l="number"==typeof e?e:o.width*s.dpr,u=o.height*s.dpr,c=("number"==typeof e?void 0:e)||{},{samples:d=0,depth:f,...p}=c,h=null!=f?f:c.depthBuffer,g=n.useMemo(()=>{let e=new a.nWS(l,u,{minFilter:a.k6q,magFilter:a.k6q,type:a.ix0,...p});return h&&(e.depthTexture=new a.VCu(l,u,a.RQf)),e.samples=d,e},[]);return n.useLayoutEffect(()=>{g.setSize(l,u),d&&(g.samples=d)},[d,g,l,u]),n.useEffect(()=>()=>g.dispose(),[]),g}(t);n.useLayoutEffect(()=>{u.manual||h.current.updateProjectionMatrix()},[p,u]),n.useLayoutEffect(()=>{h.current.updateProjectionMatrix()}),n.useLayoutEffect(()=>{if(l)return d(()=>({camera:h.current})),()=>d(()=>({camera:f}))},[h,l,d]);let y=0,w=null,v="function"==typeof s;return(0,i.D)(t=>{v&&(r===1/0||y<r)&&(g.current.visible=!1,t.gl.setRenderTarget(m),w=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,h.current),t.scene.background=w,t.gl.setRenderTarget(null),g.current.visible=!0,y++)}),n.createElement(n.Fragment,null,n.createElement("orthographicCamera",(0,o.A)({left:-(p.width/2),right:p.width/2,top:p.height/2,bottom:-(p.height/2),ref:h},u),!v&&s),n.createElement("group",{ref:g},v&&s(m.texture)))});function l({defaultScene:e,defaultCamera:t,renderPriority:r=1}){let a,{gl:o,scene:s,camera:l}=(0,i.C)();return(0,i.D)(()=>{a=o.autoClear,1===r&&(o.autoClear=!0,o.render(e,t)),o.autoClear=!1,o.clearDepth(),o.render(s,l),o.autoClear=a},r),n.createElement("group",{onPointerOver:()=>null})}function u({children:e,renderPriority:t=1}){let{scene:r,camera:o}=(0,i.C)(),[s]=n.useState(()=>new a.Z58);return n.createElement(n.Fragment,null,(0,i.o)(n.createElement(n.Fragment,null,e,n.createElement(l,{defaultScene:r,defaultCamera:o,renderPriority:t})),s,{events:{priority:t+1}}))}let c=n.createContext({}),d=()=>n.useContext(c),f=2*Math.PI,p=new a.B69,h=new a.kn4,[g,m]=[new a.PTz,new a.PTz],y=new a.Pq0,w=new a.Pq0,v=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=1,onUpdate:o,onTarget:l,children:d})=>{let v=(0,i.C)(e=>e.size),x=(0,i.C)(e=>e.camera),b=(0,i.C)(e=>e.controls),M=(0,i.C)(e=>e.invalidate),A=n.useRef(null),P=n.useRef(null),T=n.useRef(!1),B=n.useRef(0),S=n.useRef(new a.Pq0(0,0,0)),E=n.useRef(new a.Pq0(0,0,0));n.useEffect(()=>{E.current.copy(x.up),p.up.copy(x.up)},[x]);let _=n.useCallback(e=>{T.current=!0,(b||l)&&(S.current=(null==l?void 0:l())||("getTarget"in b?b.getTarget(S.current):null==b?void 0:b.target)),B.current=x.position.distanceTo(y),g.copy(x.quaternion),w.copy(e).multiplyScalar(B.current).add(y),p.lookAt(w),m.copy(p.quaternion),M()},[b,x,l,M]);(0,i.D)((e,t)=>{if(P.current&&A.current){var r;T.current&&(.01>g.angleTo(m)?(T.current=!1,"minPolarAngle"in b&&x.up.copy(E.current)):(g.rotateTowards(m,t*f),x.position.set(0,0,1).applyQuaternion(g).multiplyScalar(B.current).add(S.current),x.up.set(0,1,0).applyQuaternion(g).normalize(),x.quaternion.copy(g),"getTarget"in b&&b.setPosition(x.position.x,x.position.y,x.position.z),o?o():b&&b.update(t),M())),h.copy(x.matrix).invert(),null==(r=A.current)||r.quaternion.setFromRotationMatrix(h)}});let I=n.useMemo(()=>({tweenCamera:_}),[_]),[U,C]=t,R=e.endsWith("-center")?0:e.endsWith("-left")?-v.width/2+U:v.width/2-U,F=e.startsWith("center-")?0:e.startsWith("top-")?v.height/2-C:-v.height/2+C;return n.createElement(u,{renderPriority:r},n.createElement(c.Provider,{value:I},n.createElement(s,{makeDefault:!0,ref:P,position:[0,0,200]}),n.createElement("group",{ref:A,position:[R,F,0]},d)))}},79873:(e,t,r)=>{let n;r.d(t,{OH:()=>ey});var i=r(16880),a=r(74361),o=r(56996),s=r(87347),l=r(54016);class u extends s.eaF{constructor(e,t){var r,n;const i=(e=>e&&e.isCubeTexture)(e),a=Math.floor(Math.log2((null!=(n=i?null==(r=e.image[0])?void 0:r.width:e.image.width)?n:1024)/4)),o=Math.pow(2,a),u=3*Math.max(o,112),c=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,d=[i?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/u}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*o)}`,`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${l.r>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,f={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new s.WBB(1,16),new s.BKk({uniforms:f,fragmentShader:d,vertexShader:c,side:s.$EB}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class c extends s.BRH{constructor(e){super(e),this.type=s.ix0}parse(e){let t,r,n,i=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,r){t=t||1024;let n=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(i=s.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return -1<i&&(!1!==r&&(e.pos+=a+i+1),o+s.slice(0,i))},o=new Uint8Array(e);o.pos=0;let l=function(e){let t,r,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||i(1,"no header found"),(r=t.match(/^#\?(\S+)/))||i(3,"bad initial token"),u.valid|=1,u.programtype=r[1],u.string+=t+"\n";!1!==(t=a(e));){if(u.string+=t+"\n","#"===t.charAt(0)){u.comments+=t+"\n";continue}if((r=t.match(n))&&(u.gamma=parseFloat(r[1])),(r=t.match(o))&&(u.exposure=parseFloat(r[1])),(r=t.match(s))&&(u.valid|=2,u.format=r[1]),(r=t.match(l))&&(u.valid|=4,u.height=parseInt(r[1],10),u.width=parseInt(r[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid||i(3,"missing format specifier"),4&u.valid||i(3,"missing image size specifier"),u}(o),u=l.width,c=l.height,d=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&i(3,"wrong scanline width");let n=new Uint8Array(4*t*r);n.length||i(4,"unable to allocate buffer space");let a=0,o=0,s=4*t,l=new Uint8Array(4),u=new Uint8Array(s),c=r;for(;c>0&&o<e.byteLength;){o+4>e.byteLength&&i(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&i(3,"bad rgbe scanline format");let r=0,d;for(;r<s&&o<e.byteLength;){let t=(d=e[o++])>128;if(t&&(d-=128),(0===d||r+d>s)&&i(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<d;e++)u[r++]=t}else u.set(e.subarray(o,o+d),r),r+=d,o+=d}for(let e=0;e<t;e++){let r=0;n[a]=u[e+r],r+=t,n[a+1]=u[e+r],r+=t,n[a+2]=u[e+r],r+=t,n[a+3]=u[e+r],a+=4}c--}return n}(o.subarray(o.pos),u,c);switch(this.type){case s.RQf:let f=new Float32Array(4*(n=d.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let i=Math.pow(2,e[t+3]-128)/255;r[n+0]=e[t+0]*i,r[n+1]=e[t+1]*i,r[n+2]=e[t+2]*i,r[n+3]=1}(d,4*e,f,4*e);t=f,r=s.RQf;break;case s.ix0:let p=new Uint16Array(4*(n=d.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let i=Math.pow(2,e[t+3]-128)/255;r[n+0]=s.GxU.toHalfFloat(Math.min(e[t+0]*i,65504)),r[n+1]=s.GxU.toHalfFloat(Math.min(e[t+1]*i,65504)),r[n+2]=s.GxU.toHalfFloat(Math.min(e[t+2]*i,65504)),r[n+3]=s.GxU.toHalfFloat(1)}(d,4*e,p,4*e);t=p,r=s.ix0;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:u,height:c,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case s.RQf:case s.ix0:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=s.k6q,e.magFilter=s.k6q,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}var d=Uint8Array,f=Uint16Array,p=Uint32Array,h=new d([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),g=new d([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),m=new d([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y=function(e,t){for(var r=new f(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var i=new p(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return[r,i]},w=y(h,2),v=w[0],x=w[1];v[28]=258,x[258]=28;var b=y(g,0),M=b[0];b[1];for(var A=new f(32768),P=0;P<32768;++P){var T=(43690&P)>>>1|(21845&P)<<1;T=(61680&(T=(52428&T)>>>2|(13107&T)<<2))>>>4|(3855&T)<<4,A[P]=((65280&T)>>>8|(255&T)<<8)>>>1}for(var B=function(e,t,r){for(var n,i=e.length,a=0,o=new f(t);a<i;++a)++o[e[a]-1];var s=new f(t);for(a=0;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;if(r){n=new f(1<<t);var l=15-t;for(a=0;a<i;++a)if(e[a])for(var u=a<<4|e[a],c=t-e[a],d=s[e[a]-1]++<<c,p=d|(1<<c)-1;d<=p;++d)n[A[d]>>>l]=u}else for(a=0,n=new f(i);a<i;++a)e[a]&&(n[a]=A[s[e[a]-1]++]>>>15-e[a]);return n},S=new d(288),P=0;P<144;++P)S[P]=8;for(var P=144;P<256;++P)S[P]=9;for(var P=256;P<280;++P)S[P]=7;for(var P=280;P<288;++P)S[P]=8;for(var E=new d(32),P=0;P<32;++P)E[P]=5;var _=B(S,9,1),I=B(E,5,1),U=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},C=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},R=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},F=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof f?f:e instanceof p?p:d)(r-t);return n.set(e.subarray(t,r)),n},k=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new d(0);var i=!t||r,a=!r||r.i;r||(r={}),t||(t=new d(3*n));var o=function(e){var r=t.length;if(e>r){var n=new d(Math.max(2*r,e));n.set(t),t=n}},s=r.f||0,l=r.p||0,u=r.b||0,c=r.l,f=r.d,p=r.m,y=r.n,w=8*n;do{if(!c){r.f=s=C(e,l,1);var x=C(e,l+1,3);if(l+=3,x)if(1==x)c=_,f=I,p=9,y=5;else if(2==x){var b=C(e,l,31)+257,A=C(e,l+10,15)+4,P=b+C(e,l+5,31)+1;l+=14;for(var T=new d(P),S=new d(19),E=0;E<A;++E)S[m[E]]=C(e,l+3*E,7);l+=3*A;for(var k=U(S),z=(1<<k)-1,q=B(S,k,1),E=0;E<P;){var O=q[C(e,l,z)];l+=15&O;var D=O>>>4;if(D<16)T[E++]=D;else{var N=0,L=0;for(16==D?(L=3+C(e,l,3),l+=2,N=T[E-1]):17==D?(L=3+C(e,l,7),l+=3):18==D&&(L=11+C(e,l,127),l+=7);L--;)T[E++]=N}}var V=T.subarray(0,b),G=T.subarray(b);p=U(V),y=U(G),c=B(V,p,1),f=B(G,y,1)}else throw"invalid block type";else{var H,D=((H=l)/8|0)+(7&H&&1)+4,W=e[D-4]|e[D-3]<<8,j=D+W;if(j>n){if(a)throw"unexpected EOF";break}i&&o(u+W),t.set(e.subarray(D,j),u),r.b=u+=W,r.p=l=8*j;continue}if(l>w){if(a)throw"unexpected EOF";break}}i&&o(u+131072);for(var X=(1<<p)-1,Y=(1<<y)-1,$=l;;$=l){var N=c[R(e,l)&X],Z=N>>>4;if((l+=15&N)>w){if(a)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(Z<256)t[u++]=Z;else if(256==Z){$=l,c=null;break}else{var Q=Z-254;if(Z>264){var E=Z-257,K=h[E];Q=C(e,l,(1<<K)-1)+v[E],l+=K}var J=f[R(e,l)&Y],ee=J>>>4;if(!J)throw"invalid distance";l+=15&J;var G=M[ee];if(ee>3){var K=g[ee];G+=R(e,l)&(1<<K)-1,l+=K}if(l>w){if(a)throw"unexpected EOF";break}i&&o(u+131072);for(var et=u+Q;u<et;u+=4)t[u]=t[u-G],t[u+1]=t[u+1-G],t[u+2]=t[u+2-G],t[u+3]=t[u+3-G];u=et}}r.l=c,r.p=$,r.b=u,c&&(s=1,r.m=p,r.d=f,r.n=y)}while(!s);return u==t.length?t:F(t,0,u)},z=new d(0),q=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function O(e,t){return k((q(e),e.subarray(2,-4)),t)}var D="u">typeof TextDecoder&&new TextDecoder;try{D.decode(z,{stream:!0})}catch(e){}let N=l.r>=152;class L extends s.BRH{constructor(e){super(e),this.type=s.ix0}parse(e){let t={l:0,c:0,lc:0};function r(e,r,n,i,a){for(;n<e;)r=r<<8|B(i,a),n+=8;t.l=r>>(n-=e)&(1<<e)-1,t.c=r,t.lc=n}let n=Array(59),i={c:0,lc:0};function a(e,t,r,n){e=e<<8|B(r,n),t+=8,i.c=e,i.lc=t}let o={c:0,lc:0};function l(e,t,r,n,s,l,u,c,d,f){if(e==t){n<8&&(a(r,n,s,u),r=i.c,n=i.lc);var p=r>>(n-=8),p=new Uint8Array([p])[0];if(d.value+p>f)return!1;for(var h=c[d.value-1];p-- >0;)c[d.value++]=h}else{if(!(d.value<f))return!1;c[d.value++]=e}o.c=r,o.lc=n}function u(e){var t=65535&e;return t>32767?t-65536:t}let c={a:0,b:0};function d(e,t){var r=u(e),n=u(t),i=r+(1&n)+(n>>1),a=i-n;c.a=i,c.b=a}function f(e,t){var r=65535&t,n=(65535&e)-(r>>1)&65535;c.a=r+n-32768&65535,c.b=n}function p(e,s,u,c,d,f){var p=u.value,h=T(s,u),g=T(s,u);u.value+=4;var m=T(s,u);if(u.value+=4,h<0||h>=65537||g<0||g>=65537)throw"Something wrong with HUF_ENCSIZE";for(var y=Array(65537),w=Array(16384),v=0;v<16384;v++)w[v]={},w[v].len=0,w[v].lit=0,w[v].p=null;var x=c-(u.value-p);if(!function(e,i,a,o,s,l,u){for(var c=0,d=0;s<=l;s++){if(a.value-a.value>o)return!1;r(6,c,d,e,a);var f=t.l;if(c=t.c,d=t.lc,u[s]=f,63==f){if(a.value-a.value>o)throw"Something wrong with hufUnpackEncTable";r(8,c,d,e,a);var p=t.l+6;if(c=t.c,d=t.lc,s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[s++]=0;s--}else if(f>=59){var p=f-59+2;if(s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)n[t]=0;for(var t=0;t<65537;++t)n[e[t]]+=1;for(var r=0,t=58;t>0;--t){var i=r+n[t]>>1;n[t]=r,r=i}for(var t=0;t<65537;++t){var a=e[t];a>0&&(e[t]=a|n[a]++<<6)}}(u)}(e,0,u,x,h,g,y),m>8*(c-(u.value-p)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var i=e[t]>>6,a=63&e[t];if(i>>a)throw"Invalid table entry";if(a>14){var o=n[i>>a-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var s=o.p;o.p=Array(o.lit);for(var l=0;l<o.lit-1;++l)o.p[l]=s[l]}else o.p=[,];o.p[o.lit-1]=t}else if(a)for(var u=0,l=1<<14-a;l>0;l--){var o=n[(i<<14-a)+u];if(o.len||o.p)throw"Invalid table entry";o.len=a,o.lit=t,u++}}}(y,h,g,w),function(e,t,r,n,s,u,c,d,f,p){for(var h=0,g=0,m=Math.trunc(s.value+(u+7)/8);s.value<m;)for(a(h,g,r,s),h=i.c,g=i.lc;g>=14;){var y=t[h>>g-14&16383];if(y.len)g-=y.len,l(y.lit,c,h,g,r,n,s,f,p,d),h=o.c,g=o.lc;else{if(!y.p)throw"hufDecode issues";for(w=0;w<y.lit;w++){for(var w,v=63&e[y.p[w]];g<v&&s.value<m;)a(h,g,r,s),h=i.c,g=i.lc;if(g>=v&&e[y.p[w]]>>6==(h>>g-v&(1<<v)-1)){g-=v,l(y.p[w],c,h,g,r,n,s,f,p,d),h=o.c,g=o.lc;break}}if(w==y.lit)throw"hufDecode issues"}}var x=8-u&7;for(h>>=x,g-=x;g>0;){var y=t[h<<14-g&16383];if(y.len)g-=y.len,l(y.lit,c,h,g,r,n,s,f,p,d),h=o.c,g=o.lc;else throw"hufDecode issues"}}(y,w,e,s,u,m,g,f,d,{value:0})}function h(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function g(e,t){for(var r=0,n=Math.floor((e.length+1)/2),i=0,a=e.length-1;!(i>a)&&(t[i++]=e[r++],!(i>a));){;t[i++]=e[n++]}}function m(e){for(var t=e.byteLength,r=[],n=0,i=new DataView(e);t>0;){var a=i.getInt8(n++);if(a<0){var o=-a;t-=o+1;for(var s=0;s<o;s++)r.push(i.getUint8(n++))}else{var o=a;t-=2;for(var l=i.getUint8(n++),s=0;s<o+1;s++)r.push(l)}}return r}function y(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function w(e){var t=new Uint8Array(m(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return h(t),g(t,r),new DataView(r.buffer)}function v(e){var t=O(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return h(t),g(t,r),new DataView(r.buffer)}function x(e){for(var t=e.viewer,r={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),a=0,o=Array(e.channels),s=0;s<e.channels;s++)o[s]={},o[s].start=a,o[s].end=o[s].start,o[s].nx=e.width,o[s].ny=e.lines,o[s].size=e.type,a+=o[s].nx*o[s].ny*o[s].size;var l=C(t,r),u=C(t,r);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=u)for(var s=0;s<u-l+1;s++)i[s+l]=S(t,r);var h=new Uint16Array(65536),g=function(e,t){for(var r=0,n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);for(var i=r-1;r<65536;)t[r++]=0;return i}(i,h),m=T(t,r);p(e.array,t,r,m,n,a);for(var s=0;s<e.channels;++s)for(var y=o[s],w=0;w<o[s].size;++w)!function(e,t,r,n,i,a,o){for(var s=o<16384,l=r>i?i:r,u=1;u<=l;)u<<=1;for(u>>=1,p=u,u>>=1;u>=1;){for(var p,h,g,m,y,w=0,v=0+a*(i-p),x=a*u,b=a*p,M=n*u,A=n*p;w<=v;w+=b){for(var P=w,T=w+n*(r-p);P<=T;P+=A){var B=P+M,S=P+x,E=S+M;s?(d(e[P+t],e[S+t]),h=c.a,m=c.b,d(e[B+t],e[E+t]),g=c.a,y=c.b,d(h,g),e[P+t]=c.a,e[B+t]=c.b,d(m,y)):(f(e[P+t],e[S+t]),h=c.a,m=c.b,f(e[B+t],e[E+t]),g=c.a,y=c.b,f(h,g),e[P+t]=c.a,e[B+t]=c.b,f(m,y)),e[S+t]=c.a,e[E+t]=c.b}if(r&u){var S=P+x;s?d(e[P+t],e[S+t]):f(e[P+t],e[S+t]),h=c.a,e[S+t]=c.b,e[P+t]=h}}if(i&u)for(var P=w,T=w+n*(r-p);P<=T;P+=A){var B=P+M;s?d(e[P+t],e[B+t]):f(e[P+t],e[B+t]),h=c.a,e[B+t]=c.b,e[P+t]=h}p=u,u>>=1}}(n,y.start+w,y.nx,y.size,y.ny,y.nx*y.size,g);for(var v=a,x=0;x<v;++x)n[x]=h[n[x]];for(var b=0,M=new Uint8Array(n.buffer.byteLength),A=0;A<e.lines;A++)for(var P=0;P<e.channels;P++){var y=o[P],B=y.nx*y.size,E=new Uint8Array(n.buffer,2*y.end,2*B);M.set(E,b),b+=2*B,y.end+=B}return new DataView(M.buffer)}function b(e){var t=O(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(r):new Uint32Array(r),i=0,a=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=i,o[1]=o[0]+e.width,i=o[1]+e.width;for(let i=0;i<e.width;++i)r+=t[o[0]++]<<8|t[o[1]++],n[a]=r,a++;break;case 2:o[0]=i,o[1]=o[0]+e.width,o[2]=o[1]+e.width,i=o[2]+e.width;for(let i=0;i<e.width;++i)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,n[a]=r,a++}}return new DataView(n.buffer)}function M(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:E(t,r),unknownUncompressedSize:E(t,r),unknownCompressedSize:E(t,r),acCompressedSize:E(t,r),dcCompressedSize:E(t,r),rleCompressedSize:E(t,r),rleUncompressedSize:E(t,r),rleRawSize:E(t,r),totalAcUncompressedCount:E(t,r),totalDcUncompressedCount:E(t,r),acCompression:E(t,r)};if(i.version<2)throw"EXRLoader.parse: "+q.compression+" version "+i.version+" is unsupported";for(var a=[],o=C(t,r)-2;o>0;){var l=A(t.buffer,r),u=S(t,r),c=u>>2&3,d=new Int8Array([(u>>4)-1])[0],f=S(t,r);a.push({name:l,index:d,type:f,compression:c}),o-=l.length+3}for(var h=q.channels,g=Array(e.channels),y=0;y<e.channels;++y){var w=g[y]={},x=h[y];w.name=x.name,w.compression=0,w.decoded=!1,w.type=x.pixelType,w.pLinear=x.pLinear,w.width=e.width,w.height=e.lines}for(var b={idx:[,,,]},M=0;M<e.channels;++M)for(var w=g[M],y=0;y<a.length;++y){var P=a[y];w.name==P.name&&(w.compression=P.compression,P.index>=0&&(b.idx[P.index]=M),w.offset=M)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var T=new Uint16Array(i.totalAcUncompressedCount);p(e.array,t,r,i.acCompressedSize,T,i.totalAcUncompressedCount);break;case 1:var B=e.array.slice(r.value,r.value+i.totalAcUncompressedCount),_=O(B),T=new Uint16Array(_.buffer);r.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var I=new Uint16Array(v({array:e.array,offset:r,size:i.dcCompressedSize}).buffer);r.value+=i.dcCompressedSize}if(i.rleRawSize>0){var B=e.array.slice(r.value,r.value+i.rleCompressedSize),_=O(B),R=m(_.buffer);r.value+=i.rleCompressedSize}for(var F=0,k=Array(g.length),y=0;y<k.length;++y)k[y]=[];for(var z=0;z<e.lines;++z)for(var D=0;D<g.length;++D)k[D].push(F),F+=g[D].width*e.type*2;!function(e,t,r,n,i,a){var o=new DataView(a.buffer),l=r[e.idx[0]].width,u=r[e.idx[0]].height,c=Math.floor(l/8),d=Math.ceil(l/8),f=Math.ceil(u/8),p=l-(d-1)*8,h=u-(f-1)*8,g={value:0},m=[,,,],y=[,,,],w=[,,,],v=[,,,],x=[,,,];for(let r=0;r<3;++r)x[r]=t[e.idx[r]],m[r]=r<1?0:m[r-1]+d*f,y[r]=new Float32Array(64),w[r]=new Uint16Array(64),v[r]=new Uint16Array(64*d);for(let t=0;t<f;++t){var b,M,A=8;t==f-1&&(A=h);var P=8;for(let e=0;e<d;++e){e==d-1&&(P=p);for(let e=0;e<3;++e){w[e].fill(0),w[e][0]=i[m[e]++],function(e,t,r){for(var n,i=1;i<64;)65280==(n=t[e.value])?i=64:n>>8==255?i+=255&n:(r[i]=n,i++),e.value++}(g,n,w[e]),b=w[e],(M=y[e])[0]=U(b[0]),M[1]=U(b[1]),M[2]=U(b[5]),M[3]=U(b[6]),M[4]=U(b[14]),M[5]=U(b[15]),M[6]=U(b[27]),M[7]=U(b[28]),M[8]=U(b[2]),M[9]=U(b[4]),M[10]=U(b[7]),M[11]=U(b[13]),M[12]=U(b[16]),M[13]=U(b[26]),M[14]=U(b[29]),M[15]=U(b[42]),M[16]=U(b[3]),M[17]=U(b[8]),M[18]=U(b[12]),M[19]=U(b[17]),M[20]=U(b[25]),M[21]=U(b[30]),M[22]=U(b[41]),M[23]=U(b[43]),M[24]=U(b[9]),M[25]=U(b[11]),M[26]=U(b[18]),M[27]=U(b[24]),M[28]=U(b[31]),M[29]=U(b[40]),M[30]=U(b[44]),M[31]=U(b[53]),M[32]=U(b[10]),M[33]=U(b[19]),M[34]=U(b[23]),M[35]=U(b[32]),M[36]=U(b[39]),M[37]=U(b[45]),M[38]=U(b[52]),M[39]=U(b[54]),M[40]=U(b[20]),M[41]=U(b[22]),M[42]=U(b[33]),M[43]=U(b[38]),M[44]=U(b[46]),M[45]=U(b[51]),M[46]=U(b[55]),M[47]=U(b[60]),M[48]=U(b[21]),M[49]=U(b[34]),M[50]=U(b[37]),M[51]=U(b[47]),M[52]=U(b[50]),M[53]=U(b[56]),M[54]=U(b[59]),M[55]=U(b[61]),M[56]=U(b[35]),M[57]=U(b[36]),M[58]=U(b[48]),M[59]=U(b[49]),M[60]=U(b[57]),M[61]=U(b[58]),M[62]=U(b[62]),M[63]=U(b[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(3*3.14159/8);for(var a=[,,,,],o=[,,,,],s=[,,,,],l=[,,,,],u=0;u<8;++u){var c=8*u;a[0]=r*e[c+2],a[1]=i*e[c+2],a[2]=r*e[c+6],a[3]=i*e[c+6],o[0]=t*e[c+1]+n*e[c+3]+.2777854612564676*e[c+5]+.09754573032714427*e[c+7],o[1]=n*e[c+1]-.09754573032714427*e[c+3]-t*e[c+5]-.2777854612564676*e[c+7],o[2]=.2777854612564676*e[c+1]-t*e[c+3]+.09754573032714427*e[c+5]+n*e[c+7],o[3]=.09754573032714427*e[c+1]-.2777854612564676*e[c+3]+n*e[c+5]-t*e[c+7],s[0]=.35355362513961314*(e[c+0]+e[c+4]),s[3]=.35355362513961314*(e[c+0]-e[c+4]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[c+0]=l[0]+o[0],e[c+1]=l[1]+o[1],e[c+2]=l[2]+o[2],e[c+3]=l[3]+o[3],e[c+4]=l[3]-o[3],e[c+5]=l[2]-o[2],e[c+6]=l[1]-o[1],e[c+7]=l[0]-o[0]}for(var d=0;d<8;++d)a[0]=r*e[16+d],a[1]=i*e[16+d],a[2]=r*e[48+d],a[3]=i*e[48+d],o[0]=t*e[8+d]+n*e[24+d]+.2777854612564676*e[40+d]+.09754573032714427*e[56+d],o[1]=n*e[8+d]-.09754573032714427*e[24+d]-t*e[40+d]-.2777854612564676*e[56+d],o[2]=.2777854612564676*e[8+d]-t*e[24+d]+.09754573032714427*e[40+d]+n*e[56+d],o[3]=.09754573032714427*e[8+d]-.2777854612564676*e[24+d]+n*e[40+d]-t*e[56+d],s[0]=.35355362513961314*(e[d]+e[32+d]),s[3]=.35355362513961314*(e[d]-e[32+d]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[0+d]=l[0]+o[0],e[8+d]=l[1]+o[1],e[16+d]=l[2]+o[2],e[24+d]=l[3]+o[3],e[32+d]=l[3]-o[3],e[40+d]=l[2]-o[2],e[48+d]=l[1]-o[1],e[56+d]=l[0]-o[0]}(y[e])}for(var T=y,B=0;B<64;++B){var S=T[0][B],E=T[1][B],_=T[2][B];T[0][B]=S+1.5747*_,T[1][B]=S-.1873*E-.4682*_,T[2][B]=S+1.8556*E}for(let t=0;t<3;++t)!function(e,t,r){for(var n,i=0;i<64;++i){t[r+i]=s.GxU.toHalfFloat((n=e[i])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(9.025013291561939,Math.abs(n)-1))}}(y[t],v[t],64*e)}let a=0;for(let n=0;n<3;++n){let i=r[e.idx[n]].type;for(let e=8*t;e<8*t+A;++e){a=x[n][e];for(let t=0;t<c;++t){let r=64*t+(7&e)*8;o.setUint16(a+0*i,v[n][r+0],!0),o.setUint16(a+2*i,v[n][r+1],!0),o.setUint16(a+4*i,v[n][r+2],!0),o.setUint16(a+6*i,v[n][r+3],!0),o.setUint16(a+8*i,v[n][r+4],!0),o.setUint16(a+10*i,v[n][r+5],!0),o.setUint16(a+12*i,v[n][r+6],!0),o.setUint16(a+14*i,v[n][r+7],!0),a+=16*i}}if(c!=d)for(let e=8*t;e<8*t+A;++e){let t=x[n][e]+8*c*2*i,r=64*c+(7&e)*8;for(let e=0;e<P;++e)o.setUint16(t+2*e*i,v[n][r+e],!0)}}}for(var I=new Uint16Array(l),o=new DataView(a.buffer),C=0;C<3;++C){r[e.idx[C]].decoded=!0;var R=r[e.idx[C]].type;if(2==r[C].type)for(var F=0;F<u;++F){let e=x[C][F];for(var k=0;k<l;++k)I[k]=o.getUint16(e+2*k*R,!0);for(var k=0;k<l;++k)o.setFloat32(e+2*k*R,U(I[k]),!0)}}}(b,k,g,T,I,n);for(var y=0;y<g.length;++y){var w=g[y];if(!w.decoded)if(2===w.compression)for(var N=0,L=0,z=0;z<e.lines;++z){for(var V=k[y][N],G=0;G<w.width;++G){for(var H=0;H<2*w.type;++H)n[V++]=R[L+H*w.width*w.height];L++}N++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(n.buffer)}function A(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;var i=new TextDecoder().decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,i}function P(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function T(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function B(e,t){var r=e[t.value];return t.value=t.value+1,r}function S(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let E=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function _(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function I(e,t){return s.GxU.toHalfFloat(_(e,t))}function U(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function C(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function R(e,t){return U(C(e,t))}let F=new DataView(e),k=new Uint8Array(e),z={value:0},q=function(e,t,r){let n={};if(0x1312f76!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);let i=e.getUint8(5);n.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},r.value=8;for(var a=!0;a;){var o=A(t,r);if(0==o)a=!1;else{var s=A(t,r),l=T(e,r),u=function(e,t,r,n,i){var a,o,s,l,u,c,d;if("string"===n||"stringvector"===n||"iccProfile"===n)return a=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+i)),r.value=r.value+i,a;if("chlist"===n)return function(e,t,r,n){for(var i=r.value,a=[];r.value<i+n-1;){var o=A(t,r),s=P(e,r),l=S(e,r);r.value+=3;var u=P(e,r),c=P(e,r);a.push({name:o,pixelType:s,pLinear:l,xSampling:u,ySampling:c})}return r.value+=1,a}(e,t,r,i);if("chromaticities"===n)return o=_(e,r),s=_(e,r),l=_(e,r),u=_(e,r),c=_(e,r),{redX:o,redY:s,greenX:l,greenY:u,blueX:c,blueY:_(e,r),whiteX:_(e,r),whiteY:_(e,r)};if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][S(e,r)];if("box2i"===n)return d=T(e,r),{xMin:d,yMin:T(e,r),xMax:T(e,r),yMax:T(e,r)};else if("lineOrder"===n)return["INCREASING_Y"][S(e,r)];else if("float"===n)return _(e,r);else if("v2f"===n)return[_(e,r),_(e,r)];else if("v3f"===n)return[_(e,r),_(e,r),_(e,r)];else if("int"===n)return P(e,r);else if("rational"===n)return[P(e,r),T(e,r)];else if("timecode"===n)return[T(e,r),T(e,r)];else return"preview"===n?(r.value+=i,"skipped"):(r.value+=i,void 0)}(e,t,r,s,l);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):n[o]=u}}if((-5&i)!=0)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(F,e,z),D=function(e,t,r,n,i){let a={size:0,viewer:t,array:r,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[N?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=y;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=w;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=v;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=v;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=x;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=b;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=M;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=M;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(a.scanlineBlockSize=a.lines,1==a.type)switch(i){case s.RQf:a.getter=R,a.inputSize=2;break;case s.ix0:a.getter=C,a.inputSize=2}else if(2==a.type)switch(i){case s.RQf:a.getter=_,a.inputSize=4;break;case s.ix0:a.getter=I,a.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".";a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(var o=0;o<a.blockCount;o++)E(t,n);a.outputChannels=3==a.channels?4:a.channels;let l=a.width*a.height*a.outputChannels;switch(i){case s.RQf:a.byteArray=new Float32Array(l),a.channels<a.outputChannels&&a.byteArray.fill(1,0,l);break;case s.ix0:a.byteArray=new Uint16Array(l),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?a.format=s.GWd:a.format=s.VT0,N?a.colorSpace="srgb-linear":a.encoding=3e3,a}(q,F,k,z,this.type),L={value:0},V={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<D.height/D.scanlineBlockSize;e++){let t=T(F,z);D.size=T(F,z),D.lines=t+D.scanlineBlockSize>D.height?D.height-t:D.scanlineBlockSize;let r=D.size<D.lines*D.bytesPerLine?D.uncompress(D):y(D);z.value+=D.size;for(let t=0;t<D.scanlineBlockSize;t++){let n=t+e*D.scanlineBlockSize;if(n>=D.height)break;for(let e=0;e<D.channels;e++){let i=V[q.channels[e].name];for(let a=0;a<D.width;a++){L.value=(t*(D.channels*D.width)+e*D.width+a)*D.inputSize;let o=(D.height-1-n)*(D.width*D.outputChannels)+a*D.outputChannels+i;D.byteArray[o]=D.getter(r,L)}}}}return{header:q,width:D.width,height:D.height,data:D.byteArray,format:D.format,[N?"colorSpace":"encoding"]:D[N?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){N?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=s.k6q,e.magFilter=s.k6q,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,n)}}var V=r(35036);let G=(e,t,r)=>{let n;switch(e){case s.OUM:n=new Uint8ClampedArray(t*r*4);break;case s.ix0:n=new Uint16Array(t*r*4);break;case s.bkx:n=new Uint32Array(t*r*4);break;case s.tJf:n=new Int8Array(t*r*4);break;case s.fBL:n=new Int16Array(t*r*4);break;case s.Yuy:n=new Int32Array(t*r*4);break;case s.RQf:n=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return n};class H{constructor(e){var t,r,i,a,o,l,u,c,d,f,p,h,g,m,y,w;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const v={format:s.GWd,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null==(t=e.renderTargetOptions)?void 0:t.anisotropy)!==void 0?null==(r=e.renderTargetOptions)?void 0:r.anisotropy:1,generateMipmaps:(null==(i=e.renderTargetOptions)?void 0:i.generateMipmaps)!==void 0&&(null==(a=e.renderTargetOptions)?void 0:a.generateMipmaps),magFilter:(null==(o=e.renderTargetOptions)?void 0:o.magFilter)!==void 0?null==(l=e.renderTargetOptions)?void 0:l.magFilter:s.k6q,minFilter:(null==(u=e.renderTargetOptions)?void 0:u.minFilter)!==void 0?null==(c=e.renderTargetOptions)?void 0:c.minFilter:s.k6q,samples:(null==(d=e.renderTargetOptions)?void 0:d.samples)!==void 0?null==(f=e.renderTargetOptions)?void 0:f.samples:void 0,wrapS:(null==(p=e.renderTargetOptions)?void 0:p.wrapS)!==void 0?null==(h=e.renderTargetOptions)?void 0:h.wrapS:s.ghU,wrapT:(null==(g=e.renderTargetOptions)?void 0:g.wrapT)!==void 0?null==(m=e.renderTargetOptions)?void 0:m.wrapT:s.ghU};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=H.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new s.Z58,this._camera=new s.qUd,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,r,i)=>{if(void 0!==n)return n;let a=new s.nWS(1,1,i);t.setRenderTarget(a);let o=new s.eaF(new s.bdM,new s.V9B({color:0xffffff}));t.render(o,r),t.setRenderTarget(null);let l=G(e,a.width,a.height);return t.readRenderTargetPixels(a,0,0,a.width,a.height,l),a.dispose(),o.geometry.dispose(),o.material.dispose(),n=0!==l[0]})(this._type,this._renderer,this._camera,v)){let e;this._type===s.ix0&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?s.RQf:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${s.RQf}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new s.eaF(new s.bdM,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new s.nWS(this.width,this.height,v),this._renderTarget.texture.mapping=(null==(y=e.renderTargetOptions)?void 0:y.mapping)!==void 0?null==(w=e.renderTargetOptions)?void 0:w.mapping:s.UTZ}static instantiateRenderer(){let e=new V.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=G(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new s.GYF(this.toArray(),this.width,this.height,s.GWd,this._type,(null==e?void 0:e.mapping)||s.UTZ,(null==e?void 0:e.wrapS)||s.ghU,(null==e?void 0:e.wrapT)||s.ghU,(null==e?void 0:e.magFilter)||s.k6q,(null==e?void 0:e.minFilter)||s.k6q,(null==e?void 0:e.anisotropy)||1,s.Zr2);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof s.BKk&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof s.gPd&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof s.gPd&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}let W=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,j=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class X extends s.BKk{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:n,gainMapMax:i,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:l,sdr:u,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:W,fragmentShader:j,uniforms:{sdr:{value:u},gainMap:{value:c},gamma:{value:new s.Pq0(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new s.Pq0().fromArray(t)},offsetSdr:{value:new s.Pq0().fromArray(r)},gainMapMin:{value:new s.Pq0().fromArray(n)},gainMapMax:{value:new s.Pq0().fromArray(i)},weightFactor:{value:(Math.log2(a)-o)/(l-o)}},blending:s.XIg,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Y extends Error{}class $ extends Error{}let Z=(e,t,r)=>{let n=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(n)return n[1];let i=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(i){let e=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(void 0!==r)return r;throw Error(`Can't find ${t} in gainmap metadata`)};class Q{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let n,i=this.options.debug,a=new DataView(e.buffer);if(65496!==a.getUint16(0))return void r(Error("Not a valid jpeg"));let o=a.byteLength,s=2,l=0;for(;s<o;){if(++l>250)return void r(Error(`Found no marker after ${l} loops `));if(255!==a.getUint8(s))return void r(Error(`Not a valid marker at offset 0x${s.toString(16)}, found: 0x${a.getUint8(s).toString(16)}`));if(n=a.getUint8(s+1),i&&console.log(`Marker: ${n.toString(16)}`),226===n){i&&console.log("Found APP2 marker (0xffe2)");let e=s+4;if(0x4d504600===a.getUint32(e)){let n,i=e+4;if(18761===a.getUint16(i))n=!1;else{if(19789!==a.getUint16(i))return void r(Error("No valid endianness marker found in TIFF header"));n=!0}if(42!==a.getUint16(i+2,!n))return void r(Error("Not valid TIFF data! (no 0x002A marker)"));let o=a.getUint32(i+4,!n);if(o<8)return void r(Error("Not valid TIFF data! (First offset less than 8)"));let s=i+o,l=a.getUint16(s,!n),u=s+2,c=0;for(let e=u;e<u+12*l;e+=12)45057===a.getUint16(e,!n)&&(c=a.getUint32(e+8,!n));let d=s+2+12*l+4,f=[];for(let e=d;e<d+16*c;e+=16){let t={MPType:a.getUint32(e,!n),size:a.getUint32(e+4,!n),dataOffset:a.getUint32(e+8,!n),dependantImages:a.getUint32(e+12,!n),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=i+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,f.push(t)}if(this.options.extractNonFII&&f.length){let e=new Blob([a]),r=[];for(let t of f){if(t.isFII&&!this.options.extractFII)continue;let n=e.slice(t.start,t.end+1,"image/jpeg");r.push(n)}t(r)}}}s+=2+a.getUint16(s+2)}})}}let K=async e=>{let t=(e=>{let t,r=(t="u">typeof TextDecoder?new TextDecoder().decode(e):e.toString()).indexOf("<x:xmpmeta");for(;-1!==r;){let e=t.indexOf("x:xmpmeta>",r),n=t.slice(r,e+10);try{let e=Z(n,"hdrgm:GainMapMin","0"),t=Z(n,"hdrgm:GainMapMax"),r=Z(n,"hdrgm:Gamma","1"),i=Z(n,"hdrgm:OffsetSDR","0.015625"),a=Z(n,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(n),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(n);if(!l)throw Error("Incomplete gainmap metadata");let u=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetHdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(u)}}catch(e){}r=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new $("Gain map XMP metadata not found");let r=new Q({extractFII:!0,extractNonFII:!0}),n=await r.extract(e);if(2!==n.length)throw new Y("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:t}},J=e=>new Promise((t,r)=>{let n=document.createElement("img");n.onload=()=>{t(n)},n.onerror=e=>{r(e)},n.src=URL.createObjectURL(e)});class ee extends s.aHM{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new s.KPJ}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=new X({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new s.gPd,sdr:new s.gPd});return new H({width:16,height:16,type:s.ix0,colorSpace:s.Zr2,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,n){let i,a,o=n?new Blob([n],{type:"image/jpeg"}):void 0,l=new Blob([r],{type:"image/jpeg"}),u=!1;if("u"<typeof createImageBitmap){let e=await Promise.all([o?J(o):Promise.resolve(void 0),J(l)]);a=e[0],i=e[1],u=!0}else{let e=await Promise.all([o?createImageBitmap(o,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);a=e[0],i=e[1]}let c=new s.gPd(a||new ImageData(2,2),s.UTZ,s.ghU,s.ghU,s.k6q,s.NZq,s.GWd,s.OUM,1,s.Zr2);c.flipY=u,c.needsUpdate=!0;let d=new s.gPd(i,s.UTZ,s.ghU,s.ghU,s.k6q,s.NZq,s.GWd,s.OUM,1,s.er$);d.flipY=u,d.needsUpdate=!0,e.width=i.width,e.height=i.height,e.material.gainMap=c,e.material.sdr=d,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class et extends ee{load([e,t,r],n,i,a){let o,l,u,c=this.prepareQuadRenderer(),d=async()=>{if(o&&l&&u){try{await this.render(c,u,o,l)}catch(n){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof a&&a(n),c.disposeOnDemandRenderer();return}"function"==typeof n&&n(c),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),c.disposeOnDemandRenderer()}},f=!0,p=0,h=0,g=!0,m=0,y=0,w=!0,v=0,x=0,b=()=>{"function"==typeof i&&i(new ProgressEvent("progress",{lengthComputable:f&&g&&w,loaded:h+y+x,total:p+m+v}))};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let M=new s.Y9S(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");o=e,await d()},e=>{f=e.lengthComputable,h=e.loaded,p=e.total,b()},t=>{this.manager.itemError(e),"function"==typeof a&&a(t)});let A=new s.Y9S(this._internalLoadingManager);A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setPath(this.path),A.setWithCredentials(this.withCredentials),A.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");l=e,await d()},e=>{g=e.lengthComputable,y=e.loaded,m=e.total,b()},e=>{this.manager.itemError(t),"function"==typeof a&&a(e)});let P=new s.Y9S(this._internalLoadingManager);return P.setRequestHeader(this.requestHeader),P.setPath(this.path),P.setWithCredentials(this.withCredentials),P.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");u=JSON.parse(e),await d()},e=>{w=e.lengthComputable,x=e.loaded,v=e.total,b()},e=>{this.manager.itemError(r),"function"==typeof a&&a(e)}),c}}class er extends ee{load(e,t,r,n){let i=this.prepareQuadRenderer(),a=new s.Y9S(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async r=>{let a,o,s;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await K(l);a=e.sdr,o=e.gainMap,s=e.metadata}catch(t){if(t instanceof $||t instanceof Y)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),s={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=l;else throw t}try{await this.render(i,s,a,o)}catch(t){this.manager.itemError(e),"function"==typeof n&&n(t),i.disposeOnDemandRenderer();return}"function"==typeof t&&t(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof n&&n(t)}),i}}let en={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ei="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",ea=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function eo({files:e=ea,path:t="",preset:r,colorSpace:n,extensions:i}={}){r&&(eu(r),e=en[r],t=ei);let l=Array.isArray(e),{extension:u,isCubemap:c}=ec(e),d=ed(u);if(!d)throw Error("useEnvironment: Unrecognized file extension: "+e);let f=(0,o.C)(e=>e.gl);(0,a.useLayoutEffect)(()=>{("webp"===u||"jpg"===u||"jpeg"===u)&&f.domElement.addEventListener("webglcontextlost",function(){o.G.clear(d,l?[e]:e)},{once:!0})},[e,f.domElement]);let p=(0,o.G)(d,l?[e]:e,e=>{("webp"===u||"jpg"===u||"jpeg"===u)&&e.setRenderer(f),null==e.setPath||e.setPath(t),i&&i(e)}),h=l?p[0]:p;if("jpg"===u||"jpeg"===u||"webp"===u){var g;h=null==(g=h.renderTarget)?void 0:g.texture}return h.mapping=c?s.hy7:s.wfO,h.colorSpace=null!=n?n:c?"srgb":"srgb-linear",h}let es={files:ea,path:"",preset:void 0,extensions:void 0};eo.preload=e=>{let t={...es,...e},{files:r,path:n=""}=t,{preset:i,extensions:a}=t;i&&(eu(i),r=en[i],n=ei);let{extension:s}=ec(r);if("webp"===s||"jpg"===s||"jpeg"===s)throw Error("useEnvironment: Preloading gainmaps is not supported");let l=ed(s);if(!l)throw Error("useEnvironment: Unrecognized file extension: "+r);o.G.preload(l,Array.isArray(r)?[r]:r,e=>{null==e.setPath||e.setPath(n),a&&a(e)})};let el={files:ea,preset:void 0};function eu(e){if(!(e in en))throw Error("Preset must be one of: "+Object.keys(en).join(", "))}function ec(e){var t;let r=Array.isArray(e)&&6===e.length,n=Array.isArray(e)&&3===e.length&&e.some(e=>e.endsWith("json")),i=Array.isArray(e)?e[0]:e;return{extension:r?"cube":n?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":null==(t=i.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:n}}function ed(e){return"cube"===e?s.ScU:"hdr"===e?c:"exr"===e?L:"jpg"===e||"jpeg"===e?er:"webp"===e?et:null}function ef(e,t,r,n,i={}){var a,s,l,u,c;let d;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};let f=(d=c=t||r).current&&d.current.isScene?c.current:c,p=f.background,h=f.environment,g={backgroundBlurriness:f.backgroundBlurriness,backgroundIntensity:f.backgroundIntensity,backgroundRotation:null!=(a=null==(s=f.backgroundRotation)||null==s.clone?void 0:s.clone())?a:[0,0,0],environmentIntensity:f.environmentIntensity,environmentRotation:null!=(l=null==(u=f.environmentRotation)||null==u.clone?void 0:u.clone())?l:[0,0,0]};return"only"!==e&&(f.environment=n),e&&(f.background=n),(0,o.s)(f,i),()=>{"only"!==e&&(f.environment=h),e&&(f.background=p),(0,o.s)(f,g)}}function ep({scene:e,background:t=!1,map:r,...n}){let i=(0,o.C)(e=>e.scene);return a.useLayoutEffect(()=>{if(r)return ef(t,e,i,r,n)}),null}function eh({background:e=!1,scene:t,blur:r,backgroundBlurriness:n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:l,environmentRotation:u,...c}){let d=eo(c),f=(0,o.C)(e=>e.scene);return a.useLayoutEffect(()=>ef(e,t,f,d,{backgroundBlurriness:null!=r?r:n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:l,environmentRotation:u})),a.useEffect(()=>()=>{d.dispose()},[d]),null}function eg({children:e,near:t=.1,far:r=1e3,resolution:n=256,frames:i=1,map:l,background:u=!1,blur:c,backgroundBlurriness:d,backgroundIntensity:f,backgroundRotation:p,environmentIntensity:h,environmentRotation:g,scene:m,files:y,path:w,preset:v,extensions:x}){let b=(0,o.C)(e=>e.gl),M=(0,o.C)(e=>e.scene),A=a.useRef(null),[P]=a.useState(()=>new s.Z58),T=a.useMemo(()=>{let e=new s.o6l(n);return e.texture.type=s.ix0,e},[n]);a.useEffect(()=>()=>{T.dispose()},[T]),a.useLayoutEffect(()=>{if(1===i){let e=b.autoClear;b.autoClear=!0,A.current.update(b,P),b.autoClear=e}return ef(u,m,M,T.texture,{backgroundBlurriness:null!=c?c:d,backgroundIntensity:f,backgroundRotation:p,environmentIntensity:h,environmentRotation:g})},[e,P,T.texture,m,M,u,i,b]);let B=1;return(0,o.D)(()=>{if(i===1/0||B<i){let e=b.autoClear;b.autoClear=!0,A.current.update(b,P),b.autoClear=e,B++}}),a.createElement(a.Fragment,null,(0,o.o)(a.createElement(a.Fragment,null,e,a.createElement("cubeCamera",{ref:A,args:[t,r,T]}),y||v?a.createElement(eh,{background:!0,files:y,preset:v,path:w,extensions:x}):l?a.createElement(ep,{background:!0,map:l,extensions:x}):null),P))}function em(e){var t,r,n,s;let l=eo(e),c=e.map||l;a.useMemo(()=>(0,o.e)({GroundProjectedEnvImpl:u}),[]),a.useEffect(()=>()=>{l.dispose()},[l]);let d=a.useMemo(()=>[c],[c]),f=null==(t=e.ground)?void 0:t.height,p=null==(r=e.ground)?void 0:r.radius,h=null!=(n=null==(s=e.ground)?void 0:s.scale)?n:1e3;return a.createElement(a.Fragment,null,a.createElement(ep,(0,i.A)({},e,{map:c})),a.createElement("groundProjectedEnvImpl",{args:d,scale:h,height:f,radius:p}))}function ey(e){return e.ground?a.createElement(em,e):e.map?a.createElement(ep,e):e.children?a.createElement(eg,e):a.createElement(eh,e)}eo.clear=e=>{let t={...el,...e},{files:r}=t,{preset:n}=t;n&&(eu(n),r=en[n]);let{extension:i}=ec(r),a=ed(i);if(!a)throw Error("useEnvironment: Unrecognized file extension: "+r);o.G.clear(a,Array.isArray(r)?[r]:r)}},91724:(e,t,r)=>{r.d(t,{t:()=>c});var n=r(16880),i=r(74361),a=r(56996),o=r(87347),s=r(23409);function l({scale:e=[.8,.05,.05],color:t,rotation:r}){return i.createElement("group",{rotation:r},i.createElement("mesh",{position:[.4,0,0]},i.createElement("boxGeometry",{args:e}),i.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function u({onClick:e,font:t,disabled:r,arcStyle:s,label:l,labelColor:u,axisHeadScale:c=1,...d}){let f=(0,a.C)(e=>e.gl),p=i.useMemo(()=>{let e=document.createElement("canvas");e.width=64,e.height=64;let r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=s,r.fill(),l&&(r.font=t,r.textAlign="center",r.fillStyle=u,r.fillText(l,32,41)),new o.GOR(e)},[s,l,u,t]),[h,g]=i.useState(!1),m=(l?1:.75)*(h?1.2:1)*c;return i.createElement("sprite",(0,n.A)({scale:m,onPointerOver:r?void 0:e=>{e.stopPropagation(),g(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),g(!1)})},d),i.createElement("spriteMaterial",{map:p,"map-anisotropy":f.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:l?1:.75,toneMapped:!1}))}let c=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:a="18px Inter var, Arial, sans-serif",axisColors:o=["#ff2060","#20df80","#2080ff"],axisHeadScale:c=1,axisScale:d,labels:f=["X","Y","Z"],labelColor:p="#000",onClick:h,...g})=>{let[m,y,w]=o,{tweenCamera:v}=(0,s.F)(),x={font:a,disabled:r,labelColor:p,onClick:h,axisHeadScale:c,onPointerDown:r?void 0:e=>{v(e.object.position),e.stopPropagation()}};return i.createElement("group",(0,n.A)({scale:40},g),i.createElement(l,{color:m,rotation:[0,0,0],scale:d}),i.createElement(l,{color:y,rotation:[0,0,Math.PI/2],scale:d}),i.createElement(l,{color:w,rotation:[0,-Math.PI/2,0],scale:d}),!t&&i.createElement(i.Fragment,null,i.createElement(u,(0,n.A)({arcStyle:m,position:[1,0,0],label:f[0]},x)),i.createElement(u,(0,n.A)({arcStyle:y,position:[0,1,0],label:f[1]},x)),i.createElement(u,(0,n.A)({arcStyle:w,position:[0,0,1],label:f[2]},x)),!e&&i.createElement(i.Fragment,null,i.createElement(u,(0,n.A)({arcStyle:m,position:[-1,0,0]},x)),i.createElement(u,(0,n.A)({arcStyle:y,position:[0,-1,0]},x)),i.createElement(u,(0,n.A)({arcStyle:w,position:[0,0,-1]},x)))))}}}]);